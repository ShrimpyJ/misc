    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2012/10/25/273">First message in thread</a></li><li><a href="/lkml/2012/10/25/273">Peter Zijlstra</a><ul><li><a href="/lkml/2012/10/25/238">Peter Zijlstra</a></li><li><a href="/lkml/2012/10/25/239">Peter Zijlstra</a></li><li><a href="/lkml/2012/10/25/240">Peter Zijlstra</a></li><li><a href="/lkml/2012/10/25/241">Peter Zijlstra</a></li><li><a href="/lkml/2012/10/25/242">Peter Zijlstra</a></li><li><a href="/lkml/2012/10/25/244">Peter Zijlstra</a></li><li><a href="/lkml/2012/10/25/245">Peter Zijlstra</a></li><li><a href="/lkml/2012/10/25/247">Peter Zijlstra</a></li><li><a href="/lkml/2012/10/25/248">Peter Zijlstra</a></li><li><a href="/lkml/2012/10/25/249">Peter Zijlstra</a></li><li><a href="/lkml/2012/10/25/250">Peter Zijlstra</a></li><li><a href="/lkml/2012/10/25/251">Peter Zijlstra</a></li><li><a href="/lkml/2012/10/25/254">Peter Zijlstra</a></li><li><a href="/lkml/2012/10/25/255">Peter Zijlstra</a></li><li><a href="/lkml/2012/10/25/257">Peter Zijlstra</a></li><li><a href="/lkml/2012/10/25/258">Peter Zijlstra</a></li><li><a href="/lkml/2012/10/25/259">Peter Zijlstra</a></li><li><a href="/lkml/2012/10/25/260">Peter Zijlstra</a></li><li><a href="/lkml/2012/10/25/261">Peter Zijlstra</a></li><li><a href="/lkml/2012/10/25/262">Peter Zijlstra</a></li><li><a href="/lkml/2012/10/25/296">Peter Zijlstra</a><ul><li><a href="/lkml/2012/10/25/559">Andi Kleen</a><ul><li><a href="/lkml/2012/10/26/76">Ingo Molnar</a></li></ul></li></ul></li><li><a href="/lkml/2012/10/25/298">Peter Zijlstra</a></li><li><a href="/lkml/2012/10/25/300">Peter Zijlstra</a></li><li><a href="/lkml/2012/10/25/324">Peter Zijlstra</a><ul><li class="origin"><a href="/lkml/2012/10/26/59">Linus Torvalds</a><ul><li><a href="/lkml/2012/10/26/59">Ingo Molnar</a><ul><li><a href="/lkml/2012/10/26/283">Ingo Molnar</a></li></ul></li></ul></li><li><a href="/lkml/2012/11/1/260">Mel Gorman</a></li><li><a href="/lkml/2012/10/30/795">Rik van Riel</a></li></ul></li><li><a href="/lkml/2012/10/25/360">Peter Zijlstra</a><ul><li><a href="/lkml/2012/11/1/203">Mel Gorman</a></li></ul></li><li><a href="/lkml/2012/10/25/417">Peter Zijlstra</a><ul><li><a href="/lkml/2012/11/1/197">Mel Gorman</a><ul><li><a href="/lkml/2012/11/1/201">Don Morris</a></li></ul></li></ul></li><li><a href="/lkml/2012/10/25/419">Peter Zijlstra</a><ul><li><a href="/lkml/2012/11/1/160">Mel Gorman</a></li></ul></li><li><a href="/lkml/2012/10/25/529">Linus Torvalds</a><ul><li><a href="/lkml/2012/10/26/40">Ingo Molnar</a></li></ul></li><li><a href="/lkml/2012/10/25/531">Linus Torvalds</a><ul><li><a href="/lkml/2012/10/25/750">Rik van Riel</a><ul><li><a href="/lkml/2012/10/25/770">Linus Torvalds</a><ul><li><a href="/lkml/2012/10/25/802">Rik van Riel</a></li></ul></li></ul></li></ul></li><li><a href="/lkml/2012/10/25/766">Peter Zijlstra</a></li><li><a href="/lkml/2012/10/26/118">Zhouping Liu</a><ul><li><a href="/lkml/2012/10/26/136">Peter Zijlstra</a><ul><li><a href="/lkml/2012/10/26/120">Ingo Molnar</a></li><li><a href="/lkml/2012/10/26/143">Zhouping Liu</a></li><li><a href="/lkml/2012/10/26/168">Zhouping Liu</a><ul><li><a href="/lkml/2012/10/26/166">Ingo Molnar</a></li></ul></li><li><a href="/lkml/2012/10/28/96">Johannes Weiner</a><ul><li><a href="/lkml/2012/10/28/338">Zhouping Liu</a></li><li><a href="/lkml/2012/10/30/30">Zhouping Liu</a></li></ul></li></ul></li></ul></li><li><a href="/lkml/2012/10/25/869">Peter Zijlstra</a><ul><li><a href="/lkml/2012/11/1/241">Mel Gorman</a></li></ul></li><li><a href="/lkml/2012/10/25/879">Peter Zijlstra</a></li><li><a href="/lkml/2012/10/25/885">Peter Zijlstra</a><ul><li><a href="/lkml/2012/11/1/243">Mel Gorman</a></li></ul></li><li><a href="/lkml/2012/10/30/192">Mel Gorman</a><ul><li><a href="/lkml/2012/10/30/259">Andrew Morton</a><ul><li><a href="/lkml/2012/10/30/320">Mel Gorman</a></li></ul></li><li><a href="/lkml/2012/11/3/94">Alex Shi</a><ul><li><a href="/lkml/2012/11/3/109">Mel Gorman</a><ul><li><a href="/lkml/2012/11/9/513">Alex Shi</a></li></ul></li></ul></li><li><a href="/lkml/2012/11/9/53">Rik van Riel</a></li></ul></li><li><a href="/lkml/2012/11/1/94">Mel Gorman</a><ul><li><a href="/lkml/2012/11/1/181">Rik van Riel</a></li></ul></li><li><a href="/lkml/2012/11/1/105">Mel Gorman</a></li><li><a href="/lkml/2012/11/1/117">Mel Gorman</a></li><li><a href="/lkml/2012/11/1/119">Mel Gorman</a></li><li><a href="/lkml/2012/11/1/120">Mel Gorman</a></li><li><a href="/lkml/2012/11/1/125">Mel Gorman</a></li><li><a href="/lkml/2012/11/1/138">Mel Gorman</a></li><li><a href="/lkml/2012/11/1/140">Mel Gorman</a></li><li><a href="/lkml/2012/11/1/193">Mel Gorman</a></li><li><a href="/lkml/2012/11/1/198">Mel Gorman</a></li><li><a href="/lkml/2012/11/1/267">Mel Gorman</a></li><li><a href="/lkml/2012/11/1/272">Mel Gorman</a></li><li><a href="/lkml/2012/11/5/443">Srikar Dronamraju</a></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><script type="text/javascript" src="//pagead2.googlesyndication.com/pagead/show_ads.js"></script><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Thu, 25 Oct 2012 13:53:05 -0700</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: [PATCH 26/31] sched, numa, mm: Add fault driven placement and migration policy</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody">On Thu, Oct 25, 2012 at 5:16 AM, Peter Zijlstra &lt;a.p.zijlstra&#64;chello.nl&gt; wrote:<br />&gt; +       /*<br />&gt; +        * Using runtime rather than walltime has the dual advantage that<br />&gt; +        * we (mostly) drive the selection from busy threads and that the<br />&gt; +        * task needs to have done some actual work before we bother with<br />&gt; +        * NUMA placement.<br />&gt; +        */<br /><br />That explanation makes sense..<br /><br />&gt; +       now = curr-&gt;se.sum_exec_runtime;<br />&gt; +       period = (u64)curr-&gt;numa_scan_period * NSEC_PER_MSEC;<br />&gt; +<br />&gt; +       if (now - curr-&gt;node_stamp &gt; period) {<br />&gt; +               curr-&gt;node_stamp = now;<br />&gt; +<br />&gt; +               if (!time_before(jiffies, curr-&gt;mm-&gt;numa_next_scan)) {<br /><br />.. but then the whole "numa_next_scan" thing ends up being about<br />real-time anyway?<br /><br />So 'numa_scan_period' in in CPU time (msec, converted to nsec at<br />runtime rather than when setting it), but 'numa_next_scan' is in<br />wallclock time (jiffies)?<br /><br />But *both* of them are based on the same 'numa_scan_period' thing that<br />the user sets in ms.<br /><br />So numa_scan_period is interpreted as both wallclock *and* as runtime?<br /><br />Maybe this works, but it doesn't really make much sense. And what is<br />the impact of this on machines that run lots of loads with delays<br />(whether due to IO or timers)?<br /><br />                     Linus<br /><br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
