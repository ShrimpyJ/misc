    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2012/9/25/542">First message in thread</a></li><li><a href="/lkml/2012/9/25/542">Geert Uytterhoeven</a><ul><li class="origin"><a href="">Linus Torvalds</a></li><li><a href="/lkml/2012/9/25/555">Al Viro</a><ul><li><a href="/lkml/2012/9/25/577">Geert Uytterhoeven</a><ul><li><a href="/lkml/2012/9/25/597">Richard Weinberger</a></li></ul></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Tue, 25 Sep 2012 12:20:55 -0700</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: [PATCH/resend/bypass] um: Preinclude include/linux/kern_levels.h</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody">On Tue, Sep 25, 2012 at 12:11 PM, Geert Uytterhoeven<br />&lt;geert&#64;linux-m68k.org&gt; wrote:<br />&gt;<br />&gt; To fix this:<br />&gt;   - Move the mapping from UM_KERN_&lt;LEVEL&gt; to KERN_&lt;LEVEL&gt; from<br />&gt;     arch/um/include/shared/common-offsets.h to<br />&gt;     arch/um/include/shared/user.h, which is preincluded for all userspace<br />&gt;     parts,<br />&gt;   - Preinclude include/linux/kern_levels.h for all userspace parts, to<br />&gt;     obtain the in-kernel KERN_&lt;LEVEL&gt; constant definitions. This doesn't<br />&gt;     violate the kernel/userspace separation, as include/linux/kern_levels.h<br />&gt;     is self-contained and doesn't expose any other kernel internals.<br />&gt;   - Remove the now unused STR() and DEFINE_STR() macros.<br /><br />Ugh.<br /><br />Why do you preinclude kern_levels.h instead of just having a<br />"#include" in user.h?<br /><br />IOW, this part of the patch:<br /><br />-       c_flags = -Wp,-MD,$(depfile) $(USER_CFLAGS) -include user.h<br />$(CFLAGS_$(basetarget).o)<br />+       c_flags = -Wp,-MD,$(depfile) $(USER_CFLAGS) -include<br />$(srctree)/include/linux/kern_levels.h -include user.h<br />$(CFLAGS_$(basetarget).o)<br /><br />just makes me go want to puke. The user.h file already has other<br />#include's in it, so I really don't see why you create this insane<br />special case.<br /><br />And why does UM have those "UM_KERN_XYZ" defines in the first place?<br />Why isn't it just using KERN_XYZ directly? Is it because kern_levels.h<br />didn't use to exist, so it was some kind of "let's create our own that<br />we can hide in our special headers".<br /><br />IOW, I really thinks this patch makes things uglier. At the very least<br />it could be done more prettily, but preferably we'd get rid of the odd<br />and useless UM_ prefix from these things entirely.<br /><br />             Linus<br /><br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
