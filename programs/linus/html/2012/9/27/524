    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2012/9/14/99">First message in thread</a></li><li><a href="/lkml/2012/9/27/502">Linus Torvalds</a><ul><li><a href="/lkml/2012/9/27/511">Peter Zijlstra</a><ul><li><a href="/lkml/2012/9/27/522">Borislav Petkov</a><ul><li><a href="/lkml/2012/9/27/707">Mike Galbraith</a><ul><li><a href="/lkml/2012/9/28/274">Borislav Petkov</a></li></ul></li></ul></li><li class="origin"><a href="/lkml/2012/9/28/1">Linus Torvalds</a><ul><li><a href="/lkml/2012/9/28/1">Mike Galbraith</a></li><li><a href="/lkml/2012/9/28/150">Peter Zijlstra</a></li></ul></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Thu, 27 Sep 2012 12:40:08 -0700</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: 20% performance drop on PostgreSQL 9.2 from kernel 3.5.3 to 3.6-rc5 on AMD chipsets - bisected</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody">On Thu, Sep 27, 2012 at 11:29 AM, Peter Zijlstra &lt;a.p.zijlstra&#64;chello.nl&gt; wrote:<br />&gt;<br />&gt; Don't forget to run the desktop interactivity benchmarks after you're<br />&gt; done wriggling with this knob... wakeup preemption is important for most<br />&gt; those.<br /><br />So I don't think we want to *just* wiggle that knob per se. We<br />definitely don't want to hurt latency on actual interactive asks. But<br />it's interesting that it helps psql so much, and that there seems to<br />be some interaction with the select_idle_sibling().<br /><br />So I do have a few things I react to when looking at that wakeup granularity..<br /><br />I wonder about this comment, for example:<br /><br />         * By using 'se' instead of 'curr' we penalize light tasks, so<br />         * they get preempted easier. That is, if 'se' &lt; 'curr' then<br />         * the resulting gran will be larger, therefore penalizing the<br />         * lighter, if otoh 'se' &gt; 'curr' then the resulting gran will<br />         * be smaller, again penalizing the lighter task.<br /><br />why would we want to preempt light tasks easier? It sounds backwards<br />to me. If they are light, we have *less* reason to preempt them, since<br />they are more likely to just go to sleep on their own, no?<br /><br />Another question is whether the fact that this same load interacts<br />with select_idle_sibling() is perhaps a sign that maybe the preemption<br />logic is all fine, but it interacts badly with the "pick new cpu"<br />code. In particular, after having changed rq's, is the vruntime really<br />comparable? IOW, maybe this is an interaction between "place_entity()"<br />and then the immediately following (?) call to check wakeup<br />preemption?<br /><br />The fact that *either* changing select_idle_sibling() *or* changing<br />the wakeup preemption granularity seems to have such a huge impact<br />does seem to tie them together somehow for this particular load. No?<br /><br />             Linus<br /><br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
