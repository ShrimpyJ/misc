    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2002/7/19/84">First message in thread</a></li><li><a href="/lkml/2002/7/19/84">Paul Eggert</a><ul><li><a href="/lkml/2002/7/19/249">Alan Cox</a><ul><li class="origin"><a href="/lkml/2002/7/21/69">(Linus Torvalds)</a><ul><li><a href="/lkml/2002/7/21/69">Ingo Molnar</a></li><li><a href="/lkml/2002/7/21/80">(Eric W. Biederman)</a><ul><li><a href="/lkml/2002/7/24/74">Jamie Lokier</a></li></ul></li><li><a href="/lkml/2002/7/21/91">Christoph Rohland</a><ul><li><a href="/lkml/2002/7/21/85">Linus Torvalds</a></li></ul></li></ul></li><li><a href="/lkml/2002/7/21/126">Richard Stallman</a></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">From</td><td class="rp" itemprop="author">(Linus Torvalds)</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: [PATCH] 'select' failure or signal should not update timeout</td></tr><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Sat, 20 Jul 2002 05:57:46 +0000 (UTC)</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody">In article &lt;200207200038.g6K0cZO12086&#64;devserv.devel.redhat.com&gt;,<br />Alan Cox  &lt;alan&#64;redhat.com&gt; wrote:<br />&gt;&gt; &lt;<a href="https://www.opengroup.org/onlinepubs/007904975/functions/select.html&gt;">http://www.opengroup.org/onlinepubs/007904975/functions/select.html&gt;</a><br />&gt;&gt; says that 'select' may modify its timeout argument only "upon<br />&gt;&gt; successful completion".  However, the Linux kernel sometimes modifies<br />&gt;&gt; the timeout argument even when 'select' fails or is interrupted.<br />&gt;<br />&gt;This is extremely useful behaviour. POSIX is broken here. Fix it in the<br />&gt;C library or somewhere it doesn't harm the clueful<br /><br />Personally, I've gotten to the point where I think that the select()<br />time is broken. <br /><br />The thing is, nobody should really ever use timeouts, because the notion<br />of "I want to sleep X seconds" is simply not _useful_ if the process<br />also just got delayed by a page-out event as it said so.  What does "X<br />seconds" mean at that point? It's ambiguous - and the kernel will (quite<br />naturally) just always assume that it is "X seconds from when the kernel<br />got notified". <br /><br />A _useful_ interface would be to say "I want to sleep to at most time X"<br />or "to at least time X".  Those are unambiguous things to say, and are<br />not open to interpretation.<br /><br />The "I want to sleep until at least time X" (or "at most time X") also<br />has the added advantage that it is inherently re-startable - restarting<br />the sleep has _no_ rounding issues, and again no ambiguity.<br /><br />Note that select() is definitely not the only offender here.  Other<br />system calls like "nanosleep()" have the exact same problem - what do<br />you do if you get interrupted by a signal and need to restart? <br /><br />The Linux behaviour of modifying the timeout is a half-assed try for<br />restartability, but the problem is that (a) nobody else does that or<br />expects it to happen, despite the man-pages originally claiming that<br />they were supposed to and (b) it inherently has rounding problems and<br />other ambiguities - making it even less useful. <br /><br />Oh, well.<br /><br />I suspect almost nobody actually uses the Linux timeout feature because<br />of the nonportability issues, making the whole mess even less tasty.<br /><br />		Linus<br />-<br />To unsubscribe from this list: send the line "unsubscribe linux-kernel" in<br />the body of a message to majordomo&#64;vger.kernel.org<br />More majordomo info at  <a href="http://vger.kernel.org/majordomo-info.html">http://vger.kernel.org/majordomo-info.html</a><br />Please read the FAQ at  <a href="http://www.tux.org/lkml/">http://www.tux.org/lkml/</a><br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
