    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2002/7/13/54">First message in thread</a></li><li><a href="/lkml/2002/7/13/54">Tim Schmielau</a><ul><li class="origin"><a href="/lkml/2002/7/13/82">Linus Torvalds</a><ul><li><a href="/lkml/2002/7/13/82">"Albert D. Cahalan"</a><ul><li><a href="/lkml/2002/7/13/125">Thunder from the hill</a></li><li><a href="/lkml/2002/7/14/107">Linus Torvalds</a></li></ul></li><li><a href="/lkml/2002/7/14/30">Zack Weinberg</a></li><li><a href="/lkml/2002/7/16/105">Tim Schmielau</a><ul><li><a href="/lkml/2002/7/16/60">Tim Schmielau</a></li></ul></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><script type="text/javascript" src="//pagead2.googlesyndication.com/pagead/show_ads.js"></script><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Sat, 13 Jul 2002 11:15:28 -0700 (PDT)</td></tr><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: What is supposed to replace clock_t?</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody"><br /><br />On Sat, 13 Jul 2002, Tim Schmielau wrote:<br />&gt;<br />&gt; the log message to your patch that splits in-kernel HZ und user-level HZ<br />&gt; mentions the "broken interfaces that still use 'clock_t'". And indeed,<br />&gt; these interfaces are broken now, since some of them now wrap after 49<br />&gt; days, while others wrap after 497 days.<br /><br />clock_t is fundamentally broken partly because of the size issue (ie we're<br />fixed to a 32-bit clock_t on x86, and the 497 day thing is fundamental,<br />while the 49 day thing is just because I was lazy and didn't want to<br />bother with 64-bit divisions etc for the broken stuff).<br /><br />The only sane interface is a seconds-based one, either like /proc/uptime<br />(ie ASCII floating point representation) or a mixed integer representation<br />like timeval/timespec where you have seconds and micro/nanoseconds<br />separately.<br /><br />&gt; My goal with the "&gt; 497 days uptime patch" was to hide internal overflows<br />&gt; within the kernel, so that every exported value wraps exactly when the<br />&gt; number of _exported_ bits does not suffice to hold the true value.<br /><br />That's something we should strive for, but I also think we should avoid<br />using the clock_t format at all, and give alternate representations (for<br />example, leave the broken clock_t representation in /proc/&lt;pid&gt;/stat<br />alone, and just add a _sane_ seconds-based thing in the much more readable<br />and parseable /proc/&lt;pid&gt;/status file.<br /><br />Not all of the olf clock_t-based stuff is worth trying to fix up, imho.<br /><br />&gt; However, with the new divisor of 10 between internal and external time<br />&gt; values this would now require most internal time values to be stored in<br />&gt; &gt;= 36 bit wide variables (i.e., 64 bit).<br /><br />I agree. We should just make the internal jiffies be 64-bit. That's<br />already true for the "true" jiffy count, but it's simply not true for some<br />other things (process counters etc). That's a separate issue from the<br />fundamental brokenness of<br /><br />&gt; Then we could, of course, also extend the exported values where exported<br />&gt; as text, only keeping binary interfaces as 'legacy interfaces'.<br /><br />Many of the binary interfaces are perfectly fine. In fact, there are very<br />few binary interfaces that are fundamentally broken, the obvious one being<br />the "times()" system call that nobody actually uses any more. Fixing<br />"jiffies_to_timeval()" and friends to do the right thing for 64-bit<br />jiffies will make a lot of the binary interfaces (ie gettimeofday/select/<br />getrusage etc) just do the right thing.<br /><br />I'd like to do this gradually, though. If you're interested, how about<br />just slowly migrating to a<br /><br />	typedef u64 jiffies_t;<br /><br />and slowly making the _internal_ stuff be 64-bit clean?<br /><br />		Linus<br /><br />-<br />To unsubscribe from this list: send the line "unsubscribe linux-kernel" in<br />the body of a message to majordomo&#64;vger.kernel.org<br />More majordomo info at  <a href="http://vger.kernel.org/majordomo-info.html">http://vger.kernel.org/majordomo-info.html</a><br />Please read the FAQ at  <a href="http://www.tux.org/lkml/">http://www.tux.org/lkml/</a><br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
