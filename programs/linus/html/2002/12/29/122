    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2002/12/29/70">First message in thread</a></li><li><a href="/lkml/2002/12/29/70">Ulrich Drepper</a><ul><li class="origin"><a href="">Linus Torvalds</a></li><li><a href="/lkml/2002/12/30/220">Linus Torvalds</a><ul><li><a href="/lkml/2002/12/30/233">Ulrich Drepper</a></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Sun, 29 Dec 2002 15:51:10 -0800 (PST)</td></tr><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: glibc binaries w/ sysenter support</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody"><br />On Sun, 29 Dec 2002, Ulrich Drepper wrote:<br />&gt;<br />&gt; After quite some fiddling we finally have some glibc binaries with<br />&gt; sysenter support.  The problems were not in the sysenter code but in<br />&gt; coordinating everything in ld.so so that it works on old kernels<br />&gt; (without TLS support).<br />&gt; <br />&gt; Anyway, the result can be downloaded from<br />&gt; <br />&gt; <a href="ftp://people.redhat.com/drepper/glibc/2.3.1-25/">ftp://people.redhat.com/drepper/glibc/2.3.1-25/</a><br /><br />Thanks. <br /><br />Having a full system like this showed a few special cases in sysenter<br />handling, where some system calls really depend on the old "iret" return<br />path.<br /><br />Notably, "sys_iopl()" requires the iret path because that's the only way<br />to restore the full eflags, and "execve()" requires the iret return path<br />because it needs to start up the new process with fixed values in<br />%edx/%ebx, and the stack has a new layout and no longer contains the<br />required sysexit fixup code.<br /><br />I've pushed the fix for both of these issues to the kernel -bk trees. <br /><br />Without the fix, a system with sysenter support would not boot up cleanly<br />with these libraries due to the execve() issues, and X wouldn't start<br />because of the iopl() problem.<br /><br />With this in place, I've not seen any strange behaviour, and "lmbench" <br />reports<br /><br />	Processor, Processes - times in microseconds - smaller is better<br />	----------------------------------------------------------------<br />	Host                 OS  Mhz null null      open selct sig  sig  fork exec sh  <br />	                             call  I/O stat clos       inst hndl proc proc proc<br />	--------- ------------- ---- ---- ---- ---- ---- ----- ---- ---- ---- ---- ----<br />	i686-linu  Linux 2.5.53 2380  0.7  1.1    5    7 0.04K  1.2    3 0.2K   1K   3K<br />	i686-linu  Linux 2.5.53 2380  0.7  1.1    5    7 0.04K  1.2    3 0.2K   1K   3K<br />	i686-linu  Linux 2.5.53 2380  0.7  1.1    5    7 0.04K  1.2    3 0.2K   1K   3K<br />	i686-linu  Linux 2.5.53 2380  0.2  0.6    5    6 0.04K  0.7    3 0.2K   1K   3K<br />	i686-linu  Linux 2.5.53 2380  0.2  0.6    5    6 0.04K  0.7    3 0.2K   1K   3K<br />	i686-linu  Linux 2.5.53 2380  0.2  0.6    5    6 0.04K  0.7    3 0.2K   1K   3K<br /><br />(the three first entries are with the old glibc, three last entries are<br />with the new one - note the null call/io and signal install improvements).<br /><br />		Linus<br /><br />-<br />To unsubscribe from this list: send the line "unsubscribe linux-kernel" in<br />the body of a message to majordomo&#64;vger.kernel.org<br />More majordomo info at  <a href="http://vger.kernel.org/majordomo-info.html">http://vger.kernel.org/majordomo-info.html</a><br />Please read the FAQ at  <a href="http://www.tux.org/lkml/">http://www.tux.org/lkml/</a><br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
