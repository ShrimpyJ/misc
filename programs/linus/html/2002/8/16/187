    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2002/8/16/183">First message in thread</a></li><li><a href="/lkml/2002/8/16/13">Linus Torvalds</a><ul><li><a href="/lkml/2002/8/16/182">Alexander Viro</a><ul><li class="origin"><a href="/lkml/2002/8/16/174">Linus Torvalds</a><ul><li><a href="/lkml/2002/8/16/174">Alexander Viro</a></li><li><a href="/lkml/2002/8/17/29">Rogier Wolff</a></li><li><a href="/lkml/2002/8/17/33">Andries Brouwer</a></li><li><a href="/lkml/2002/8/17/55">Russell King</a><ul><li><a href="/lkml/2002/8/17/120">Vojtech Pavlik</a></li></ul></li><li><a href="/lkml/2002/8/17/67">Mike Dresser</a></li><li><a href="/lkml/2002/8/17/88">Jan-Benedict Glaw</a><ul><li><a href="/lkml/2002/8/17/12">Andre Hedrick</a></li><li><a href="/lkml/2002/8/17/46">Anton Altaparmakov</a></li><li><a href="/lkml/2002/8/19/123">Dana Lacoste</a></li></ul></li><li><a href="/lkml/2002/8/19/150">Thunder from the hill</a><ul><li><a href="/lkml/2002/8/20/21">Sean Neakums</a></li></ul></li><li><a href="/lkml/2002/8/23/154">Pavel Machek</a></li></ul></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Fri, 16 Aug 2002 18:35:29 -0700 (PDT)</td></tr><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: IDE?</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody"><br />On Fri, 16 Aug 2002, Alexander Viro wrote:<br />&gt; <br />&gt; Sigh...  What we need with IDE is<br />&gt; 	a) translator/bogon filter between hardware folks and the rest of<br />&gt; us.  If Jens or Alan are willing to do that for a while - wonderful.<br /><br />Agreed.<br /><br />&gt; 	b) review of code structure in existing code.  Doing that.<br /><br />Hey, my secret plan is to make sure those IDE people are kept in check, by <br />having AL flame them to smithereens if they do something stupid..<br /><br />&gt; 	c) careful massage (as opposed to grand rewrite) of said structure<br />&gt; into something sane.  With series of small provable equivalent transformations.<br />&gt; And whoever does that is in serious risk of burnout - current spaghetty in<br />&gt; there is a fscking mess.  I'll try to help with that - I know how to do such<br />&gt; work, but I don't promise to get it all the way to sanity.<br /><br />Good luck, but I think those init rules etc are really horribly subtle.<br /><br />I really would suggest an alternate (but not necessarily very different) <br />approach. <br /><br />The approach I'd advocate is to<br /><br /> - move the major number registration out of the IDE code, and changing <br />   all device numbers into indexes + a queue. This can be done without <br />   actually changing any of the _IO_ the drivers do, and should be doable<br />   with a transformation that doesn't change behaviur _at_all_.<br /><br />   This, btw, is an area that a certain Al is fairly intimate with anyway ;)<br /><br /> - once the IDE drivers don't even know about major and minor numbers <br />   (right now it has 10 major numbers assigned to it, I think) and doesn't <br />   register a block device with "register_blkdev()" at all, but instead <br />   registers the controllers it finds one by one through some indirect <br />   agent, we can now try phase 2.<br /><br /> - phase 2: IDE-TNG. Leave the current IDE code unchanged, and plan to <br />   obsolete it. It's the "stable IDE", and by virtue of being stable, <br />   nobody will mind work on new drivers that (by definition) cannot screw <br />   up unless you use them.<br /><br />   IDE-TNG would:<br />    - be controller-specific (ie one driver for one controller family)<br />    - be able to say "screw it" for old or broken setups (which are left <br />      fot the old IDE code)<br />    - in particular, it would only bother with PCI (or better) <br />      controllers, and with UDMA-only setups.<br /><br />The point of IDE-TNG would be to only support the major controllers this <br />way, but let those major controllers have a driver that is meant for <br />_them_ and doesn't have to worry about historical baggage. <br /><br />And then in five years, in Linux-3.2, we might finally just drop support <br />for the old IDE code with PIO etc. Inevitably some people will still use <br />it (the same way some people still use Linux-2.0 with hd.c), but it won't <br />have been in the way for making a cleaner driver in the meantime.<br /><br />And yes, by now this all is obviously 2.7.x material.<br /><br />			Linus<br /><br />-<br />To unsubscribe from this list: send the line "unsubscribe linux-kernel" in<br />the body of a message to majordomo&#64;vger.kernel.org<br />More majordomo info at  <a href="http://vger.kernel.org/majordomo-info.html">http://vger.kernel.org/majordomo-info.html</a><br />Please read the FAQ at  <a href="http://www.tux.org/lkml/">http://www.tux.org/lkml/</a><br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
