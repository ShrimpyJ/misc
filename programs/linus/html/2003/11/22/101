    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2003/11/22/83">First message in thread</a></li><li><a href="/lkml/2003/11/22/93">Linus Torvalds</a><ul><li><a href="/lkml/2003/11/22/98">Marco d'Itri</a><ul><li class="origin"><a href="/lkml/2003/11/23/4">Linus Torvalds</a><ul><li><a href="/lkml/2003/11/23/4">Len Brown</a></li><li><a href="/lkml/2003/11/23/12">Marco d'Itri</a><ul><li><a href="/lkml/2003/11/23/23">Linus Torvalds</a></li></ul></li></ul></li></ul></li></ul></li></ul><div class="threadlist">Patch in this message</div><ul class="threadlist"><li><a href="/lkml/diff/2003/11/22/101/1">Get diff 1</a></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Sat, 22 Nov 2003 19:24:15 -0800 (PST)</td></tr><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: irq 15: nobody cared! with KT600 chipset and 2.6.0-test9</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody"><br />On Sun, 23 Nov 2003, Marco d'Itri wrote:<br />&gt;<br />&gt; It does not. This is the output with your patch applied and PCI<br />&gt; debugging enabled:<br /><br />Thanks. This is interesting. Looking at the IRQ probing output:<br /><br />&gt; hdc: IRQ probe failed (0x3cfa: 0). Guessing at 15<br /><br />The interesting parts are the 0x3cfa and the 0:<br /> - the "0" means that we literally didn't see any interrupt at all during <br />   the autoprobing. Sometimes autoprobing fails because we see _multiple_ <br />   interrupts, but that wasn't the case here.<br /> - 0x3cfa is the "probe cookie", which tells which irq's were free to be <br />   probed. That's<br /><br />	1, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13<br /><br />   and what's interesting is that irq 15 wasn't even probed at all (14 <br />   wasn't either, but that's easy to explain: we took that when we probed <br />   and registered ide channel 0 earlier. irq 0 and 2 are special - timer <br />   and cascade respectively).<br /><br />So for some reason irq 15 has already been reserved. Somebody has already <br />registered IRQ 15 _before_ we probe for it for that hwif. And:<br /><br />&gt; irq 15: nobody cared!<br />&gt; Call Trace:<br />&gt;  [ ... ]<br />&gt; handlers:<br />&gt; [&lt;c021a730&gt;] (ide_intr+0x0/0x130)<br /><br />this shows that the claimer of the irq is the IDE layer itself.<br /><br />But why has the IDE layer already claimed that interrupt? <br /><br />&gt; Before receiving your second message I tried booting with pci=noacpi and<br />&gt; it worked:<br /><br />Interesting and good in the sense that this is another clue. Why does ACPI <br />interrupt routing cause the IDE layer to register irq 15 too early?<br /><br />Both the PIRQ routing code and the ACPI code give irq3 to the other IDE <br />chip. So why has the IDE stuff registered _another_ irq15 earlier? <br /><br />I don't see it.. Len, Bartlomiej, do you see anything?<br /><br />Marco, can you try this appended (very very stupid) patch with ACPI on, so<br />that we can see where irq15 gets registered? It won't fix anything, but <br />I'm confused by why IRQ 15 has been registered before we probe for it..<br /><br />Thanks,<br /><br />			Linus<br /><br />---<br />===== arch/i386/kernel/irq.c 1.45 vs edited =====<br />--- 1.45/arch/i386/kernel/irq.c	Wed Oct 22 20:26:34 2003<br />+++ edited/arch/i386/kernel/irq.c	Sat Nov 22 19:22:20 2003<br />&#64;&#64; -569,6 +569,8 &#64;&#64;<br /> 	if (!action)<br /> 		return -ENOMEM;<br /> <br />+	WARN_ON(irq == 15);<br />+<br /> 	action-&gt;handler = handler;<br /> 	action-&gt;flags = irqflags;<br /> 	action-&gt;mask = 0;<br />-<br />To unsubscribe from this list: send the line "unsubscribe linux-kernel" in<br />the body of a message to majordomo&#64;vger.kernel.org<br />More majordomo info at  <a href="http://vger.kernel.org/majordomo-info.html">http://vger.kernel.org/majordomo-info.html</a><br />Please read the FAQ at  <a href="http://www.tux.org/lkml/">http://www.tux.org/lkml/</a><br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
