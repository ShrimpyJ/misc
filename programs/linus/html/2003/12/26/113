    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2003/12/26/9">First message in thread</a></li><li><a href="/lkml/2003/12/26/50">Linus Torvalds</a><ul><li><a href="/lkml/2003/12/26/107">Benjamin Herrenschmidt</a><ul><li class="origin"><a href="/lkml/2003/12/26/117">Linus Torvalds</a><ul><li><a href="/lkml/2003/12/26/117">Benjamin Herrenschmidt</a><ul><li><a href="/lkml/2003/12/26/114">Linus Torvalds</a></li><li><a href="/lkml/2003/12/26/119">Benjamin Herrenschmidt</a></li><li><a href="/lkml/2003/12/26/120">Linus Torvalds</a></li><li><a href="/lkml/2003/12/26/129">Rik van Riel</a></li></ul></li><li><a href="/lkml/2003/12/26/125">Andrea Arcangeli</a></li></ul></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Fri, 26 Dec 2003 16:35:56 -0800 (PST)</td></tr><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: Page aging broken in 2.6</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody"><br /><br />On Sat, 27 Dec 2003, Benjamin Herrenschmidt wrote:<br />&gt; <br />&gt; Or do what I propose here, that is have ptep_test_and_clear_* be<br />&gt; responsible for the flush on archs where it is necessary, but then<br />&gt; it would be nice to have more than the ptep as an argument...<br /><br />The dirty handling already does the TLB flush (in that case it's a <br />correctness issue, not a hint). So it's only ptep_test_and_clear_young() <br />that matters.<br /><br />I don't know whather that ever ends up being performance-critical, and I<br />don't see what else could be passed into it. We literally don't _have_<br />anythign else than the pte.<br /><br />But the ppc architecture could easily decide to walk the hash tables and<br />invalidate in ptep_test_and_clear_young(). And if it ends up being a<br />performance issue, it _appears_ that all users of "page_referenced()" <br />(which is the only thing that does this) are actually using the return <br />value as just a boolean. And it's entirely possible that we should break <br />out of "page_referenced()" on the _first_ hit of "yes, this has been <br />referenced".<br /><br />That would make it much less CPU-intensive to make<br />"ptep_test_and_clear_young()" slightly heavier to execute. It would also <br />cause "page_referenced()" to not clear _all_ mapped reference bits at the <br />same time - which might unfairly cause multi-used pages to stay in memory. <br />On the other hand, that might be the _right_ behaviour.<br /><br />Rik? Andrea? <br /><br />Worth testing, perhaps.<br /><br />		Linus<br />-<br />To unsubscribe from this list: send the line "unsubscribe linux-kernel" in<br />the body of a message to majordomo&#64;vger.kernel.org<br />More majordomo info at  <a href="http://vger.kernel.org/majordomo-info.html">http://vger.kernel.org/majordomo-info.html</a><br />Please read the FAQ at  <a href="http://www.tux.org/lkml/">http://www.tux.org/lkml/</a><br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
