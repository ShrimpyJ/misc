    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2015/11/15/3">First message in thread</a></li><li><a href="/lkml/2015/12/14/784">Andy Lutomirski</a><ul><li><a href="/lkml/2015/12/15/149">Pavel Machek</a><ul><li class="origin"><a href="/lkml/2015/12/15/624">Linus Torvalds</a><ul><li><a href="/lkml/2015/12/15/624">Borislav Petkov</a><ul><li><a href="/lkml/2015/12/15/654">Linus Torvalds</a></li></ul></li><li><a href="/lkml/2015/12/15/634">Andy Lutomirski</a><ul><li><a href="/lkml/2015/12/15/656">Linus Torvalds</a></li></ul></li><li><a href="/lkml/2015/12/15/718">Pavel Machek</a><ul><li><a href="/lkml/2015/12/15/724">Pavel Machek</a></li><li><a href="/lkml/2015/12/15/731">Borislav Petkov</a></li></ul></li></ul></li></ul></li></ul></li></ul><div class="threadlist">Patch in this message</div><ul class="threadlist"><li><a href="/lkml/diff/2015/12/15/587/1">Get diff 1</a></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Tue, 15 Dec 2015 09:45:40 -0800</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: 4.4-rc5: ugly warn on: 5 W+X pages found</td></tr><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody">On Tue, Dec 15, 2015 at 1:40 AM, Pavel Machek &lt;pavel&#64;ucw.cz&gt; wrote:<br />&gt;<br />&gt; I tried applying:<br />&gt;<br />&gt; [PATCH 1/2] x86_32/mm: Set NX in __supported_pte_mask before enabling<br />&gt; paging<br />&gt;<br />&gt; but I still get<br />&gt;<br />&gt; [    2.691897] x86/mm: Found insecure W+X mapping at address ffe69000/0xffe69000<br /><br />This may be an insane suggestion, but how about we try to detect when<br />that entry gets set, rather than after the fact.<br /><br />Something really brute-force like<br /><br />  diff --git a/arch/x86/include/asm/pgtable.h b/arch/x86/include/asm/pgtable.h<br />  index 6ec0c8b2e9df..538c9bb239b9 100644<br />  --- a/arch/x86/include/asm/pgtable.h<br />  +++ b/arch/x86/include/asm/pgtable.h<br />  &#64;&#64; -337,6 +337,13 &#64;&#64; static inline pmd_t pmd_clear_soft_dirty(pmd_t pmd)<br /><br />   #endif /* CONFIG_HAVE_ARCH_SOFT_DIRTY */<br /><br />  +static inline int kernel_write_execute_prot(pgprotval_t protval)<br />  +{<br />  +       return !(protval &amp; _PAGE_USER) &amp;&amp;<br />  +               !(protval &amp; _PAGE_NX) &amp;&amp;<br />  +               (protval &amp; _PAGE_RW);<br />  +}<br />  +<br />   /*<br />    * Mask out unsupported bits in a present pgprot.  Non-present pgprots<br />    * can use those bits for other purposes, so leave them be.<br />  &#64;&#64; -345,8 +352,10 &#64;&#64; static inline pgprotval_t massage_pgprot(pgprot_t pgprot)<br />   {<br />          pgprotval_t protval = pgprot_val(pgprot);<br /><br />  -       if (protval &amp; _PAGE_PRESENT)<br />  +       if (protval &amp; _PAGE_PRESENT) {<br />                  protval &amp;= __supported_pte_mask;<br />  +               WARN_ON_ONCE(kernel_write_execute_prot(protval));<br />  +       }<br />          return protval;<br />   }<br />or similar?<br /><br />The above is entirely untested. Maybe it doesn't compile. Or boot. Or work.<br /><br />                 Linus<br /><br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
