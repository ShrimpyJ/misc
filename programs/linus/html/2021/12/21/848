    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2021/12/20/1488">First message in thread</a></li><li><a href="/lkml/2021/12/21/771">(Eric W. Biederman)</a><ul><li><a href="/lkml/2021/12/21/807">Waiman Long</a><ul><li class="origin"><a href="/lkml/2021/12/21/914">Linus Torvalds</a><ul><li><a href="/lkml/2021/12/21/914">Waiman Long</a><ul><li><a href="/lkml/2021/12/21/975">Willy Tarreau</a></li></ul></li></ul></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Tue, 21 Dec 2021 10:19:46 -0800</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: [PATCH] exec: Make suid_dumpable apply to SUID/SGID binaries irrespective of invoking users</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody">On Tue, Dec 21, 2021 at 10:01 AM Waiman Long &lt;longman&#64;redhat.com&gt; wrote:<br />&gt;<br />&gt; Default RLIMIT_CORE to 0 will likely mitigate this vulnerability.<br />&gt; However, there are still some userspace impacts as existing behavior<br />&gt; will be modified. For instance, we may need to modify su to restore a<br />&gt; proper value for RLIMIT_CORE after successful authentication.<br /><br />We had a "clever" idea for this that I thought people were ok with.<br /><br />It's been some time since this came up, but iirc the notion was to<br />instead of setting the rlimit to zero (which makes it really hard to<br />restore afterwards, because you don't know what the restored value<br />would be, so you are dependent on user space doing it), we just never<br />reset set_dumpable() when we execve.<br /><br />So any suid exec will do set_dumpable() to suid_dumpable, and exec'ing<br />something else does nothing at all - it stays non-dumpable (obviously<br />"non-dumpable" here depends on the actual value for "suid_dumpable" -<br />you can enable suid dump debugging manually).<br /><br />And instead, we say that operations like "setsid()" that start a new<br />session - *those* are the ones that enable core dumping again. Or<br />doing things like a "ulimit(RLIMIT_CORE)" (which clearly implies "I<br />want core-dumps").<br /><br />Those will all very naturally make "login" and friends work correctly,<br />while keeping core-dumps disabled for some suid situation that doesn't<br />explicitly set up a new context.<br /><br />I think the basic problem with the traditional UNIX model of "suid<br />exec doesn't core dump" is that the "enter non-core-dump" is a nice<br />clear "your privileges changed".<br /><br />But then the "exit non-core-dump" thing is an exec that *doesn't*<br />change privileges. That's the odd and crazy part: you just disabled<br />core-dumps because there was a privilege level change, and then you<br />enable core-dumps again because there *wasn't* a privilege change -<br />even if you're still at those elevated privileges.<br /><br />Now, this is clearly not a Linux issue - we're just doing what others<br />have been doing too. But I think we should just admit that "what<br />others have been doing" is simply broken.<br /><br />And yes, some odd situation migth be broken by this kind of change,<br />but I think this kind of "the old model was broken" may simply require<br />that. I suspect we can find a solution that fixes all the regular<br />cases.<br /><br />Hmm?<br /><br />               Linus<br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
