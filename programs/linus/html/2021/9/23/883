    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2021/9/23/858">First message in thread</a></li><li><a href="/lkml/2021/9/23/858">Paolo Bonzini</a><ul><li><a href="/lkml/2021/9/23/881">   pr-tracker-bot&#64;kernel ...</a></li><li class="origin"><a href="/lkml/2021/9/23/886">Linus Torvalds</a><ul><li><a href="/lkml/2021/9/23/886">Paolo Bonzini</a></li><li><a href="/lkml/2021/9/24/885">(Eric W. Biederman)</a><ul><li><a href="/lkml/2021/9/24/914">Paolo Bonzini</a></li></ul></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Thu, 23 Sep 2021 11:35:06 -0700</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: [GIT PULL] KVM/rseq changes for Linux 5.15-rc3</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody">On Thu, Sep 23, 2021 at 11:13 AM Paolo Bonzini &lt;pbonzini&#64;redhat.com&gt; wrote:<br />&gt;<br />&gt; A fix for a bug with restartable sequences and KVM.  KVM's handling<br />&gt; of TIF_NOTIFY_RESUME, e.g. for task migration, clears the flag without<br />&gt; informing rseq and leads to stale data in userspace's rseq struct.<br /><br />Ok, patches look reasonable.<br /><br />&gt; I'm sending this as a separate pull request since it's not code<br />&gt; that I usually touch.  In particular, patch 2 ("entry: rseq: Call<br />&gt; rseq_handle_notify_resume() in tracehook_notify_resume()") is just a<br />&gt; cleanup to try and make future bugs less likely.  If you prefer this to<br />&gt; be sent via Thomas and only in 5.16, please speak up.<br /><br />So I took the pull request this way, thanks for separating it like this.<br /><br />But I'm adding a few people to the cc for a completely different<br />reason: the cleanup to move all the notify_resume stuff to<br />tracehook_notify_resume() is good, but it does make me go - once again<br />- "Hmm, that naming is really really bad".<br /><br />The &lt;linux/tracehook.h&gt; code was literally meant for tracing. It's<br />where the name comes from, and it's the original intent: having a<br />place that you can hook into for tracing that doesn't depend on how<br />the core kernel code ends up changing.<br /><br />But that's not how it actually acts right now. That header file is now<br />some very core functionality, and little of it is actually related to<br />tracing any more. It's more core process state handling for the user<br />space return path.<br /><br />So I don't object to the patches, and they are merged, but I'm cc'ing people to<br /><br /> (a) let them know about this (see commit a68de80f61f6: "entry: rseq:<br />Call rseq_handle_notify_resume() in tracehook_notify_resume()" in the<br />current -git tree)<br /><br /> (b) possibly prod some people into perhaps moving/renaming some of<br />that code to actual core kernel C files, instead of a misnamed header<br />file..<br /><br />Hmm?<br /><br />         Linus<br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
