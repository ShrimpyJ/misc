    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2021/9/14/677">First message in thread</a></li><li><a href="/lkml/2021/9/14/1006">Nathan Chancellor</a><ul><li><a href="/lkml/2021/9/14/1624">Tetsuo Handa</a><ul><li class="origin"><a href="/lkml/2021/9/14/1736">Linus Torvalds</a><ul><li><a href="/lkml/2021/9/14/1736">Nathan Chancellor</a></li><li><a href="/lkml/2021/9/15/1">Nick Desaulniers</a></li></ul></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Tue, 14 Sep 2021 19:59:23 -0700</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: linux: build failure: error: "__has_attribute" is not defined</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody">On Tue, Sep 14, 2021 at 6:05 PM Tetsuo Handa<br />&lt;penguin-kernel&#64;i-love.sakura.ne.jp&gt; wrote:<br />&gt;<br />&gt; It would be nice if Makefile can also check gcc version used for building tools.<br /><br />I think the real problem is that the tool headers are cut-down from<br />the real kernel headers, but not cut down enough, so they are still<br />very complex, often with stuff that just isn't worth it in user space<br />at all.<br /><br />And they _look_ like kernel headers - both in naming and in contents.<br />But they really aren't.<br /><br />And it turns out there are two independent bugs here.<br /><br />Bug #1 is that the tool header files look _so_ much like the main<br />kernel header files, that Nick thought that the<br /><br />   #if GCC_VERSION &gt;= 40300<br /><br />was about the compiler we compile the kernel with.<br /><br />But no, it's about the host compiler.<br /><br />Easy mistake to make when the naming is so similar and the contents<br />are often also fairly closely related too.<br /><br />But basically, commit 4e59869aa655 ("compiler-gcc.h: drop checks for<br />older GCC versions") was buggy, because it took the kernel compiler<br />version logic ("we require 5.1 to build the kernel") and applied it to<br />the tooling header files too (we do _not_ require the kernel compiler<br />for host tools).<br /><br />Now, arguably, commit 4eb6bd55cfb2 ("compiler.h: drop fallback<br />overflow checkers") has the exact same problem: it too ends up<br />changing  both the kernel header files and the tooling header files.<br />But tooling really REALLY shouldn't be using those overflow macros, so<br />nobody should care.<br /><br />Famous last words.<br /><br />I think we should remove that "tools/include/linux/overflow.h" header<br />entirely. Yes, it is used - by tools/virtio/linux/kernel.h. But I<br />think that overflow handling code should be removed. It's just not<br />interesting in user tools.<br /><br />Now, the _second_ bug was then that when Nathan fixed the tooling<br />header file in commit d0ee23f9d78b ("tools: compiler-gcc.h: Guard<br />error attribute use with __has_attribute"), he did it the wrong way.<br /><br />The gcc docs are fairly clear about how to test for __has_attibute correctly:<br /><br />    <a href="https://gcc.gnu.org/onlinedocs/cpp/_005f_005fhas_005fattribute.html">https://gcc.gnu.org/onlinedocs/cpp/_005f_005fhas_005fattribute.html</a><br /><br />and a host build environment should probably have used<br /><br />  #if defined __has_attribute<br />  #  if __has_attribute (error)<br />  ...<br /><br />and not used any version checks at all.<br /><br />Of course, I'm not convinced it should do that __compiletime_error()<br />at all, and again, I think it would be better to remove the complexity<br />rather than anything else.<br /><br />Anybody want to tackle those issues in<br /><br />   tools/include/linux/overflow.h<br />   tools/include/linux/compiler-gcc.h<br /><br />and try to simplify the code?<br /><br />              Linus<br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
