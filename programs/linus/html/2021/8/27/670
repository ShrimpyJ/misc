    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2021/8/16/1274">First message in thread</a></li><li><a href="/lkml/2021/8/17/759">(Eric W. Biederman)</a><ul><li><a href="/lkml/2021/8/25/28">Al Viro</a><ul><li class="origin"><a href="/lkml/2021/8/27/799">Linus Torvalds</a><ul><li><a href="/lkml/2021/8/27/799">(Eric W. Biederman)</a></li></ul></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Fri, 27 Aug 2021 11:54:57 -0700</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: [PATCH][RFC] fix PTRACE_KILL</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody">[ Sorry, this got missed by other stuff in my inbox ]<br /><br />On Tue, Aug 24, 2021 at 10:12 PM Al Viro &lt;viro&#64;zeniv.linux.org.uk&gt; wrote:<br />&gt;<br />&gt; The change I'd proposed makes PTRACE_KILL deliver SIGKILL regardless of<br />&gt; the target state; yours is arguably what we should've done from the very<br />&gt; beginning (what we used to have prior to 0.99pl14 and what all other<br />&gt; Unices had been doing all along), but it's a visible change wrt error<br />&gt; returns and I don't see any sane way to paper over that part.<br />&gt;<br />&gt; Linus, what would you prefer?  I've no strong preferences here...<br /><br />Honestly, I have no huge preferences either, simply because this has<br />clearly been broken so long that people who care have worked around<br />the breakage already, or it just didn't matter enough.<br /><br />Your patch looks fine to me, although looking at it I get the feeling<br />that we might as well do it inside "ptrace_check_attach()", and that<br />we should have just passed that function the request (instead of that<br />odd "ignore_state" argument).<br /><br />ptrace_check_attach() already gets that tasklist_lock that the code<br />requires, and could easily do the PTRACE_KILL checking. So I think<br />that might be an additional cleanup.<br /><br />But your patch is targeted and doesn't look wrong to me either.<br /><br />I don't think Eric's patch works, because if I read that one right, it<br />would actually do that "wait_task_inactive()" which is very much<br />against the whole point of PTRACE_KILL.  We want to kill the target<br />asap, and regardless of where it is stuck.<br /><br />              Linus<br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
