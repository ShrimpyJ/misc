    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2021/10/23/195">First message in thread</a></li><li><a href="/lkml/2021/10/23/195">syzbot</a><ul><li class="origin"><a href="/lkml/2021/10/24/289">Linus Torvalds</a><ul><li><a href="/lkml/2021/10/24/289">Matthew Wilcox</a><ul><li><a href="/lkml/2021/10/25/98">Dmitry Vyukov</a></li><li><a href="/lkml/2021/10/25/908">Linus Torvalds</a></li></ul></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Sun, 24 Oct 2021 09:54:22 -1000</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: [syzbot] WARNING: refcount bug in memfd_secret</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody">On Sat, Oct 23, 2021 at 9:35 AM syzbot<br />&lt;syzbot+75639e6a0331cd61d3e2&#64;syzkaller.appspotmail.com&gt; wrote:<br />&gt;<br />&gt; syzbot found the following issue on:<br />&gt;<br />&gt; HEAD commit:    9c0c4d24ac00 Merge tag 'block-5.15-2021-10-22' of git://gi..<br />&gt; git tree:       upstream<br />&gt; console output: <a href="https://syzkaller.appspot.com/x/log.txt?x=115a0328b00000">https://syzkaller.appspot.com/x/log.txt?x=115a0328b00000</a><br />&gt; kernel config:  <a href="https://syzkaller.appspot.com/x/.config?x=59f3ef2b4077575">https://syzkaller.appspot.com/x/.config?x=59f3ef2b4077575</a><br />&gt; dashboard link: <a href="https://syzkaller.appspot.com/bug?extid=75639e6a0331cd61d3e2">https://syzkaller.appspot.com/bug?extid=75639e6a0331cd61d3e2</a><br />&gt; compiler:       Debian clang version 11.0.1-2, GNU ld (GNU Binutils for Debian) 2.35.2<br />&gt; syz repro:      <a href="https://syzkaller.appspot.com/x/repro.syz?x=13a035c2b00000">https://syzkaller.appspot.com/x/repro.syz?x=13a035c2b00000</a><br />&gt; C reproducer:   <a href="https://syzkaller.appspot.com/x/repro.c?x=14ae869f300000">https://syzkaller.appspot.com/x/repro.c?x=14ae869f300000</a><br />&gt;<br />&gt; The issue was bisected to:<br />&gt;<br />&gt; commit 110860541f443f950c1274f217a1a3e298670a33<br /><br />I think that commit is actually just buggy.<br /><br />"secretmem_users" is not actually a reference count. There's no "magic<br />happens when it goes down to zero".<br /><br />It's purely a count of the number of existing users, and incrementing<br />it from zero is not a probolem at all - it is in fact expected.<br /><br />Sure, zero means "we can hibernate", so zero and overflow are somewhat<br />special, but not special enough to cause these kinds of issues.<br /><br />I have reverted this commit in my tree, because honestly, the whole<br />"try to overflow exactly, and hibernate" threat model just isn't worth<br />this all.<br /><br />If people really care, I can suggest<br /><br /> - use "atomic_long_t" instead. Let's face it, 32-bit isn't<br />interesting any more, and 64-bit doesn't overflow.<br /><br /> - make up some new "atomic_inc_nooverflow()" thing or whatever.<br /><br />but for now this is just reverted.<br /><br />             Linus<br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
