    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2008/8/28/371">First message in thread</a></li><li><a href="/lkml/2008/8/30/285">"Yinghai Lu"</a><ul><li><a href="/lkml/2008/8/30/286">"Yinghai Lu"</a><ul><li class="origin"><a href="/lkml/2008/8/30/301">Linus Torvalds</a><ul><li><a href="/lkml/2008/8/30/301">"Yinghai Lu"</a><ul><li><a href="/lkml/2008/8/30/303">Linus Torvalds</a></li></ul></li></ul></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Sat, 30 Aug 2008 20:00:00 -0700 (PDT)</td></tr><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: Linux 2.6.27-rc5: System boot regression caused by commit a2bd7274b47124d2fc4dfdb8c0591f545ba749dd</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody"><br /><br />On Sat, 30 Aug 2008, Yinghai Lu wrote:<br />&gt; &gt;<br />&gt; &gt;                /* Don't touch classless devices or host bridges or ioapics.  */<br />&gt; &gt;                if (class == PCI_CLASS_NOT_DEFINED ||<br />&gt; &gt;                    class == PCI_CLASS_BRIDGE_HOST)<br />&gt; &gt;                        continue;<br />&gt; &gt;<br />&gt; &gt;<br />&gt; &gt; it skips the host bridge...<br />&gt; <br />&gt; what's story for not touching host bridges?<br /><br />Ahh. Exactly because of things like this. The hist bridge BAR's are often <br />special.<br /><br />That code comes from almost four years ago, the commit message was:<br /><br />  Author: Maciej W. Rozycki &lt;macro&#64;mips.com&gt;<br />  Date:   Thu Dec 16 21:44:31 2004 -0800<br /><br />    [PATCH] PCI: Don't touch BARs of host bridges<br /><br />     BARs of host bridges often have special meaning and AFAIK are best left<br />    to be setup by the firmware or system-specific startup code and kept<br />    intact by the generic resource handler.  For example a couple of host<br />    bridges used for MIPS processors interpret BARs as target-mode decoders<br />    for accessing host memory by PCI masters (which is quite reasonable).<br />    For them it's desirable to keep their decoded address range overlapping<br />    with the host RAM for simplicity if nothing else (I can imagine running<br />    out of address space with lots of memory and 32-bit PCI with no DAC<br />    support in the participating devices).<br /><br />     This is already the case with the i386 and ppc platform-specific PCI<br />    resource allocators.  Please consider the following change for the generic<br />    allocator.  Currently we have a pile of hacks implemented for host bridges<br />    to be left untouched and I'd be pleased to remove them.<br /><br />    From: "Maciej W. Rozycki" &lt;macro&#64;mips.com&gt;<br />    Signed-off-by: Greg Kroah-Hartman &lt;greg&#64;kroah.com&gt;<br /><br />and we've had other things where host bridges are special (ie iirc, if you <br />turn off PCI_COMMAND_MEM from a host bridge, it stops access to real RAM <br />from the CPU for some bridges - so you must never turn those things off or <br />you get a dead system).<br /><br />(But at least Intel host bridges will just ignore writes to the CMD <br />register, I think - you cannot turn MEM off).<br /><br />			Linus<br /><br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
