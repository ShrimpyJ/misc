    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2008/8/23/105">First message in thread</a></li><li><a href="/lkml/2008/8/25/312">"Alan D. Brunelle"</a><ul><li><a href="/lkml/2008/8/25/320">Linus Torvalds</a><ul><li><a href="/lkml/2008/8/25/322">Arjan van de Ven</a></li><li class="origin"><a href="/lkml/2008/8/25/331">Linus Torvalds</a><ul><li><a href="/lkml/2008/8/25/331">Linus Torvalds</a><ul><li><a href="/lkml/2008/8/26/23">Ingo Molnar</a></li><li><a href="/lkml/2008/8/26/241">Mike Travis</a></li></ul></li><li><a href="/lkml/2008/8/25/340">"Alan D. Brunelle"</a><ul><li><a href="/lkml/2008/8/25/358">Christoph Lameter</a></li></ul></li></ul></li><li><a href="/lkml/2008/8/26/108">Rusty Russell</a><ul><li><a href="/lkml/2008/8/26/197">Linus Torvalds</a><ul><li><a href="/lkml/2008/8/26/222">Adrian Bunk</a></li><li><a href="/lkml/2008/8/26/282">Jeff Garzik</a></li></ul></li></ul></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Mon, 25 Aug 2008 13:52:23 -0700 (PDT)</td></tr><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: [Bug #11342] Linux 2.6.27-rc3: kernel BUG at mm/vmalloc.c - bisected</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody"><br /><br />On Mon, 25 Aug 2008, Linus Torvalds wrote:<br />&gt; <br />&gt; But I'll look at your vmlinux, see what stands out.<br /><br />Oops. I already see the problem.<br /><br />Your .config has soem _huge_ CPU count, doesn't it?<br /><br />checkstack.pl shows these things as the top problems:<br /><br />	0xffffffff80266234 smp_call_function_mask [vmlinux]:    2736<br />	0xffffffff80234747 __build_sched_domains [vmlinux]:     2232<br />	0xffffffff8023523f __build_sched_domains [vmlinux]:     2232<br />	0xffffffff8021e884 setup_IO_APIC_irq [vmlinux]:         1616<br />	0xffffffff8021ee24 arch_setup_ht_irq [vmlinux]:         1600<br />	0xffffffff8021f144 arch_setup_msi_irq [vmlinux]:        1600<br />	0xffffffff8021e3b0 __assign_irq_vector [vmlinux]:       1592<br />	0xffffffff8021e626 __assign_irq_vector [vmlinux]:       1592<br />	0xffffffff8023257e move_task_off_dead_cpu [vmlinux]:    1592<br />	0xffffffff802326e8 move_task_off_dead_cpu [vmlinux]:    1592<br />	0xffffffff8025dbc5 tick_handle_oneshot_broadcast [vmlinux]:1544<br />	0xffffffff8025dcb4 tick_handle_oneshot_broadcast [vmlinux]:1544<br />	0xffffffff803f3dc4 store_scaling_governor [vmlinux]:    1376<br />	0xffffffff80279ef4 cpuset_write_resmask [vmlinux]:      1360<br />	0xffffffff803f465d cpufreq_add_dev [vmlinux]:           1352<br />	0xffffffff803f495b cpufreq_add_dev [vmlinux]:           1352<br />	0xffffffff803f3fc4 store_scaling_max_freq [vmlinux]:    1328<br />	0xffffffff803f4064 store_scaling_min_freq [vmlinux]:    1328<br />	0xffffffff803f44c4 cpufreq_update_policy [vmlinux]:     1328<br />	..<br /><br />and sys_init_module is actually way way down the list. I bet the only <br />reason it showed up at all was because dynamically it was such a deep <br />callchain, and part of that callchain probably called some of those really <br />nasty things.<br /><br />Anyway, the reason smp_call_function_mask and friends have such _huge_ <br />stack usages for you is that they contain a 'cpumask_t' on the stack.<br /><br />For example, for me, usign a sane NR_CPU, the size of the stack frame for <br />smp_call_function_mask is under 200 bytes.  For you, it's 2736 bytes.<br /><br />How about you make CONFIG_NR_CPU's something _sane_? Like 16? Or do you <br />really have four thousand CPU's in that system?<br /><br />Oh, I guess you have the MAXSMP config enabled? I really think that was a <br />bit too aggressive.<br /><br />		Linus<br /><br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
