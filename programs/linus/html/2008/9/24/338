    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2008/9/24/13">First message in thread</a></li><li><a href="/lkml/2008/9/24/249">Linus Torvalds</a><ul><li><a href="/lkml/2008/9/24/252">Steven Rostedt</a><ul><li><a href="/lkml/2008/9/24/336">Linus Torvalds</a><ul><li><a href="/lkml/2008/9/24/340">David Miller</a><ul><li><a href="/lkml/2008/9/24/351">Steven Rostedt</a></li><li><a href="/lkml/2008/9/24/352">"Martin Bligh"</a></li></ul></li><li><a href="/lkml/2008/9/24/344">Steven Rostedt</a><ul><li><a href="/lkml/2008/9/24/356">"Martin Bligh"</a></li></ul></li></ul></li></ul></li><li><a href="/lkml/2008/9/24/255">"Martin Bligh"</a><ul><li><a href="/lkml/2008/9/24/258">"Martin Bligh"</a><ul><li><a href="/lkml/2008/9/24/341">Linus Torvalds</a><ul><li><a href="/lkml/2008/9/24/354">"Martin Bligh"</a></li></ul></li></ul></li><li class="origin"><a href="/lkml/2008/9/24/353">Linus Torvalds</a><ul><li><a href="/lkml/2008/9/24/353">Mathieu Desnoyers</a><ul><li><a href="/lkml/2008/9/24/426">Linus Torvalds</a></li></ul></li><li><a href="/lkml/2008/9/25/284">Mathieu Desnoyers</a><ul><li><a href="/lkml/2008/9/25/293">Linus Torvalds</a></li></ul></li></ul></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Wed, 24 Sep 2008 13:30:15 -0700 (PDT)</td></tr><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: [RFC PATCH 1/3] Unified trace buffer</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody"><br /><br />On Wed, 24 Sep 2008, Martin Bligh wrote:<br />&gt; <br />&gt; If we just record the TSC unshifted, in 27 bits, at 4GHz, that gives us<br />&gt; about 1/30 of a second? So we either shift, use &gt; 27 bits, or record<br />&gt; at least 30 events a second, none of which I like much ...<br /><br />No, we don't shift (we don't want to lose precision), and we don't use <br />more than 27 bits by default.<br /><br />the TSC at each entry should be a _delta_. It's the difference from the <br />last one. And if you get less than 30 events per second, and you need a <br />bigger difference, you insert an extra "sync" tracepoint that has a 59-bit <br />thing (27 bits _plus_ the extra 'data').<br /><br />Yes, it adds 8 bytes (assuming that minimal format), but it does so only <br />for any trace event that is more than 1/30th of a second from its previous <br />one. IOW, think of this not in bytes, but in bytes-per-second. It adds at <br />most 8*30=240 bytes per second, but what it _saves_ is that when you have <br />tens of thousands of events, it shaves 4 bytes FOR EACH EVENT.<br /><br />See?<br /><br />Also, quite often, the clock won't be running at 4GHz even if the CPU <br />might. Intel already doesn't make the TSC be the nominal frequency, and <br />other architectures with TSC's have long had the TSC be something like a <br />"divide-by-16" clock rather than every single cycle because it's more <br />power-efficient.<br /><br />So there is often a built-in shift, and I doubt we'll see 10GHz TSC's even <br />if we see 10GHz CPU's (which many people consider unlikely anyway, but <br />I'm not going to bet against technology).<br /><br />			Linus<br /><br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
