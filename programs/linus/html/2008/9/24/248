    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2008/9/24/13">First message in thread</a></li><li><a href="/lkml/2008/9/24/218">Linus Torvalds</a><ul><li><a href="/lkml/2008/9/24/222">Steven Rostedt</a><ul><li><a href="/lkml/2008/9/24/239">"Martin Bligh"</a></li><li class="origin"><a href="">Linus Torvalds</a></li></ul></li><li><a href="/lkml/2008/9/24/259">Mathieu Desnoyers</a><ul><li><a href="/lkml/2008/9/24/355">Linus Torvalds</a></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><script type="text/javascript" src="//pagead2.googlesyndication.com/pagead/show_ads.js"></script><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Wed, 24 Sep 2008 10:25:57 -0700 (PDT)</td></tr><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: [RFC PATCH 1/3] Unified trace buffer</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody"><br /><br />On Wed, 24 Sep 2008, Steven Rostedt wrote:<br />&gt; <br />&gt; The event counter is just the timestamp (quick patch, simple to fix). The <br />&gt; term "counter" was bad. It should have been timestamp, which one would <br />&gt; want a 64bit timestamp.<br /><br />One definitely would _not_ want the full 64-bit timestamp.<br /><br />There are two cases:<br /><br /> - lots and lots of events<br /><br />   just do a 32 bit "timestamp delta" to the previous packet (where the <br />   first packet in the queue would be a delta from a value in the queue <br />   header - and we can obviously make that value be the TSC so that the <br />   first delta is always zero, but it may also make sense to make it a <br />   real delta, and the queue header would contain some good <br />   synchronization point value).<br /><br /> - occasional events<br /><br />   Oops. The delta wouldn't fit. So create a new "timestamp update" packet <br />   with a 64-bit thing when doing the reservation. There's obviously no <br />   cost issue (since this would only happen for things where there was a <br />   multi-second delay - or at least an appreciable fraction of a delay - <br />   between events)<br /><br />This definitely is worth doing. If we have small trace objects (and many <br />things really do have pretty small traces), using just a 32-bit TSC not <br />only saves 4 bytes per trace event, but it makes it quite reasonable to <br />keep the trace data 4-byte-aligned rather than requiring 8-byte alignment.<br /><br />Of course, if the traces end up being horribly bloated, none of that will <br />matter. But I really would hope that you we keep the header itself to just <br />8 bytes (and being 2 4-byte entities), so that small payloads are <br />reasonable. And that looks doable, if you have a 16-bit "type" and a <br />16-bit "size" field.<br /><br />One thing I'd like to do is to also architecturally reserve a few of the <br />types for internal queue management stuff. Things like "padding" objects <br />(or a "end-of-ringbuffer" object), and the TSC overflow object, and a <br />"time sync" object (or heartbeat). So maybe the type would have the high <br />bit set as a "reserved for internal ringbuffer use" or whatever.<br /><br />			Linus<br /><br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
