    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2008/9/24/13">First message in thread</a></li><li><a href="/lkml/2008/9/24/255">"Martin Bligh"</a><ul><li><a href="/lkml/2008/9/24/258">"Martin Bligh"</a><ul><li class="origin"><a href="/lkml/2008/9/24/354">Linus Torvalds</a><ul><li><a href="/lkml/2008/9/24/354">"Martin Bligh"</a><ul><li><a href="/lkml/2008/9/24/359">Steven Rostedt</a></li></ul></li></ul></li></ul></li><li><a href="/lkml/2008/9/24/338">Linus Torvalds</a><ul><li><a href="/lkml/2008/9/24/353">Mathieu Desnoyers</a><ul><li><a href="/lkml/2008/9/24/426">Linus Torvalds</a><ul><li><a href="/lkml/2008/9/24/433">Linus Torvalds</a></li><li><a href="/lkml/2008/9/25/314">Mathieu Desnoyers</a></li></ul></li></ul></li><li><a href="/lkml/2008/9/25/284">Mathieu Desnoyers</a><ul><li><a href="/lkml/2008/9/25/293">Linus Torvalds</a><ul><li><a href="/lkml/2008/9/25/301">Steven Rostedt</a></li></ul></li></ul></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Wed, 24 Sep 2008 13:39:54 -0700 (PDT)</td></tr><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: [RFC PATCH 1/3] Unified trace buffer</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody"><br /><br />On Wed, 24 Sep 2008, Martin Bligh wrote:<br />&gt; <br />&gt; If we use 32 bits instead of 27, then the timestamp events are only<br />&gt; about once per second, which is probably fine for overhead ... ?<br /><br />You'd have them ONCE IN A BLUE MOON.<br /><br />If there is nothing going on, you don't need the timestamps at all.<br /><br />Yes, some people will _want_ a heartbeat, of course, and there might be <br />serialization points where we want to serialize some external clock to the <br />TSC, but that's a separate issue from generating a full TSC value. We may <br />well decide that once a second we want a whole packet with TSC _and_ <br />HR-timer sync information, for example. But that's a separate issue.<br /><br />And if there is a lot of things going on (eg you're tracing things like a <br />block device performance issue), you have events _much_ closer to each <br />other than 1/30th of a second, and you again _never_ need a full 59-bit <br />timestamp. Because the delta would be cumulative, and as long as you are <br />generating events, you're also updating the base TSC.<br /><br />The only case you'll see lots of those timestamps (where "lots" is <br />guaranteed to be less than 30 in one second) would be if you're tracing <br />something that literally does a couple of events per second. But then you <br />sure as hell don't need to worry about performance _or_ memory use. If you <br />have some trace that gives you five hits per second (and spread out, to <br />boot!), you'll generate twice the number of trace entries because each <br />entry would always be preceded by an extended thing, but hey, do we really <br />worry about five trace events per second?<br /><br />And quite frankly, most of the tracing I've ever done really does fall <br />into the "either nothing" or "a flood of events" thing. The "5-25 events <br />per second at regular intervals" case really doesn't sound very common at <br />all - not that I would worry about it if it was since it's going to be a <br />really simple case..<br /><br />And btw, this would be an issue only on really fast CPU's anyway. If <br />you're in the mobile space, your TSC will be clocking at less than that, <br />so the slower the machine, the less the overhead. Again, that's exactly <br />what you want - the overhead is not some fixed thing that is detemined by <br />the fastest possible TSC and hurts slower machines too, it's relative to <br />the speed of the machine itself.<br /><br />(Of course, with cpufreq and fixed TSC's, a 2GHz CPU will have a 2GHz TSC <br />even when it's running at just 1GHz, but the worry is more about trying to <br />trace on an embedded board with some pitiful 500MHz thing that is pretty <br />overworked anyway).<br /><br />			Linus<br /><br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
