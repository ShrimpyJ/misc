    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2008/9/24/13">First message in thread</a></li><li><a href="/lkml/2008/9/25/219">"Martin Bligh"</a><ul><li><a href="/lkml/2008/9/25/229">Peter Zijlstra</a><ul><li class="origin"><a href="/lkml/2008/9/25/245">Linus Torvalds</a><ul><li><a href="/lkml/2008/9/25/245">"Martin Bligh"</a><ul><li><a href="/lkml/2008/9/25/254">Ingo Molnar</a></li></ul></li><li><a href="/lkml/2008/9/25/304">Steven Rostedt</a><ul><li><a href="/lkml/2008/9/25/315">Linus Torvalds</a></li></ul></li></ul></li><li><a href="/lkml/2008/9/25/249">Steven Rostedt</a></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><script type="text/javascript" src="//pagead2.googlesyndication.com/pagead/show_ads.js"></script><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Thu, 25 Sep 2008 08:05:46 -0700 (PDT)</td></tr><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: [RFC PATCH 1/3] Unified trace buffer</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody"><br /><br />On Thu, 25 Sep 2008, Peter Zijlstra wrote:<br />&gt; <br />&gt; Right - if you use raw tsc you're dependent on clock speed, if we'd<br />&gt; normalize that on ns instead you'd need at least: [...]<br /><br />Please don't normalize to ns.<br /><br />It's really quite hard, and it's rather _expensive_ on many CPU's. It <br />involves a non-constant 64-bit divide, after all. I bet it can be <br />optimized to be a multiply-by-inverse instead, but it would be a 128-bit <br />(or maybe just 96-bit?) multiply, and the code would be nasty, and likely <br />rather more expensive than the TSC reading itself.<br /><br />Sure, you have to normalize at _some_ point, and normalizing early might <br />make some things simpler, but the main thing that would become easier is <br />people messing about in the raw log buffer on their own directly, which <br />would hopefully be something that we'd discourage _anyway_ (ie we should <br />try to use helper functions for people to do things like "get the next <br />event data", not only because the headers are going to be odd due to <br />trying to pack things together, but because maybe we can more easily <br />extend on them later that way when nobody accesses the headers by hand).<br /><br />And I don't think normalizing later is in any way more fundamentally hard. <br />It just means that you do part of the expensive things after you have <br />gathered the trace, rather than during.<br /><br />			Linus<br /><br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
