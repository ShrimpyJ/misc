    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2008/7/20/118">First message in thread</a></li><li><a href="/lkml/2008/7/20/216">David Miller</a><ul><li><a href="/lkml/2008/7/21/17">David Miller</a><ul><li><a href="/lkml/2008/7/21/87">"Alexander Beregalov"</a><ul><li><a href="/lkml/2008/7/21/101">Ben Hutchings</a><ul><li><a href="/lkml/2008/7/21/223">David Miller</a></li></ul></li></ul></li><li><a href="/lkml/2008/7/21/146">Alexey Dobriyan</a><ul><li><a href="/lkml/2008/7/21/218">David Miller</a></li></ul></li><li class="origin"><a href="/lkml/2008/7/21/254">Linus Torvalds</a><ul><li><a href="/lkml/2008/7/21/254">David Miller</a></li></ul></li></ul></li></ul></li></ul><div class="threadlist">Patch in this message</div><ul class="threadlist"><li><a href="/lkml/diff/2008/7/21/253/1">Get diff 1</a></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Mon, 21 Jul 2008 09:49:49 -0700 (PDT)</td></tr><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: [GIT]: Networking</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody"><br /><br />On Sun, 20 Jul 2008, David Miller wrote:<br />&gt;<br />&gt; Alexey, please try this patch:<br />&gt; <br />&gt; atl1: Do not wake queue before queue has been started.<br /><br />David, can we please make this all a bit less fragile?<br /><br />There are _millions_ of network drivers, and these changes seem to have <br />broken not just common drivers, but also drivers that "work" seem to now <br />have broken suspend/resume.<br /><br />There's at least one report of suspend apparently oopsing now, and I <br />assume it's basically the same thing - it was bisected down to that same <br />37437bb2e1ae8af470dfcd5b4ff454110894ccaf commit ("pkt_sched: Schedule <br />qdiscs instead of netdev_queue.")<br /><br />Why is it so unnecessarily fragile to begin with? Especially for stuff <br />that happens at bootup or suspend, doing a BUG_ON() is _particularly_ <br />painful, because a dead machine means that you cannot get any logs or <br />anything else.<br /><br />So wouldn't it be *much* better to do something like the appended, and at <br />least try to limp on, and maybe have a system that people can get logs <br />out of?<br /><br />			Linus<br /><br />---<br /> net/core/dev.c |    3 ++-<br /> 1 files changed, 2 insertions(+), 1 deletions(-)<br /><br />diff --git a/net/core/dev.c b/net/core/dev.c<br />index 2eed17b..43ab4f5 100644<br />--- a/net/core/dev.c<br />+++ b/net/core/dev.c<br />&#64;&#64; -1325,7 +1325,8 &#64;&#64; static void dev_queue_xmit_nit(struct sk_buff *skb, struct net_device *dev)<br /> <br /> void __netif_schedule(struct Qdisc *q)<br /> {<br />-	BUG_ON(q == &amp;noop_qdisc);<br />+	if (WARN_ON_ONCE(q == &amp;noop_qdisc))<br />+		return;<br /> <br /> 	if (!test_and_set_bit(__QDISC_STATE_SCHED, &amp;q-&gt;state)) {<br /> 		struct softnet_data *sd;<br />---<br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
