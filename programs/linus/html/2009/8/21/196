    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2009/8/21/83">First message in thread</a></li><li><a href="/lkml/2009/8/21/83">tip-bot for Ingo Molnar</a><ul><li><a href="/lkml/2009/8/21/86">Ingo Molnar</a><ul><li><a href="/lkml/2009/8/21/93">Peter Zijlstra</a><ul><li><a href="/lkml/2009/8/21/101">Ingo Molnar</a></li></ul></li><li><a href="/lkml/2009/8/21/281">Andrew Morton</a><ul><li><a href="/lkml/2009/8/21/288">Linus Torvalds</a><ul><li><a href="/lkml/2009/8/21/299">Steven Rostedt</a></li><li><a href="/lkml/2009/8/21/307">Ingo Molnar</a></li></ul></li><li><a href="/lkml/2009/8/21/311">Ingo Molnar</a><ul><li><a href="/lkml/2009/8/21/319">Steven Rostedt</a></li></ul></li></ul></li></ul></li><li class="origin"><a href="/lkml/2009/8/21/204">Linus Torvalds</a><ul><li><a href="/lkml/2009/8/21/204">Ingo Molnar</a></li><li><a href="/lkml/2009/8/21/298">Arjan van de Ven</a></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Fri, 21 Aug 2009 09:05:25 -0700 (PDT)</td></tr><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: [tip:tracing/urgent] tracing: Fix too large stack usage in do_one_initcall()</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody"><br />So I obviously agree with fixing do_one_initcall(), but..<br /><br />Looking at the other cases, I do note (once more) what a horrible thing <br />SCSI is, and that the callchains are not only way too deep, but the SCSI <br />routines stand out among the cases that have 100+ bytes of stack frame.<br /><br />We _really_ should fix these:<br /><br />&gt;   5)     3444     116   __alloc_pages_nodemask+0xd7/0x550   <br />&gt;  10)     3216     108   create_object+0x28/0x250<br />&gt;  18)     2896     128   sd_prep_fn+0x332/0xa70<br />&gt;  23)     2640     172   blk_execute_rq+0x6b/0xb0<br />&gt;  46)     1532     108   scsi_add_lun+0x44b/0x460<br />&gt;  47)     1424     116   scsi_probe_and_add_lun+0x182/0x4e0<br /><br />I also note that in this case, we'd have gotten rid of a _lot_ of the <br />callchain if we had actually just executed this thing asynchronously. <br />Because we clearly have that __async_schedule() there in the callchain in <br />two places: before the port probing and the disk probing.<br /><br />But it looks like we hit the MAX_WORK limit. Which sounds odd, since that <br />is set to 32768, but I guess it can happen. It sounds a bit unlikely. <br />Ingo, do you have something set to disable that?<br /><br />I do wonder, though. Maybe we should never have that MAX_WORK limit, and <br />instead limit the parallelism by actively trying to yield when there's too <br />much work? That bootup sequence _does_ tend to have deep callchains (with <br />all the crazy device register crud), and maybe we should actively see the <br />async work code as not just a way to speed up boot, but also as a way to <br />avoid deep callchains.<br /><br />Hmm?  Comments?<br /><br />			Linus<br /><br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
