    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2009/8/2/82">First message in thread</a></li><li><a href="/lkml/2009/8/13/569">Linus Torvalds</a><ul><li><a href="/lkml/2009/8/14/241">Frans Pop</a><ul><li class="origin"><a href="/lkml/2009/8/14/255">Linus Torvalds</a><ul><li><a href="/lkml/2009/8/14/255">Frans Pop</a></li></ul></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Fri, 14 Aug 2009 10:04:07 -0700 (PDT)</td></tr><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: PCI resources allocation problem on Toshiba Satellite A40</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody"><br /><br />On Fri, 14 Aug 2009, Frans Pop wrote:<br /><br />&gt; On Friday 14 August 2009, Linus Torvalds wrote:<br />&gt; &gt; Can you send<br />&gt; &gt;  - output of /proc/ioports both with the current kernel (or the 2.6.30<br />&gt; &gt;    kernel - they should be identical) and with one of the kernels in<br />&gt; &gt;    between that didn't warn<br />&gt; &gt;  - send the full bootup dmesg with CONFIG_PCI_DEBUG enabled<br />&gt; &gt;<br />&gt; &gt; and we can probably figure it out.<br />&gt; <br />&gt; Attached.<br /><br />Ok, this one actually looks obvious from just the ioports thing:<br /><br />	--- ioports.a76117d     2009-08-14 18:44:42.000000000 +0200<br />	+++ ioports.current-git 2009-08-14 18:44:42.000000000 +0200<br />	...<br />	+18c0-18df : 0000:00:1d.0<br />	+  18c0-18df : uhci_hcd<br />	+18e0-18ff : 0000:00:1d.1<br />	+  18e0-18ff : uhci_hcd<br />	 bfa0-bfaf : 0000:00:1f.1<br />	   bfa0-bfaf : piix<br />	 c000-cfff : PCI Bus 0000:01<br />	   c000-c0ff : PCI CardBus 0000:02<br />	   c400-c4ff : PCI CardBus 0000:02<br />	   cf40-cf7f : 0000:01:08.0<br />	     cf40-cf7f : e100<br />	-  cf80-cf9f : 0000:00:1d.1<br />	-    cf80-cf9f : uhci_hcd<br />	-  cfe0-cfff : 0000:00:1d.0<br />	-    cfe0-cfff : uhci_hcd<br /><br />That old cf80-cf9f/cfe0-cfff location is just totally invalid. Your UHCI <br />device is (as it shows) PCI device 0000:00:1d, functions 0/1. In other <br />words, they are on PCI bus 0.<br /><br />But the c000-cfff area is a window that has been set up for PCI bus 1.<br /><br />The ioports.a76117d version is simply wrong. The Linux PCI layer did the <br />right thing, and moved the silly device away from that PCI bus 1 window.<br /><br />Now, it so happens that I bet it does _work_ in there, but that's likely <br />because that 0000:00:1d.x device is on the southbridge chip itself, and it <br />probably simply gets decoded before it any access is even sent out on the <br />PCI bus and hits the bridge for bus#1. But the fact is, your BIOS has <br />simply set up the devices in a totally insane way, and I think the kernel <br />did everything right.<br /><br />So the fact that it "worked" for a few kernels was simply due to a kernel <br />bug, where "pci_claim_resource()" incorrectly allowed the resource to be <br />inserted into a resource window that wasn't actually its parent, and a <br />crazy BIOS that did crazy things, together with a chipset where those <br />crazy things just _happened_ to work because of how decoding was done.<br /><br />			Linus<br /><br /><br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
