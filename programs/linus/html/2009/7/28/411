    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2009/7/27/72">First message in thread</a></li><li><a href="/lkml/2009/7/28/355">Kyle Moffett</a><ul><li><a href="/lkml/2009/7/28/364">Linus Torvalds</a></li><li><a href="/lkml/2009/7/28/371">Alan Cox</a></li><li><a href="/lkml/2009/7/28/391">Andi Kleen</a><ul><li class="origin"><a href="/lkml/2009/7/28/419">Linus Torvalds</a><ul><li><a href="/lkml/2009/7/28/419">Andi Kleen</a></li><li><a href="/lkml/2009/7/28/464">Theodore Tso</a></li></ul></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Tue, 28 Jul 2009 13:50:56 -0700 (PDT)</td></tr><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: [PATCH] Allow userspace block device implementation</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody"><br /><br />On Tue, 28 Jul 2009, Andi Kleen wrote:<br /><br />&gt; Kyle Moffett &lt;kyle&#64;moffetthome.net&gt; writes:<br />&gt; &gt;<br />&gt; &gt;   (1) The ability to rearrange, resize, and restructure<br />&gt; &gt; partition-tables on the fly.  The existing "re-read partition tables"<br />&gt; &gt; infrastructure does not safely and reasonably handle changes to the<br />&gt; &gt; partition-table while partitions are mounted. <br />&gt; <br />&gt; It doesn't today (and I really hate it too), but is there a hard reason it<br />&gt; couldn't be fixed to support that properly? <br /><br />If something has a partition open (and it doesn't really even have to be a <br />mounted filesystem, altough that's obviously the most relevant case), how <br />can you reasonably change the partition from underneath it? So I assume <br />you mean that partitions were opened earlier (for a mount) would not be <br />touched.<br /><br />And these days, that _should_ just work. The "reread partition table" <br />operation should just leave the old bdev's around (so a mounted filesystem <br />simply won't _see_ the new partitions, but will continue to use the old <br />one), and for all I know that might even work these days.<br /><br />[ Here "these days" is admittedly only in comparison to the _original_ <br /> Linux code, which used block numbers. Many years ago. ]<br /><br />Filesystems long ago _used_ to index things by device number and block - <br />and that meant that re-reading partition tables was _really_ dangerous, <br />because the "device number" would just magically mean something else for a <br />mounted filesystem. But we've indexed things by bdev for a longish time <br />now, and most (all?) filesystems use "sb_bread()" instead of bread etc.<br /><br />So I think re-reading the partition tables should be safe these days. It <br />definitely didn't _use_ to be the case due to dev_t issues, but that's <br />really ancient.<br /><br />It may be that we just have the old check in place ("don't allow <br />re-reading if something has mounted a partition"), and we could just get <br />rid of it. I have not looked. <br /><br />But if you actually meant that re-reading the partition table should <br />_change_ a "struct block_dev" that is in use, then I think that would be a <br />bad idea. At the very least, it should involve a re-mount or something.<br /><br />		Linus<br /><br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
