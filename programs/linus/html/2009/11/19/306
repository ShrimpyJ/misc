    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2009/11/18/370">First message in thread</a></li><li><a href="/lkml/2009/11/19/300">Linus Torvalds</a><ul><li><a href="/lkml/2009/11/19/301">Linus Torvalds</a><ul><li class="origin"><a href="/lkml/2009/11/19/310">Linus Torvalds</a><ul><li><a href="/lkml/2009/11/19/310">Thomas Gleixner</a><ul><li><a href="/lkml/2009/11/23/52">Jakub Jelinek</a></li></ul></li><li><a href="/lkml/2009/11/19/312">David Daney</a><ul><li><a href="/lkml/2009/11/19/313">Steven Rostedt</a></li></ul></li></ul></li></ul></li></ul></li></ul><div class="threadlist">Patch in this message</div><ul class="threadlist"><li><a href="/lkml/diff/2009/11/19/306/1">Get diff 1</a></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Thu, 19 Nov 2009 10:54:42 -0800 (PST)</td></tr><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: BUG: GCC-4.4.x changes the function frame on some functions</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody"><br /><br />On Thu, 19 Nov 2009, Linus Torvalds wrote:<br />&gt; <br />&gt; I bet other people than just the kernel use the mcount hook for subtler <br />&gt; things than just doing profiles. And even if they don't, the quoted code <br />&gt; generation is just crazy _crap_.<br /><br />For the kernel, if the only case is that timer_stat.c thing that Thomas <br />pointed at, I guess we can at least work around it with something like the <br />appended. The kernel code is certainly ugly too, no question about that. <br /><br />It's just that we'd like to be able to depend on mcount code generation <br />not being insane even in the presense of ugly code..<br /><br />The alternative would be to have some warning when this happens, so that <br />we can at least see it. "mcount won't work reliably"<br /><br />		Linus<br /><br />---<br /> kernel/time/timer_stats.c |    4 ++--<br /> 1 files changed, 2 insertions(+), 2 deletions(-)<br /><br />diff --git a/kernel/time/timer_stats.c b/kernel/time/timer_stats.c<br />index ee5681f..488c7b8 100644<br />--- a/kernel/time/timer_stats.c<br />+++ b/kernel/time/timer_stats.c<br />&#64;&#64; -76,7 +76,7 &#64;&#64; struct entry {<br /> 	 */<br /> 	char			comm[TASK_COMM_LEN + 1];<br /> <br />-} ____cacheline_aligned_in_smp;<br />+};<br /> <br /> /*<br />  * Spinlock protecting the tables - not taken during lookup:<br />&#64;&#64; -114,7 +114,7 &#64;&#64; static ktime_t time_start, time_stop;<br /> #define MAX_ENTRIES		(1UL &lt;&lt; MAX_ENTRIES_BITS)<br /> <br /> static unsigned long nr_entries;<br />-static struct entry entries[MAX_ENTRIES];<br />+static struct entry entries[MAX_ENTRIES] ____cacheline_aligned_in_smp;<br /> <br /> static atomic_t overflow_count;<br /> <br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
