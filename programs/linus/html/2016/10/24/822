    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2016/10/24/717">First message in thread</a></li><li><a href="/lkml/2016/10/24/717">Jarod Wilson</a><ul><li class="origin"><a href="/lkml/2016/10/24/895">Linus Torvalds</a><ul><li><a href="/lkml/2016/10/24/895">Josh Boyer</a><ul><li><a href="/lkml/2016/10/24/899">Linus Torvalds</a><ul><li><a href="/lkml/2016/10/24/908">Jarod Wilson</a></li></ul></li></ul></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><script type="text/javascript" src="//pagead2.googlesyndication.com/pagead/show_ads.js"></script><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Mon, 24 Oct 2016 12:24:31 -0700</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: Linux-4.X-rcY patches can't be applied with git?</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody">On Mon, Oct 24, 2016 at 11:25 AM, Jarod Wilson &lt;jarod&#64;redhat.com&gt; wrote:<br />&gt; It's entirely possible that we (Red Hat and the Fedora kernel team) are<br />&gt; doing something wrong here, but to the best of our knowledge, it seems<br />&gt; that the canonical upstream RC snap patches can't be applied to a tree<br />&gt; using either git or old-fashioned patch.<br /><br />No, you're not imagining it, it's definitely happening.<br /><br />What is going on is that I generate patches without the "--binary"<br />flag, which means that git skips the binary diffs entirely. So the<br />diff just contains<br /><br />   Binary files<br />a/Documentation/media/media_api_files/typical_media_device.pdf and<br />b/Documentation/media/media_api_files/typical_media_device.pdf differ<br /><br />Then, when you do "git apply", "git apply" will see that, and try to<br />use the index lines to regenerate the thing, which obviously only<br />works in a repository that already _has_ those objects.<br /><br />This is actually not new. I've skipped binary files for the last ten<br />years or so in the diffs, because the diffs are completely illegible,<br />and nobody has ever cared - and non-git users haven't been able to use<br />them anyway.<br /><br />Obviously, part of it is too that we simply don't have very many<br />binary files, so it almost never ends up being a problem. The<br />documentation changes made them happen now.<br /><br />But quite frankly, I see the tar-balls and diffs as a way to have<br />non-git people have a minimally working system, and their *only* point<br />is for people who don't have git.<br /><br />And since plain "patch" cannot handle git binary diffs anyway, there<br />was never any valid reason to include the binary diffs in the diff.<br /><br />Btw, this is why the diffs don't have renames either.<br /><br />The diffs would often be much smaller, and certainly much more<br />legible, if I used the "-M" or "-C" flags, but since the primary<br />reason for the tarballs and diffs existing is for non-git users, and<br />traditional "patch" doesn't understand rename diffs, I don't do it.<br /><br />(Yes, modern GNU patch has actually grown support for rename diffs,<br />although last I looked it gets it wrong for some of the more complex<br />cases - notably cross renames).<br /><br />Summary:<br /><br /> - if you have git, you shouldn't use the tar-balls and patches<br /><br /> - if you don't have git, binary patches and renames wouldn't work for<br />you anyway, so generating them is pointless and would potentially keep<br />you from getting a working tree.<br /><br />I could easily add "--binary" to my script, because I _think_<br />traditional "patch" will just ignore it as noise, but I'd honestly<br />rather discourage people from downloading full tar-balls in the first<br />place.<br /><br />Hmm?<br /><br />               Linus<br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
