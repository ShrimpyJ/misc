    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2016/7/23/3">First message in thread</a></li><li><a href="/lkml/2016/7/23/3">Andy Lutomirski</a><ul><li><a href="/lkml/2016/7/23/35">tip-bot for Andy Lutomirski</a><ul><li class="origin"><a href="/lkml/2016/7/23/128">Linus Torvalds</a><ul><li><a href="/lkml/2016/7/23/128">Ingo Molnar</a></li></ul></li></ul></li><li><a href="/lkml/2016/7/23/129">tip-bot for Andy Lutomirski</a><ul><li><a href="/lkml/2016/7/23/134">Nicolai Stange</a></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><script type="text/javascript" src="//pagead2.googlesyndication.com/pagead/show_ads.js"></script><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Sat, 23 Jul 2016 17:32:03 +0900</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: [tip:x86/mm] x86/mm/cpa: Fix populate_pgd(): Stop trying to deallocate failed PUDs</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody">On Sat, Jul 23, 2016 at 4:46 PM, tip-bot for Andy Lutomirski<br />&lt;tipbot&#64;zytor.com&gt; wrote:<br />&gt;<br />&gt; Fixing this directly is difficult or impossible because of the awful<br />&gt; state of Linux's page table accessors.<br /><br />Quite frankly, this part of the message is misleading and wrong.<br /><br />The "awful state" is purely "Andy didn't understand the folding".<br />There is nothing awful about it, quite the reverse. It is what allows<br />the generic code to mostly not have to care whether a particular level<br />actually exists or not, or is just folded into the next-higher level.<br />No, we don't alway have<br /><br />I do agree that our *naming* is not great, and that when we get<br />five-level page tables we should strive to start having numbers<br />instead of the magic letters. The magic letters made sense with three<br />levels that had fairly well-known names (pgd/pmd/pte is not a Linux<br />invention), but with four levels it's already fairly questionable.<br /><br />But the fact that a pud may not even exist, and in fact is just<br />another nested version of the pgd, is definitely *not* awful. And Andy<br />not understanding it and getting it wrong *still* doesn't make it<br />awful.<br /><br />Yes, a folded level can be subtle. The level above the folded level<br />has no actual storage of its own, it just contains the folded level<br />directly. We've had confusion about it, and the naming really doesn't<br />help. But looking through include/asm-generic/pgtable-nopmd.h can<br />actually be instructive.<br /><br />Calling something "awful" just because it's clever and you didn't<br />understand it is not right.<br /><br />It would be *truly* awful if we forced everybody to actually have all<br />the levels, and then had to follow idiotic single-entry pointers at<br />the upper end that doesn't actually exist in reality, and we'd just<br />have these silly "software-only" levels to make everything be four<br />levels even if the hardware only does two.<br /><br />That would be awful, because it would be *stupid*.<br /><br />             Linus<br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
