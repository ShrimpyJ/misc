    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/1997/4/26/29">First message in thread</a></li><li><a href="/lkml/1997/4/26/52">Linus Torvalds</a><ul><li><a href="/lkml/1997/4/26/54">Ingo Molnar</a><ul><li><a href="/lkml/1997/4/27/7">"Theodore Y. Ts'o"</a><ul><li><a href="/lkml/1997/4/27/12">Ingo Molnar</a></li></ul></li></ul></li><li><a href="/lkml/1997/4/27/19">(Alan Cox)</a><ul><li class="origin"><a href="">Linus Torvalds</a></li><li><a href="/lkml/1997/4/27/37">"Theodore Y. Ts'o"</a></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Sun, 27 Apr 1997 09:55:03 -0700 (PDT)</td></tr><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: Patches to speed up SLIP and PPP</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody"><br /><br />On Sun, 27 Apr 1997, Alan Cox wrote:<br />&gt; &gt; In short, I'd much rather see a patch that<br />&gt; &gt;  (a) gets rid of the "fast" vs "slow" interrupts. They used to make sense,<br />&gt; &gt;      but they don't much do that any more. They only result in problems.<br />&gt; <br />&gt; You rejected one of those prior to 1.2 that came from the STRIP driver<br />&gt; authors.<br /><br />Yes. Note the "prior to 1.2". People have had patches like this floating<br />around for quite some time, but the timing has been bad. I think I<br />actually got a similar patch just before 2.0 too - and I'm definitely not<br />likely to change basic irq behaviour before making a stable release.. <br /><br />&gt; As to the structure of it. I'd rather mark_bh() set the flag so the fast<br />&gt; interrupt return wasnt taken. Or maybe mark_bh_nodefer()<br /><br />mark_bh() already sets the flag that indicates we want to do the bh, it<br />makes no sense to have that set any other flag. If we wanted that we might<br />as well just always test bh_mask and bh_active. <br /><br />What we want to have is to allow the interrupt handler to set the bottom<br />half bit, but _also_ say that "yes, I set the bit, but there is no<br />overwhelming reason to act on it immediately on return as I'm likely to<br />gather more data".<br /><br />So if anything, we want to have "mark_bh_defer()", not nodefer. But the<br />act of delaying is really conceptually totally separate from the act of<br />marking the bottom half.  Which is why I don't want to mix them. <br /><br />Having the interrupt routine return a status word is really good, because<br />that can be used for other things too. If you look at the current irq.c<br />code for interrupt dispatch, you can see that we already _have_ the status<br />word, but the problem is that it is fixed (action-&gt;flags).<br /><br />So instead of having this fixed status word, we'd have the irq handler<br />return the status it wants at run-time (the status word currently contains<br />information about whether it is a fast or slow interrupt, but also whether<br />we should use this interrupt for the randomizing stuff). Potentially we<br />can then add other dynamic flags. <br /><br />		Linus<br /><br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
