    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/1997/12/30/25">First message in thread</a></li><li><a href="/lkml/1997/12/30/25">Gordon Chaffee</a><ul><li><a href="/lkml/1997/12/30/35">Regis Duchesne</a><ul><li><a href="/lkml/1997/12/30/50">Martin von Loewis</a></li></ul></li><li class="origin"><a href="/lkml/1997/12/30/95">(Linus Torvalds)</a><ul><li><a href="/lkml/1997/12/30/95">linux kernel account</a></li><li><a href="/lkml/1997/12/31/7">Gordon Chaffee</a><ul><li><a href="/lkml/1997/12/31/84">Linus Torvalds</a><ul><li><a href="/lkml/1998/1/13/176">Gordon Chaffee</a></li></ul></li></ul></li></ul></li><li><a href="/lkml/1997/12/30/41">Martin von Loewis</a><ul><li><a href="/lkml/1997/12/30/51">Andi Kleen</a></li><li><a href="/lkml/1997/12/31/9">Gordon Chaffee</a><ul><li><a href="/lkml/1997/12/31/13">Martin von Loewis</a><ul><li><a href="/lkml/1997/12/31/17">Gordon Chaffee</a></li></ul></li><li><a href="/lkml/1997/12/31/34">Bill Hawes</a><ul><li><a href="/lkml/1997/12/31/68">Gordon Chaffee</a></li><li><a href="/lkml/1997/12/31/69">Bill Hawes</a></li></ul></li></ul></li></ul></li><li><a href="/lkml/1997/12/31/1">Gordon Chaffee</a></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><script type="text/javascript" src="//pagead2.googlesyndication.com/pagead/show_ads.js"></script><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">From</td><td class="rp" itemprop="author">(Linus Torvalds)</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: dcache questions</td></tr><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">30 Dec 1997 16:10:19 GMT</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody">In article &lt;199712301225.EAA29094&#64;quimby.cs.berkeley.edu&gt;,<br />Gordon Chaffee  &lt;chaffee&#64;quimby.cs.berkeley.edu&gt; wrote:<br />&gt;I'm having some significant problems trying to get the vfat filesystem<br />&gt;to work properly with the dcache.  Basically, the problem is caused by<br />&gt;the vfat filename handling.  For each long filename, there is an alias<br />&gt;that refers to the same file or directory.  For example, for the filename<br />&gt;LongFileName, there is an alias called longfi~1.<br />&gt;<br />&gt;For a directory tree, I could have something like:<br />&gt;  Long:  Program Files/GNU Emacs/LongFileName.exe<br />&gt;  Alias: progra~1/gnuema~1/longfi~1.exe<br />&gt;<br />&gt;One can also refer to LongFileName.exe via one of any combination of<br />&gt;aliased directory names:<br />&gt;         progra~1/GNU Emacs/LongFileName.exe<br />&gt;         Program Files/gnuema~1/longfi~1.exe<br />&gt;<br />&gt;This really starts messing with the dcache since there is not a unique<br />&gt;dentry for any filename or directory.<br /><br />Indeed. That's nasty.<br /><br />&gt;I decided I would try to handle the problem with aliases by not putting<br />&gt;any dentries in the dcache for filenames that are aliases or for filenames<br />&gt;that haven't been found.  This way, there would only be one dentry per<br />&gt;directory and file.<br /><br />No, as you found out that doesn't work. The VFS really depends on the<br />dentries existing.<br /><br />The real solution is as far as I can tell:<br /> - don't allow the short aliases at all - only show LongFileName.exe,<br />   and never show or accept longfi~1.exe. This is the quick and <br />   dirty fix. Not recommended, and probably hard.<br /> - make the filesystem-specific hashing and name comparing functions<br />   compare the two names as equal - so that only one dentry exists for<br />   both of them.  This is the "real" fix, but depending on how the name<br />   mangling works it may not be all that easy. <br /><br />The real fix may mean that you can only use the first six characters for<br />the hash (and you have to mush together cases, obviously), and then<br />making sure the lookup function compares the strange endings correctly<br />too. <br /><br />So the VFS dentry layer does support these kinds of aliases, but it may<br />be extremely non-trivial to actually get the compare functions working<br />correctly.  You may end up having to do pretty much the same as you do<br />in the filename lookup function in the name compare code.. <br /><br />		Linus<br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
