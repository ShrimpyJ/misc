    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/1997/7/25/9">First message in thread</a></li><li><a href="/lkml/1997/7/25/9">Martin von Loewis</a><ul><li><a href="/lkml/1997/7/25/26">Andreas Schwab</a><ul><li class="origin"><a href="/lkml/1997/7/26/21">Linus Torvalds</a><ul><li><a href="/lkml/1997/7/26/21">Martin von Loewis</a><ul><li><a href="/lkml/1997/7/26/27">Michael Harnois</a></li><li><a href="/lkml/1997/7/26/39">Michael Harnois</a></li></ul></li></ul></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Fri, 25 Jul 1997 09:35:46 -0700 (PDT)</td></tr><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: VFAT 2.1.47</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody"><br /><br />On Fri, 25 Jul 1997, Andreas Schwab wrote:<br />&gt;<br />&gt; Martin von Loewis &lt;martin&#64;mira.isdn.cs.tu-berlin.de&gt; writes:<br />&gt; <br />&gt; |&gt; Below is my attempt of a vfat fix for Linux 2.1.47. <br />&gt; |&gt; Please review.<br />&gt; <br />&gt; There is likely to be one problem that i also tripped along while porting<br />&gt; msdos: you must not return ENOENT from lookup, instead only the fact that<br />&gt; dentry-&gt;d_inode is NULL tells the VFS that the file does not exist.  Thus<br />&gt; you should change all `return -ENOENT' in vfat_lookup to `return 0'.  This<br />&gt; also includes the implicit ENOENT that you may get from vfat_find.<br /><br />Right. The reason you have to do this is because the VFS layer actually<br />uses the negative dentry for a few things:<br /><br /> - it's a negative cache, so that the VFS layer doesn't need to call down<br />   to the filesystem the next time around if somebody keep trying to look<br />   up nonexistent files (which happens a lot with path lookup, for<br />   example). <br /><br /> - a negative dentry is also a placeholder for _becoming_ a real dentry. <br />   When you create a new file, you will do a lookup of the file which will<br />   start out as a negative dentry, and then the create function will turn<br />   that negative dentry into a real dentry.<br /><br />The second use for negative dentries allows us to do various things a lot<br />more cleanly than the old code did - creating a new file by following a<br />symlink is just one of these. The old code had to do this in two stages: <br />first look up all but the last part of the filename, and then handle the<br />last part specially. The new dentry code avoids all special cases, to a<br />large degree thanks to using negative dentries. <br /><br />			Linus<br /><br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
