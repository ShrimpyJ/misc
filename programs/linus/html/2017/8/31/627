    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2017/8/31/513">First message in thread</a></li><li><a href="/lkml/2017/8/31/513">Josh Poimboeuf</a><ul><li><a href="/lkml/2017/8/31/514">Josh Poimboeuf</a><ul><li class="origin"><a href="/lkml/2017/8/31/683">Linus Torvalds</a><ul><li><a href="/lkml/2017/8/31/683">Josh Poimboeuf</a><ul><li><a href="/lkml/2017/8/31/687">Josh Poimboeuf</a></li><li><a href="/lkml/2017/9/15/262">Andrey Ryabinin</a></li></ul></li></ul></li></ul></li><li><a href="/lkml/2017/8/31/515">Josh Poimboeuf</a><ul><li><a href="/lkml/2017/8/31/530">Peter Zijlstra</a><ul><li><a href="/lkml/2017/8/31/553">Josh Poimboeuf</a><ul><li><a href="/lkml/2017/8/31/568">Dmitry Vyukov</a></li></ul></li></ul></li></ul></li><li><a href="/lkml/2017/8/31/516">Josh Poimboeuf</a></li><li><a href="/lkml/2017/8/31/517">Josh Poimboeuf</a></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><script type="text/javascript" src="//pagead2.googlesyndication.com/pagead/show_ads.js"></script><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Thu, 31 Aug 2017 09:11:54 -0700</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: [RFC PATCH 3/4] x86/asm: Make alternative macro interfaces more clear and consistent</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody">On Thu, Aug 31, 2017 at 7:11 AM, Josh Poimboeuf &lt;jpoimboe&#64;redhat.com&gt; wrote:<br />&gt;<br />&gt; Make the following changes:<br />&gt;<br />&gt; - Give alternative_io(), alternative_call(), and alternative_call_2()<br />&gt;   consistent interfaces.  The constraints are provided by use of the<br />&gt;   OUTPUTS(), INPUTS(), and CLOBBERS() macros.<br /><br />I really think those macro names are way too generic. Putting them in<br />a core header file and expecting people to never use them is wrong.<br /><br />So please rename things like "OUTPUTS()" to "ASM_OUTPUTS()" or something.<br /><br />Yes, it might look slightly worse in the asm expansion.  And no, we<br />don't actually seem to have anybody using those right now, but I did<br />find people using both OUTPUT and INPUT in some C files, so those<br />names are clearly not very unique or distinct.<br /><br />On the whole, I'm not entirely sure this is the right approach. I<br />think we should<br /><br /> (a) approach clang about their obvious bug (a compiler that clobbers<br />%rsp because we mark it as in/out is clearly buggy)<br /><br /> (b) ask gcc people if there's some other alternative that would work<br />with clang as-is rather than the "mark %rsp register as clobbered"<br /><br />I couldn't actually find the %rsp trick in any docs, I assume it came<br />from discussions with gcc developers directly. Maybe there is<br />something else we could do that doesn't upset clang?<br /><br />Perhaps we can mark the frame pointer as an input, for example? Inputs<br />also have the advantage that appending to the input list doesn't<br />change the argument numbering, so we don't need to worry about<br />numbered arguments (not that I mind the naming of arguments, but I<br />kind of hate having to do it as part of this series).<br /><br />Hmm?<br /><br />              Linus<br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
