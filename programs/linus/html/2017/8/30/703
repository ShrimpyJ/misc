    </div></td><td width="32"> </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2017/8/29/805">First message in thread</a></li><li><a href="/lkml/2017/8/29/818">=?UTF-8?q?J=C3=A9r=C3=B4me=20Glisse?=</a><ul><li><a href="/lkml/2017/8/29/878">Nadav Amit</a><ul><li><a href="/lkml/2017/8/29/882">Jerome Glisse</a><ul><li><a href="/lkml/2017/8/29/895">Nadav Amit</a><ul><li><a href="/lkml/2017/8/29/896">Nadav Amit</a></li></ul></li></ul></li><li><a href="/lkml/2017/8/30/539">Andrea Arcangeli</a><ul><li><a href="/lkml/2017/8/30/570">Nadav Amit</a><ul><li><a href="/lkml/2017/8/30/689">Andrea Arcangeli</a></li></ul></li><li><a href="/lkml/2017/8/30/589">Jerome Glisse</a><ul><li><a href="/lkml/2017/8/30/599">Nadav Amit</a></li></ul></li></ul></li></ul></li><li><a href="/lkml/2017/8/30/512">Andrea Arcangeli</a><ul><li><a href="/lkml/2017/8/30/558">Jerome Glisse</a></li><li class="origin"><a href="/lkml/2017/8/30/738">Linus Torvalds</a><ul><li><a href="/lkml/2017/8/30/738">Andrea Arcangeli</a><ul><li><a href="/lkml/2017/8/31/717">Jerome Glisse</a></li></ul></li></ul></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><script type="text/javascript" src="//pagead2.googlesyndication.com/pagead/show_ads.js"></script><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Wed, 30 Aug 2017 14:53:38 -0700</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: [PATCH 02/13] mm/rmap: update to new mmu_notifier semantic</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody">On Wed, Aug 30, 2017 at 9:52 AM, Andrea Arcangeli &lt;aarcange&#64;redhat.com&gt; wrote:<br />&gt;<br />&gt; I pointed out in earlier email -&gt;invalidate_range can only be<br />&gt; implemented (as mutually exclusive alternative to<br />&gt; -&gt;invalidate_range_start/end) by secondary MMUs that shares the very<br />&gt; same pagetables with the core linux VM of the primary MMU, and those<br />&gt; invalidate_range are already called by<br />&gt; __mmu_notifier_invalidate_range_end.<br /><br />I have to admit that I didn't notice that fact - that we are already<br />in the situation that<br />invalidate_range is called by by the rand_end() nofifier.<br /><br />I agree that that should simplify all the code, and means that we<br />don't have to worry about the few cases that already implemented only<br />the "invalidate_page()" and "invalidate_range()" cases.<br /><br />So I think that simplifies Jérôme's patch further - once you have put<br />the range_start/end() cases around the inner loop, you can just drop<br />the invalidate_page() things entirely.<br /><br />&gt; So this conversion from invalidate_page to invalidate_range looks<br />&gt; superflous and the final mmu_notifier_invalidate_range_end should be<br />&gt; enough.<br /><br />Yes. I missed the fact that we already called range() from range_end().<br /><br />That said, the double call shouldn't hurt correctness, and it's<br />"closer" to old behavior for those people who only did the range/page<br />ones, so I wonder if we can keep Jérôme's patch in its current state<br />for 4.13.<br /><br />Because I still want to release 4.13 this weekend, despite this<br />upheaval. Otherwise I'll have timing problems during the next merge<br />window.<br /><br />Andrea, do you otherwise agree with the whole series as is?<br /><br />            Linus<br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
