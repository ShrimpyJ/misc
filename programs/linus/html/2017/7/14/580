    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2017/7/13/757">First message in thread</a></li><li><a href="/lkml/2017/7/13/757">Anna Schumaker</a><ul><li><a href="/lkml/2017/7/13/770">Linus Torvalds</a><ul><li><a href="/lkml/2017/7/14/72">Christoph Hellwig</a><ul><li><a href="/lkml/2017/7/14/226">Anna Schumaker</a></li></ul></li></ul></li><li><a href="/lkml/2017/7/14/436">Dave Jones</a><ul><li><a href="/lkml/2017/7/14/521">"J. Bruce Fields"</a></li><li class="origin"><a href="/lkml/2017/7/14/600">Linus Torvalds</a><ul><li><a href="/lkml/2017/7/14/600">Andrey Ryabinin</a><ul><li><a href="/lkml/2017/7/14/604">Linus Torvalds</a></li></ul></li><li><a href="/lkml/2017/7/14/601">Dave Jones</a></li></ul></li><li><a href="/lkml/2017/7/16/479">Dave Jones</a><ul><li><a href="/lkml/2017/7/16/490">Trond Myklebust</a><ul><li><a href="/lkml/2017/7/16/558">""</a></li></ul></li></ul></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Fri, 14 Jul 2017 12:05:02 -0700</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: [GIT PULL] Please pull NFS client changes for Linux 4.13</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody">On Fri, Jul 14, 2017 at 7:25 AM, Dave Jones &lt;davej&#64;codemonkey.org.uk&gt; wrote:<br />&gt; On Thu, Jul 13, 2017 at 05:16:24PM -0400, Anna Schumaker wrote:<br />&gt;  &gt;<br />&gt;  &gt;   git://git.linux-nfs.org/projects/anna/linux-nfs.git tags/nfs-for-4.13-1<br />&gt;<br />&gt; Since this landed, I'm seeing this during boot..<br />&gt;<br />&gt;  ==================================================================<br />&gt;  BUG: KASAN: global-out-of-bounds in strscpy+0x4a/0x230<br />&gt;  Read of size 8 at addr ffffffffb4eeaf20 by task nfsd/688<br /><br />Is KASAN aware that strscpy() does the word-at-a-time optimistic reads<br />of the sources?<br /><br />The problem may be that the source is initialized from the global<br />string "nfsd", and KASAN may be unhappy abotu the fact that we read 8<br />bytes from a 5-byte string (four plus NUL) as we do the word-at-a-time<br />strscpy..<br /><br />That said, we do check the size first (because we also *write* 8 bytes<br />at a time), so maybe KASAN shouldn't even need to care.<br /><br />Hmm. it really looks to me like this is actually a compiler bug (I'm<br />using current gcc in F26, which is gcc-7.1.1 - I'm assuming DaveJ is<br />the same).<br /><br />This is the source code in __ip_map_lookup:<br /><br />        struct ip_map ip;<br />     .....<br />        strcpy(ip.m_class, class);<br /><br />and "m_class" is 8 bytes in size:<br /><br />    struct ip_map {<br />    ...<br />            char                    m_class[8]; /* e.g. "nfsd" */<br />    ...<br /><br />yet when I look at the generated code for __ip_map_lookup, I see<br /><br />        movl    $32, %edx       #,<br />        movq    %r13, %rsi      # class,<br />        leaq    48(%rax), %rdi  #, tmp126<br />        call    strscpy #<br /><br />what's the bug here? Look at that third argument - %rdx. It is<br />initialized to 32.<br /><br />WTF?<br /><br />The code to turn "strcpy()" into "strscpy()" should pick the *smaller*<br />of the two object sizes as the size argument. How the hell is that<br />size argument 32?<br /><br />Am I missing something? DaveJ, do you see the same?<br /><br />                       Linus<br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
