    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2017/12/1/742">First message in thread</a></li><li><a href="/lkml/2017/12/10/129">Linus Torvalds</a><ul><li><a href="/lkml/2017/12/10/155">"Paul E. McKenney"</a><ul><li><a href="/lkml/2017/12/11/642">Kees Cook</a><ul><li><a href="/lkml/2017/12/12/830">"Paul E. McKenney"</a></li></ul></li></ul></li><li><a href="/lkml/2017/12/13/373">Michael Ellerman</a><ul><li class="origin"><a href="">Linus Torvalds</a></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Wed, 13 Dec 2017 10:21:27 -0800</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: Long live %pK (was Re: [PATCH tip/core/rcu 02/20] torture: Prepare scripting for shift from %p to %pK)</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody">On Wed, Dec 13, 2017 at 4:59 AM, Michael Ellerman &lt;mpe&#64;ellerman.id.au&gt; wrote:<br />&gt;<br />&gt; Right. My email was only about the kptr_restrict = 1 case, but I didn't<br />&gt; actually make that clear.<br />&gt;<br />&gt; But that's also sort of my point, it has multiple modes of operation,<br />&gt; which is useful.<br /><br />No it isn't.<br /><br />It's completely useless. Let me count the ways:<br /><br /> - it ties a lot of completely unrelated things together in illogical<br />ways. What if you want vmallocinfo for debuggability, but not<br />something else?<br /><br /> - we've had it for most of a decade, and few people use it, and it's<br />not actually fixed any real security holes. It has only helped on<br />particular setups, not in general.<br /><br />&gt; OK, that's the piece I was missing - ie. what to do in the case where<br />&gt; %px for all users is too permissive but %p is not useful.<br /><br />Right. THAT IS THE WHOLE POINT OF THE NEW %p BEHAVIOR.<br /><br />Make people actually _think_ about the things they see, and hopefully<br />just remove it entirely. Not the total idiocy that was %pK that never<br />resulted in any actual improvement anywhere.<br /><br />%pK was the "sprinkle some crack on him, let's get out of here"<br />approach to security. It's bogus shit. Don't do it.<br /><br />Seriously. It's been sprinkled around randomly just to make random<br />people feel like they did something. IT DID NOTHING.<br /><br />The 'K' literally stands for "krack". Because spelling wasn't the<br />strong part of the thing either.<br /><br />&gt; I'm still a bit confused by the above. Because kallsyms which is your<br />&gt; example of how to do it right, still uses kptr_restrict. I get that it<br />&gt; also checks kallsyms_for_perf(), but that's only in the<br />&gt; kptr_restrict = 0 case.<br /><br />Yeah, it was probably a mistake, but I didn't want to change the old behavior.<br /><br />&gt; Anyway, I'll do a patch for vmallocinfo to do the CAP_SYSLOG check at<br />&gt; open time, and use that to decide if it should print 0 or the address.<br /><br />.. don't use CAP_SYSLOG, at least without thihnking about it.  That<br />was just another mistake of mine in thinking that "let's keep the old<br />behavior" is a good idea.<br /><br />Seriously, what does CAP_SYSLOG have to do with kernel address<br />debugging? Nothing, really.<br /><br />I suspect CAP_SYS_ADMIN is a much saner thing to use.<br /><br />Ask yourself: who really should get access to vmalloc addresses?<br /><br />                 Linus<br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
