    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2017/12/18/1509">First message in thread</a></li><li><a href="/lkml/2017/12/18/1533">Al Viro</a><ul><li><a href="/lkml/2017/12/18/1566">Dave Jones</a><ul><li class="origin"><a href="/lkml/2017/12/18/1637">Linus Torvalds</a><ul><li><a href="/lkml/2017/12/18/1637">Dave Jones</a></li><li><a href="/lkml/2017/12/19/280">Tetsuo Handa</a><ul><li><a href="/lkml/2017/12/19/739">(Eric W. Biederman)</a></li></ul></li><li><a href="/lkml/2017/12/19/742">(Eric W. Biederman)</a><ul><li><a href="/lkml/2017/12/19/786">Dave Jones</a></li></ul></li></ul></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Mon, 18 Dec 2017 15:50:52 -0800</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: proc_flush_task oops</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody">On Mon, Dec 18, 2017 at 3:10 PM, Dave Jones &lt;davej&#64;codemonkey.org.uk&gt; wrote:<br />&gt; On Mon, Dec 18, 2017 at 10:15:41PM +0000, Al Viro wrote:<br />&gt;  &gt; On Mon, Dec 18, 2017 at 04:44:38PM -0500, Dave Jones wrote:<br />&gt;  &gt; &gt; I've hit this twice today. It's odd, because afaics, none of this code<br />&gt;  &gt; &gt; has really changed in a long time.<br />&gt;  &gt;<br />&gt;  &gt; Which tree had that been?<br />&gt;<br />&gt; Linus, rc4.<br /><br />Ok, so the original report was marked as spam for me for whatever<br />reason. I ended up re-analyzing the oops, but came to the same<br />conclusion you did: it's a NULL mnt pointer in proc_flush_task_mnt().<br /><br />The code disassembles to<br /><br />   0: c1 e2 04              shl    $0x4,%edx<br />   3: 44 8b 60 30          mov    0x30(%rax),%r12d<br />   7: 48 8b 40 38          mov    0x38(%rax),%rax<br />   b: 44 8b 34 11          mov    (%rcx,%rdx,1),%r14d<br />   f: 48 c7 c2 60 3a f5 81 mov    $0xffffffff81f53a60,%rdx<br />  16: 44 89 e1              mov    %r12d,%ecx<br />  19: 4c 8b 68 58          mov    0x58(%rax),%r13<br />  1d: e8 4b b4 77 00        callq  0x77b46d<br />  22: 89 44 24 14          mov    %eax,0x14(%rsp)<br />  26: 48 8d 74 24 10        lea    0x10(%rsp),%rsi<br />  2b:* 49 8b 7d 00          mov    0x0(%r13),%rdi &lt;-- trapping instruction<br />  2f: e8 b9 6a f9 ff        callq  0xfffffffffff96aed<br />  34: 48 85 c0              test   %rax,%rax<br />  37: 74 1a                je     0x53<br />  39: 48 89 c7              mov    %rax,%rdi<br /><br />and just matching that up against the code I see generated, that first<br />call is the call to snprintf, and the second call is to<br />d_hash_and_lookup.<br /><br />So it's one of these two patterns (pid vs tgid):<br /><br />        name.len = snprintf(buf, sizeof(buf), "%d", pid);<br />        /* no -&gt;d_hash() rejects on procfs */<br />        dentry = d_hash_and_lookup(mnt-&gt;mnt_root, &amp;name);<br /><br />and that "mov 0x0(%r13),%rdi" that traps is "mnt-&gt;mnt_root".<br /><br />But I don't see what would have changed in this area recently.<br /><br />Do you end up saving the seeds that cause crashes? Is this<br />reproducible? (Other than seeing it twoce, of course)<br /><br />               Linus<br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
