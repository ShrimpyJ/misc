    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2017/10/30/361">First message in thread</a></li><li><a href="/lkml/2017/10/30/361">Dave Jones</a><ul><li class="origin"><a href="/lkml/2017/10/30/599">Linus Torvalds</a><ul><li><a href="/lkml/2017/10/30/599">Dave Jones</a></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Mon, 30 Oct 2017 11:59:30 -0700</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: [4.14-rc7] task struct corruption after fork</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody">On Mon, Oct 30, 2017 at 7:11 AM, Dave Jones &lt;davej&#64;codemonkey.org.uk&gt; wrote:<br />&gt; Something scary for halloween. Only saw this once so far.<br /><br />Scary indeed.<br /><br />I don't see any pattern. It's 18 quad-words with one unwritten entry<br />before the last one.<br /><br />And most of them look like kernel pointers, but not all. The quad-words are:<br /><br />    ffffffff81172d1e<br />    ffffffff8426daec<br />    ffffed008b17e001<br />    ffffffff811737e2<br />    ffffffff8426dbe0<br />    ffff880458bf0008<br />    ffffffff84590d00<br />    5<br />    ffffffff81172d00<br />    1<br />    1ffff1008b17dfed<br />    ffff880458bf00f0<br />    ffffed008b17dff9<br />    dffffc0000000000<br />    41b58ab3<br />    ffffffff82a349a8<br />    ffffffff81173540<br />    .. unwritten entry ..<br />    ffffffff8450f080<br /><br />and it's at the end of the page, but not *quite* at the end of the page.<br /><br />It smells almost like a "struct pt_regs *". The unwritten entry would<br />be "cs", and sp/ss would be missing, but the flags value isn't a sane<br />flags value either. Maybe I miscounted. Something like this:<br /><br />    ffffffff81172d1e   r15<br />    ffffffff8426daec   r14<br />    ffffed008b17e001   r13<br />    ffffffff811737e2   r12<br />    ffffffff8426dbe0   rbp<br />    ffff880458bf0008   rbx<br />    ffffffff84590d00   r11<br />    5                  r10<br />    ffffffff81172d00   r9<br />    1                  r8<br />    1ffff1008b17dfed   rax<br />    ffff880458bf00f0   rcx<br />    ffffed008b17dff9   rdx<br />    dffffc0000000000   rsi<br />    41b58ab3           rdi<br />    ffffffff82a349a8   orig_eax<br />    ffffffff81173540   rip<br />    5a5a5a5a5a5a5a5a<br />    ffffffff8450f080   flags<br /><br />and that location would *almost* make sense in that it's the end of<br />the same page that contained a "struct task_struct".<br /><br />Are you running with VMAP_STACK? Is there perhaps some stale code that<br />ends up doing the old "stack pointer is in the same allocation as task<br />struct"?<br /><br />Adding Andy and Ingo to the cc in case they see something.<br /><br />If you have the kernel symbols for that image, can you look up if any<br />of those addresses look like any static kernel symbol addresses? Those<br />things that have the pattern  ffffffff8xxxxxxx might be symbol<br />addresses and give us a clue about where the values came from.<br /><br />             Linus<br /><br />&gt; [10737.049397] =============================================================================<br />&gt; [10737.052151] BUG task_struct (Not tainted): Padding overwritten. 0xffff880458befef8-0xffff880458beffcf<br />&gt; [10737.055172] -----------------------------------------------------------------------------<br />&gt; [10737.061267] Disabling lock debugging due to kernel taint<br />&gt; [10737.064384] INFO: Slab 0xffffea001162fa00 objects=4 used=4 fp=0x          (null) flags=0x2ffc00000008100<br />&gt; [10737.067771] CPU: 2 PID: 26357 Comm: trinity-c13 Tainted: G    B           4.14.0-rc7-think+ #1<br />&gt; [10737.074807] Call Trace:<br />&gt; [10737.089264]  slab_err+0xad/0xd0<br />&gt; [10737.096769]  slab_pad_check.part.43+0xfa/0x160<br />&gt; [10737.104600]  check_slab+0xa6/0xd0<br />&gt; [10737.108563]  alloc_debug_processing+0x85/0x1b0<br />&gt; [10737.112612]  ___slab_alloc+0x525/0x5d0<br />&gt; [10737.137803]  __slab_alloc+0x3e/0x80<br />&gt; [10737.142100]  kmem_cache_alloc_node+0xbd/0x360<br />&gt; [10737.150932]  copy_process.part.42+0x101c/0x29e0<br />&gt; [10737.352788]  _do_fork+0x1c4/0xa30<br />&gt; [10737.468260]  do_syscall_64+0x182/0x400<br />&gt; [10737.527991]  entry_SYSCALL64_slow_path+0x25/0x25<br />&gt; [10737.600521] Padding ffff880458bef3d0: 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a  ZZZZZZZZZZZZZZZZ<br />&gt; .... snip snip ...<br />&gt; [10738.162127] Padding ffff880458befee0: 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a  ZZZZZZZZZZZZZZZZ<br />&gt; [10738.163174] Padding ffff880458befef0: 5a 5a 5a 5a 5a 5a 5a 5a 1e 2d 17 81 ff ff ff ff  ZZZZZZZZ.-......<br />&gt; [10738.164297] Padding ffff880458beff00: ec da 26 84 ff ff ff ff 01 e0 17 8b 00 ed ff ff  ..&amp;.............<br />&gt; [10738.165476] Padding ffff880458beff10: e2 37 17 81 ff ff ff ff e0 db 26 84 ff ff ff ff  .7........&amp;.....<br />&gt; [10738.166692] Padding ffff880458beff20: 08 00 bf 58 04 88 ff ff 00 0d 59 84 ff ff ff ff  ...X......Y.....<br />&gt; [10738.167985] Padding ffff880458beff30: 05 00 00 00 00 00 00 00 00 2d 17 81 ff ff ff ff  .........-......<br />&gt; [10738.169300] Padding ffff880458beff40: 01 00 00 00 00 00 00 00 ed df 17 8b 00 f1 ff 1f  ................<br />&gt; [10738.170651] Padding ffff880458beff50: f0 00 bf 58 04 88 ff ff f9 df 17 8b 00 ed ff ff  ...X............<br />&gt; [10738.172076] Padding ffff880458beff60: 00 00 00 00 00 fc ff df b3 8a b5 41 00 00 00 00  ...........A....<br />&gt; [10738.173540] Padding ffff880458beff70: a8 49 a3 82 ff ff ff ff 40 35 17 81 ff ff ff ff  .I......&#64;5......<br />&gt; [10738.175095] Padding ffff880458beff80: 5a 5a 5a 5a 5a 5a 5a 5a 80 f0 50 84 ff ff ff ff  ZZZZZZZZ..P.....<br />&gt; [10738.176722] Padding ffff880458beff90: 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a  ZZZZZZZZZZZZZZZZ<br />&gt; [10738.178385] Padding ffff880458beffa0: 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a  ZZZZZZZZZZZZZZZZ<br />&gt; [10738.180082] Padding ffff880458beffb0: 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a  ZZZZZZZZZZZZZZZZ<br />&gt; [10738.181758] Padding ffff880458beffc0: 5a 5a 5a 5a 5a 5a 5a 5a 80 0a 59 84 ff ff ff ff  ZZZZZZZZ..Y.....<br />&gt; [10738.183501] FIX task_struct: Restoring 0xffff880458bef3d0-0xffff880458beffcf=0x5a<br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
