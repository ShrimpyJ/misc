    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2017/10/31/884">First message in thread</a></li><li><a href="/lkml/2017/10/31/884">Dave Hansen</a><ul><li><a href="/lkml/2017/10/31/885">Dave Hansen</a><ul><li><a href="/lkml/2017/11/1/682">Thomas Gleixner</a><ul><li><a href="/lkml/2017/11/1/718">Andy Lutomirski</a><ul><li><a href="/lkml/2017/11/1/795">Thomas Gleixner</a></li></ul></li></ul></li></ul></li><li><a href="/lkml/2017/10/31/886">Dave Hansen</a><ul><li><a href="/lkml/2017/10/31/992">Brian Gerst</a><ul><li><a href="/lkml/2017/10/31/999">Dave Hansen</a></li></ul></li><li><a href="/lkml/2017/11/1/532">Borislav Petkov</a><ul><li><a href="/lkml/2017/11/1/538">Dave Hansen</a><ul><li><a href="/lkml/2017/11/1/646">Borislav Petkov</a></li></ul></li></ul></li><li><a href="/lkml/2017/11/1/658">Thomas Gleixner</a><ul><li><a href="/lkml/2017/11/1/927">Dave Hansen</a></li></ul></li></ul></li><li><a href="/lkml/2017/10/31/887">Dave Hansen</a><ul><li><a href="/lkml/2017/10/31/985">Kees Cook</a><ul><li><a href="/lkml/2017/11/1/107">Borislav Petkov</a></li></ul></li></ul></li><li><a href="/lkml/2017/10/31/888">Dave Hansen</a><ul><li><a href="/lkml/2017/11/1/72">Andy Lutomirski</a><ul><li><a href="/lkml/2017/11/1/306">Dave Hansen</a><ul><li><a href="/lkml/2017/11/1/637">Andy Lutomirski</a></li></ul></li></ul></li></ul></li><li><a href="/lkml/2017/10/31/889">Dave Hansen</a></li><li><a href="/lkml/2017/10/31/890">Dave Hansen</a></li><li><a href="/lkml/2017/10/31/891">Dave Hansen</a></li><li><a href="/lkml/2017/10/31/892">Dave Hansen</a></li><li><a href="/lkml/2017/10/31/893">Dave Hansen</a></li><li><a href="/lkml/2017/10/31/894">Dave Hansen</a></li><li><a href="/lkml/2017/10/31/895">Dave Hansen</a><ul><li><a href="/lkml/2017/11/1/70">Andy Lutomirski</a><ul><li><a href="/lkml/2017/11/1/77">Ingo Molnar</a></li></ul></li></ul></li><li><a href="/lkml/2017/10/31/896">Dave Hansen</a></li><li><a href="/lkml/2017/10/31/897">Dave Hansen</a></li><li><a href="/lkml/2017/10/31/898">Dave Hansen</a></li><li><a href="/lkml/2017/10/31/900">Dave Hansen</a></li><li><a href="/lkml/2017/10/31/901">Dave Hansen</a></li><li><a href="/lkml/2017/10/31/902">Dave Hansen</a></li><li><a href="/lkml/2017/10/31/903">Dave Hansen</a></li><li><a href="/lkml/2017/10/31/904">Dave Hansen</a><ul><li><a href="/lkml/2017/10/31/971">Kees Cook</a></li></ul></li><li><a href="/lkml/2017/10/31/906">Dave Hansen</a><ul><li><a href="/lkml/2017/11/1/804">Thomas Gleixner</a></li></ul></li><li><a href="/lkml/2017/10/31/907">Dave Hansen</a><ul><li><a href="/lkml/2017/11/1/694">Thomas Gleixner</a><ul><li><a href="/lkml/2017/11/1/899">Dave Hansen</a><ul><li><a href="/lkml/2017/11/1/915">Thomas Gleixner</a></li></ul></li></ul></li></ul></li><li><a href="/lkml/2017/10/31/908">Dave Hansen</a><ul><li><a href="/lkml/2017/10/31/959">Kees Cook</a></li></ul></li><li><a href="/lkml/2017/10/31/909">Dave Hansen</a><ul><li><a href="/lkml/2017/11/1/71">Andy Lutomirski</a><ul><li><a href="/lkml/2017/11/1/139">"Kirill A. Shutemov"</a><ul><li><a href="/lkml/2017/11/1/155">Andy Lutomirski</a></li></ul></li></ul></li><li><a href="/lkml/2017/11/1/720">Thomas Gleixner</a><ul><li><a href="/lkml/2017/11/1/912">Dave Hansen</a><ul><li><a href="/lkml/2017/11/1/919">Thomas Gleixner</a></li></ul></li></ul></li></ul></li><li class="origin"><a href="/lkml/2017/10/31/974">Linus Torvalds</a><ul><li><a href="/lkml/2017/10/31/974">Dave Hansen</a><ul><li><a href="/lkml/2017/10/31/987">Dave Hansen</a></li><li><a href="/lkml/2017/11/1/69">Andy Lutomirski</a></li><li><a href="/lkml/2017/11/1/406">Linus Torvalds</a><ul><li><a href="/lkml/2017/11/1/490">Dave Hansen</a></li></ul></li></ul></li><li><a href="/lkml/2017/11/1/395">Dave Hansen</a></li></ul></li><li><a href="/lkml/2017/11/1/96">Ingo Molnar</a><ul><li><a href="/lkml/2017/11/1/295">Thomas Gleixner</a></li><li><a href="/lkml/2017/11/1/904">Dave Hansen</a><ul><li><a href="/lkml/2017/11/1/918">Linus Torvalds</a></li><li><a href="/lkml/2017/11/2/112">Peter Zijlstra</a></li><li><a href="/lkml/2017/11/3/196">"Kirill A. Shutemov"</a></li></ul></li></ul></li><li><a href="/lkml/2017/11/2/813">Will Deacon</a><ul><li><a href="/lkml/2017/11/2/834">Dave Hansen</a><ul><li><a href="/lkml/2017/11/3/297">Will Deacon</a></li></ul></li></ul></li><li><a href="/lkml/2017/11/22/423">Pavel Machek</a><ul><li><a href="/lkml/2017/11/23/175">Pavel Machek</a></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Tue, 31 Oct 2017 16:27:36 -0700</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: [PATCH 00/23] KAISER: unmap most of the kernel from userspace page tables</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody">Inconveniently, the people you cc'd on the actual patches did *not*<br />get cc'd with this 00/23 cover letter email.<br /><br />Also, the documentation was then hidden in patch 07/23, which wasn't<br />exactly obvious.<br /><br />So I'd like this to be presented a bit differently.<br /><br />That said, a couple of comments/questions on this version of the patch series..<br /><br /> (a) is this on top of Andy's entry cleanups?<br /><br />     If not, that probably needs to be sorted out.<br /><br /> (b) the TLB global bit really is nastily done. You basically disable<br />_PAGE_GLOBAL entirely.<br /><br />     I can see how/why that would make things simpler, but it's almost<br />certainly the wrong approach. The small subset of kernel pages that<br />are always mapped should definitely retain the global bit, so that you<br />don't always take a TLB miss on those! Those are probably some of the<br />most latency-critical pages, since there's generally no prefetching<br />for the kernel entry code or for things like IDT/GDT accesses..<br /><br />     So even if you don't want to have global pages for normal kernel<br />entries, you don't want to just make _PAGE_GLOBAL be defined as zero.<br />You'd want to just use _PAGE_GLOBAL conditionally.<br /><br />     Hmm?<br /><br /> (c) am I reading the code correctly, and the shadow page tables are<br />*completely* duplicated?<br /><br />     That seems insane. Why isn't only tyhe top level shadowed, and<br />then lower levels are shared between the shadowed and the "kernel"<br />page tables?<br /><br />     But I may be mis-reading the code completely.<br /><br />Apart from those three questions, I don't see any huge downside to the<br />patch series, apart from the obvious performance/complexity issues.<br /><br />              Linus<br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
