    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2001/9/21/141">First message in thread</a></li><li><a href="/lkml/2001/9/21/141">"HABBINGA,ERIK (HP-Loveland,ex1)"</a><ul><li><a href="/lkml/2001/9/21/134">Rik van Riel</a></li><li class="origin"><a href="">(Linus Torvalds)</a></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><script type="text/javascript" src="//pagead2.googlesyndication.com/pagead/show_ads.js"></script><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">From</td><td class="rp" itemprop="author">(Linus Torvalds)</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: major VM suckage with 2.4.10pre12 and 2.4.10pre13 and highmem, we will help test</td></tr><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Sat, 22 Sep 2001 05:44:06 +0000 (UTC)</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody">In article &lt;F341E03C8ED6D311805E00902761278C04728F82&#64;xfc04.fc.hp.com&gt;,<br />HABBINGA,ERIK (HP-Loveland,ex1) &lt;erik_habbinga&#64;hp.com&gt; wrote:<br />&gt;Kernel 2.4.10pre13 did not help our NFS SPEC testing on a machine with 4GB<br />&gt;RAM.  Refer to my previous message about those results:<br />&gt;<a href="http://lists.insecure.org/linux-kernel/2001/Sep/3036.html">http://lists.insecure.org/linux-kernel/2001/Sep/3036.html</a><br />&gt;<br />&gt;In a nutshell, kswapd starts grabbing 99% of the CPU for long stretches in<br />&gt;time, which causes us to drop NFS RPC connections, which causes performance<br />&gt;to suck.<br /><br />Duh.<br /><br />No wonder.<br /><br />There's this test in page_alloc.c that tests for atomic allocations the<br />wrong way - it uses "(gfp_mask &amp; __GFP_HIGH)", when the test _should_ be<br />"!(gfp_mask &amp; __GFP_WAIT)".<br /><br />Which causes regular kernel allocations to eat into the reserved memory<br />pool.  Which in turn makes the _real_ atomic allocations really rather<br />unhappy (resulting in lost packets - which pretty much guarantees sucky<br />NFS performance ;).<br /><br />And it probably doesn't make kswapd that happy either... <br /><br />You can either fix that single line, or try out pre14 which cleans up<br />some other things too..<br /><br />		Linus<br /><br />-----<br />pre14:<br /> - Richard Gooch: devfs update<br /> - Andrea Arcangeli: clean up/fix ramdisk handling now that it's in page cache<br /> - Al Viro: follow up the above with initrd cleanups<br /> - Keith Owens: get rid of drivers/scsi/53c700-mem.c file<br /> - Trond Myklebust: RPC over TCP race fix<br /> - Greg KH: USB update (ohci understands USB_ZERO_PACKET)<br /> - me: clean up reference bit handling, fix silly GFP_ATOMIC allocation bug<br /><br />pre13:<br /> - Manfred Spraul: /proc/pid/maps cleanup (and bugfix for non-x86)<br /> - Al Viro: "block device fs" - cleanup of page cache handling<br /> - Hugh Dickins: VM/shmem cleanups and swap search speedup<br /> - David Miller: sparc updates, soc driver typo fix, net updates<br /> - Jeff Garzik: network driver updates (dl2k, yellowfin and tulip)<br /> - Neil Brown: knfsd cleanups and fixues<br /> - Ben LaHaise: zap_page_range merge from -ac<br /><br />pre12:<br /> - Alan Cox: much more merging<br /> - Pete Zaitcev: ymfpci race fixes<br /> - Andrea Arkangeli: VM race fix and OOM tweak.<br /> - Arjan Van de Ven: merge RH kernel fixes<br /> - Andi Kleen: use more readable 'likely()/unlikely()' instead of __builtin_expect()<br /> - Keith Owens: fix 64-bit ELF types<br /> - Gerd Knorr: mark more broken PCI bridges, update btaudio driver<br /> - Paul Mackerras: powermac driver update<br /> - me: clean up PTRACE_DETACH to use common infrastructure<br /><br />pre11:<br /> - Neil Brown: md cleanups/fixes<br /> - Andrew Morton: console locking merge<br /> - Andrea Arkangeli: major VM merge<br /><br />pre10:<br /> - Alan Cox: continued merging<br /> - Mingming Cao: make msgrcv/shmat check the queue/segment ID's properly<br /> - Greg KH: USB serial init failure fix, Xircom serial converter driver<br /> - Neil Brown: nsfd/raid/md/lockd cleanups<br /> - Ingo Molnar: multipath RAID personality, raid xor update<br /> - Hugh Dickins/Marcelo Tosatti: swapin read-ahead race fix<br /> - Vojtech Pavlik: fix up some of the infrastructure for x86-64<br /> - Robert Love: AMD 761 AGP GART support<br /> - Jens Axboe: fix SCSI-generic queue handling race<br /> - me: be sane about page reference bits<br /><br />pre9:<br /> - Greg KH: start migration to new "min()/max()"<br /> - Roman Zippel: move affs over to "min()/max()".<br /> - Vojtech Pavlik: VIA update (make sure not to IRQ-unmask a vt82c576)<br /> - Jan Kara: quota bug-fix (don't decrement quota for non-counted inode)<br /> - Anton Altaparmakov: more NTFS updates<br /> - Al Viro: make nosuid/noexec/nodev be per-mount flags, not per-filesystem<br /> - Alan Cox: merge input/joystick layer differences, driver and alpha merge<br /> - Keith Owens: scsi Makefile cleanup<br /> - Trond Myklebust: fix oopsable race in locking code<br /> - Jean Tourrilhes: IrDA update<br /><br />pre8:<br /> - Christoph Hellwig: clean up personality handling a bit<br /> - Robert Love: update sysctl/vm documentation<br /> - make the three-argument (that everybody hates) "min()" be "min_t()",<br />   and introduce a type-anal "min()" that complains about arguments of<br />   different types. <br /><br />pre7:<br /> - Alan Cox: big driver/mips sync<br /> - Andries Brouwer, Christoph Hellwig: more gendisk fixups<br /> - Tobias Ringstrom: tulip driver workaround for DC21143 erratum<br /><br />pre6:<br /> - Jens Axboe: remove trivially dead io_request_lock usage<br /> - Andrea Arcangeli: softirq cleanup and ARM fixes. Slab cleanups<br /> - Christoph Hellwig: gendisk handling helper functions/cleanups<br /> - Nikita Danilov: reiserfs dead code pruning<br /> - Anton Altaparmakov: NTFS update to 1.1.18<br /> - firestream network driver: patch reverted on authors request<br /> - NIIBE Yutaka: SH architecture update<br /> - Paul Mackerras: PPC cleanups, PPC8xx update.<br /> - me: reverse broken bootdata allocation patch that went into pre5<br /><br />pre5:<br /> - Merge with Alan<br /> - Trond Myklebust: NFS fixes - kmap and root inode special case<br /> - Al Viro: more superblock cleanups, inode leak in rd.c, minix<br />   directories in page cache<br /> - Paul Mackerras: clean up rubbish from sl82c105.c<br /> - Neil Brown: md/raid cleanups, NFS filehandles<br /> - Johannes Erdfelt: USB update (usb-2.0 support, visor fix, Clie fix,<br />   pl2303 driver update)<br /> - David Miller: sparc and net update<br /> - Eric Biederman: simplify and correct bootdata allocation - don't<br />   overwrite ramdisks<br /> - Tim Waugh: support multiple SuperIO devices, parport doc updates<br /><br />pre4:<br /> - Hugh Dickins: swapoff cleanups and speedups<br /> - Matthew Dharm: USB storage update<br /> - Keith Owens: Makefile fixes<br /> - Tom Rini: MPC8xx build fix<br /> - Nikita Danilov: reiserfs update<br /> - Jakub Jelinek: ELF loader fix for ET_DYN<br /> - Andrew Morton: reparent_to_init() for kernel threads<br /> - Christoph Hellwig: VxFS and SysV updates, vfs_permission fix<br /><br />pre3:<br /> - Johannes Erdfelt, Oliver Neukum: USB printer driver race fix<br /> - John Byrne: fix stupid i386-SMP irq stack layout bug<br /> - Andreas Bombe, me: yenta IO window fix<br /> - Neil Brown: raid1 buffer state fix<br /> - David Miller, Paul Mackerras: fix up sparc and ppc respectively for kmap/kbd_rate<br /> - Matija Nalis: umsdos fixes, and make it possible to boot up with umsdos<br /> - Francois Romieu: fix bugs in dscc4 driver<br /> - Andy Grover: new PCI config space access functions (eventually for ACPI)<br /> - Albert Cranford: fix incorrect e2fsprog data from ver_linux script<br /> - Dave Jones: re-sync x86 setup code, fix macsonic kmalloc use<br /> - Johannes Erdfelt: remove obsolete plusb USB driver<br /> - Andries Brouwer: fix USB compact flash version info, add blksize ioctls<br /><br />pre2:<br /> - Al Viro: block device cleanups<br /> - Marcelo Tosatti: make bounce buffer allocations more robust (it's ok<br />   for them to do IO, just not cause recursive bounce IO. So allow them)<br /> - Anton Altaparmakov: NTFS update (1.1.17)<br /> - Paul Mackerras: PPC update (big re-org)<br /> - Petko Manolov: USB pegasus driver fixes<br /> - David Miller: networking and sparc updates<br /> - Trond Myklebust: Export atomic_dec_and_lock<br /> - OGAWA Hirofumi: find and fix umsdos "filldir" users that were broken<br />   by the 64-bit-cleanups. Fix msdos warnings.<br /> - Al Viro: superblock handling cleanups and race fixes<br /> - Johannes Erdfelt++: USB updates<br /><br />pre1:<br /> - Jeff Hartmann: DRM AGP/alpha cleanups<br /> - Ben LaHaise: highmem user pagecopy/clear optimization<br /> - Vojtech Pavlik: VIA IDE driver update<br /> - Herbert Xu: make cramfs work with HIGHMEM pages<br /> - David Fennell: awe32 ram size detection improvement<br /> - Istvan Varadi: umsdos EMD filename bug fix<br /> - Keith Owens: make min/max work for pointers too<br /> - Jan Kara: quota initialization fix<br /> - Brad Hards: Kaweth USB driver update (enable, and fix endianness)<br /> - Ralf Baechle: MIPS updates<br /> - David Gibson: airport driver update<br /> - Rogier Wolff: firestream ATM driver multi-phy support<br /> - Daniel Phillips: swap read page referenced set - avoid swap thrashing<br /><br />-<br />To unsubscribe from this list: send the line "unsubscribe linux-kernel" in<br />the body of a message to majordomo&#64;vger.kernel.org<br />More majordomo info at  <a href="http://vger.kernel.org/majordomo-info.html">http://vger.kernel.org/majordomo-info.html</a><br />Please read the FAQ at  <a href="http://www.tux.org/lkml/">http://www.tux.org/lkml/</a><br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
