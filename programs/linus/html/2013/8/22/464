    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2013/8/21/519">First message in thread</a></li><li><a href="/lkml/2013/8/21/519">Andy Lutomirski</a><ul><li><a href="/lkml/2013/8/21/545">Willy Tarreau</a></li><li class="origin"><a href="/lkml/2013/8/22/469">Linus Torvalds</a><ul><li><a href="/lkml/2013/8/22/469">Willy Tarreau</a><ul><li><a href="/lkml/2013/8/22/473">Andy Lutomirski</a><ul><li><a href="/lkml/2013/8/22/481">Linus Torvalds</a></li><li><a href="/lkml/2013/8/22/485">Willy Tarreau</a></li></ul></li></ul></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><script type="text/javascript" src="//pagead2.googlesyndication.com/pagead/show_ads.js"></script><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Thu, 22 Aug 2013 11:48:10 -0700</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: [PATCH v2] vfs: Tighten up linkat(..., AT_EMPTY_PATH)</td></tr><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody">On Wed, Aug 21, 2013 at 12:14 PM, Andy Lutomirski &lt;luto&#64;amacapital.net&gt; wrote:<br />&gt;<br />&gt; So let's be careful for now: only allow linkat(..., AT_EMPTY_PATH)<br />&gt; if the target is I_LINKABLE.<br /><br />So I really detest this just because it's such a special case. Now<br />this is only useful for that one special case, and the thing very<br />fundamentally checks that one special case in a place that is<br />impossible to check for the /proc case, so the proc case remains<br />totally separate.<br /><br />Which just bothers me.<br /><br />I think we could easily at least allow the "file-&gt;f_creds ==<br />current-&gt;creds" case (and yes, I literally mean comparing the pointers<br />- not only is it cheaper, but it literally means "nothing odd has<br />happened in between opening and the lookup").<br /><br />And I'm wondering if we shouldn't actually do that at "path_init"<br />time. Right now the code says:<br /><br />                /* Caller must check execute permissions on the<br />starting path component */<br />                struct fd f = fdget_raw(dfd);<br /><br />and then uses the struct file mindlessly.<br /><br />I'm wondering if we should just do some validation in that place, and say:<br /><br /> - for directories, we require exec permissions here<br /> - for everything else, we require that f-&gt;f_cred == current-&gt;cred check.<br /><br />I dunno. But that I_LINKABLE thing just bothers me. It screams "I'm<br />hacky" to me.<br /><br />               Linus<br /><br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
