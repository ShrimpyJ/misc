    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/1998/7/24/71">First message in thread</a></li><li><a href="/lkml/1998/7/26/59">Linus Torvalds</a><ul><li><a href="/lkml/1998/7/26/61">(Alan Cox)</a><ul><li><a href="/lkml/1998/7/26/71">Linus Torvalds</a><ul><li><a href="/lkml/1998/7/26/113">"David S. Miller"</a><ul><li><a href="/lkml/1998/7/26/137">"Brandon S. Allbery KF8NH"</a></li></ul></li><li><a href="/lkml/1998/8/1/78">Andrea Arcangeli</a><ul><li><a href="/lkml/1998/8/1/82">Linus Torvalds</a></li><li><a href="/lkml/1998/8/1/95">Meino Christian Cramer</a></li></ul></li></ul></li></ul></li><li><a href="/lkml/1998/7/26/95">Gerard Roudier</a></li><li><a href="/lkml/1998/7/28/170">Mark Lord</a><ul><li class="origin"><a href="/lkml/1998/7/29/28">Linus Torvalds</a><ul><li><a href="/lkml/1998/7/29/28">(Alan Cox)</a></li></ul></li><li><a href="/lkml/1998/7/28/190">Doug Ledford</a><ul><li><a href="/lkml/1998/7/28/198">"Richard B. Johnson"</a><ul><li><a href="/lkml/1998/7/29/3">Doug Ledford</a></li></ul></li><li><a href="/lkml/1998/7/29/40">Mark Lord</a><ul><li><a href="/lkml/1998/7/29/192">Doug Ledford</a></li></ul></li></ul></li></ul></li><li><a href="/lkml/1998/7/29/110">"Kristofer T. Karas"</a><ul><li><a href="/lkml/1998/7/29/142">Linus Torvalds</a></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Tue, 28 Jul 1998 17:49:26 -0700 (PDT)</td></tr><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: 2.1.111: IDE DMA disabled?</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody"><br /><br />On Tue, 28 Jul 1998, Mark Lord wrote:<br />&gt; <br />&gt; Duh. Letmesee.. SMP=1 by default.. Mmmm... looks very bad.<br /><br />I have news for you - 2.2 won't have that. The development kernels have it<br />because it's my default environment, so it's the easiest for me. For a<br />release kernel it obviously doesn't make sense.<br /><br />So for 2.2.0, there will magically appear a '#' marker in the main<br />Makefile. And if it makes you feel better, I can add the comment marker to<br />drivers/block/Config.in at that time too, and remove it for the while<br />being. But I suspect you'd be even more upset by that, right? <br /><br />&gt; On a constructive note, could there be an SMP cache-sync problem<br />&gt; with DMA (IDE or SCSI) ?<br /><br />Yes. According to all Intel docs, cache coherency is done in hardware<br />(there is not even any working software solution, because a wbinvl<br />actually causes more bugs than it fixes), and while there are magic things<br />you have to do to cause "synchronizing" of the CPU core to the caches (not<br />the caches to each other), one of the magic things is a IO instruction. <br /><br />So by just reading the IDE status register you'd essentally guarantee that<br />whatever DMA activity happened earlier will have completed as far as the<br />CPU is concerned.<br /><br />&gt; SMP really should be OFF by default, <br />&gt; especially as SMP kernels do not survive<br />&gt; booting on many non-SMP machines.<br /><br />Yes. And it will be.<br /><br />By the same logic, DMA should be OFF by default. <br /><br />Do you get my drift now? <br /><br />&gt; The timings with DMA are *identical* to the timings with PIO,<br />&gt; so if it fails with DMA, it will fail with PIO as well.<br /><br />No.<br /><br />Even if the timings on the actual IDE cable are 100% the same, the timings<br />will be very different indeed on another level. A DMA access will cause<br />the memory write directly, possibly with a write-back-and-invalidate<br />and/or a invalidate from some CPU. <br /><br />A PIO read will move directly from the IDE controller into the CPU, and<br />the CPU itself will do all the memory accesses. As such, from the<br />standpoint of the IDE controller they are two very very different<br />sequences. <br /><br />So yes, if you read the "IDE specs" the timings look the same: X cycles<br />per access on the IDE cable. But specs and hardware aren't the same thing. <br /><br />&gt; Removing DMA from the kernel solves nothing there.<br /><br />I didn't _want_ to remove DMA from the kernel.<br /><br />I've been asking you to not do DMA by default for a very long time, and<br />every time I ask I have gotten back a reply saying essentially something<br />like "if the BIOS set us up for DMA we have to do DMA". Which is obviously<br />not true.<br /><br />The only way I could even get you to react to this whole discussion was to<br />disable DMA completely. Not because I wanted to make it impossible for<br />people to use DMA, but because I wanted to make it impossible for the<br />kernel to start using DMA when it shouldn't. <br /><br />		Linus<br /><br /><br />-<br />To unsubscribe from this list: send the line "unsubscribe linux-kernel" in<br />the body of a message to majordomo&#64;vger.rutgers.edu<br />Please read the FAQ at <a href="http://www.altern.org/andrebalsa/doc/lkml-faq.html">http://www.altern.org/andrebalsa/doc/lkml-faq.html</a><br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
