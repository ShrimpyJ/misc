    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2020/9/15/1490">First message in thread</a></li><li><a href="/lkml/2020/9/16/330">Willy Tarreau</a><ul><li><a href="/lkml/2020/9/23/175">Pavel Machek</a><ul><li class="origin"><a href="/lkml/2020/9/23/877">Linus Torvalds</a><ul><li><a href="/lkml/2020/9/23/877">Daniel Vetter</a></li></ul></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Wed, 23 Sep 2020 11:19:15 -0700</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: [PATCH 4.19 66/78] fbcon: remove soft scrollback code</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody">On Wed, Sep 23, 2020 at 1:44 AM Pavel Machek &lt;pavel&#64;denx.de&gt; wrote:<br />&gt;<br />&gt; &gt;<br />&gt; &gt; <a href="https://www.openwall.com/lists/oss-security/2020/09/15/2">https://www.openwall.com/lists/oss-security/2020/09/15/2</a><br />&gt;<br />&gt; Thank you for the pointer!<br /><br />Note that for me to be willing to take the softscollback code back, it<br />really would have to be more than just a revert and a trivial fix.<br /><br />It would have to be more along the lines of "this is simplified and<br />verified". For example, at a minimum all the VT_RESIZE etc stuff would<br />have to clearly and obviously reset the soft-scrollback, so that we<br />simply can't have those kinds of issues.<br /><br />If you look at that commit 50145474f6ef ("fbcon: remove soft<br />scrollback code") that removes the code, most of that code really<br />doesn't make much sense.<br /><br />I dare anybody looking at that removed fbcon_redraw_softback()<br />function (or the different cases in fbcon_scrolldelta(), for that<br />matter) to claim they understand what it is doing. It's very odd code,<br />and it handles a lot of odd special cases.<br /><br />So I wouldn't mind re-introducing the scrollback code, but the<br />reintroduced version needs to be simple and fairly _obvious_.  It<br />would need to not have all those odd special cases, and it would need<br />to clearly not have any subtle issues with things like font or screen<br />resizing.<br /><br />I'd also suggest that it not even try to handle the multiple virtual<br />console case.<br /><br />And yes, some of it may involve also clarifying the code in the VT<br />code itself, so that the interactions with the cursor and VT switching<br />is more obvious. Maybe instead of trying to deal with a SW cursor when<br />scrollback is active, just hide the cursor entirely before doing<br />scrollback. And make change_console (and all the resizing) explicitly<br />reset scrollback etc.<br /><br />So the reason the code got removed was that it was just very grotty<br />and hasn't really been maintained for over a decade.<br /><br />In order to resurrect it we'd not just have to have a maintainer, the<br />whole "it's grotty and incomprehensible and has these nasty<br />interactions with random other things" would need to be addressed too.<br /><br />              Linus<br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
