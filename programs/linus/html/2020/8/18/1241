    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2020/8/17/1515">First message in thread</a></li><li><a href="/lkml/2020/8/17/1515">Pavel Machek</a><ul><li class="origin"><a href="/lkml/2020/8/18/1260">Linus Torvalds</a><ul><li><a href="/lkml/2020/8/18/1260">Dave Airlie</a><ul><li><a href="/lkml/2020/8/18/1277">Linus Torvalds</a><ul><li><a href="/lkml/2020/8/19/914">Pavel Machek</a></li><li><a href="/lkml/2020/8/19/1146">Pavel Machek</a></li><li><a href="/lkml/2020/8/20/261">Pavel Machek</a></li></ul></li></ul></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Tue, 18 Aug 2020 17:38:10 -0700</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: 5.9-rc1: graphics regression moved from -next to mainline</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody">Ping on this?<br /><br />The code disassembles to<br /><br />  24: 8b 85 d0 fd ff ff    mov    -0x230(%ebp),%eax<br />  2a:* c7 03 01 00 40 10    movl   $0x10400001,(%ebx) &lt;-- trapping instruction<br />  30: 89 43 04              mov    %eax,0x4(%ebx)<br />  33: 8b 85 b4 fd ff ff    mov    -0x24c(%ebp),%eax<br />  39: 89 43 08              mov    %eax,0x8(%ebx)<br />  3c: e9                    jmp ...<br /><br />which looks like is one of the cases in __reloc_entry_gpu(). I *think*<br />it's this one:<br /><br />        } else if (gen &gt;= 3 &amp;&amp;<br />                   !(IS_I915G(eb-&gt;i915) || IS_I915GM(eb-&gt;i915))) {<br />                *batch++ = MI_STORE_DWORD_IMM | MI_MEM_VIRTUAL;<br />                *batch++ = addr;<br />                *batch++ = target_addr;<br /><br />where that "batch" pointer is 0xf8601000, so it looks like it just<br />overflowed into the next page that isn't there.<br /><br />The cleaned-up call trace is<br /><br />  drm_ioctl+0x1f4/0x38b -&gt;<br />    drm_ioctl_kernel+0x87/0xd0 -&gt;<br />      i915_gem_execbuffer2_ioctl+0xdd/0x360 -&gt;<br />        i915_gem_do_execbuffer+0xaab/0x2780 -&gt;<br />          eb_relocate_vma<br /><br />but there's a lot of inling going on, so..<br /><br />The obvious suspect is commit 9e0f9464e2ab ("drm/i915/gem: Async GPU<br />relocations only") but that's going purely by "that seems to be the<br />main relocation change this mmrge window".<br /><br />                     Linus<br /><br />On Mon, Aug 17, 2020 at 9:11 AM Pavel Machek &lt;pavel&#64;ucw.cz&gt; wrote:<br />&gt;<br />&gt; Hi!<br />&gt;<br />&gt; After about half an hour of uptime, screen starts blinking on thinkpad<br />&gt; x60 and machine becomes unusable.<br />&gt;<br />&gt; I already reported this in -next, and now it is in mainline. It is<br />&gt; 32-bit x86 system.<br />&gt;<br />&gt;<br />&gt;                                                                 Pavel<br />&gt;<br />&gt;<br />&gt; Aug 17 17:36:04 amd ovpn-castor[2828]: UDPv4 link local (bound):<br />&gt; [undef]<br />&gt; Aug 17 17:36:04 amd ovpn-castor[2828]: UDPv4 link remote:<br />&gt; [AF_INET]87.138.219.28:1194<br />&gt; Aug 17 17:36:23 amd kernel: BUG: unable to handle page fault for<br />&gt; address: f8601000<br />&gt; Aug 17 17:36:23 amd kernel: #PF: supervisor write access in kernel<br />&gt; mode<br />&gt; Aug 17 17:36:23 amd kernel: #PF: error_code(0x0002) - not-present page<br />&gt; Aug 17 17:36:23 amd kernel: *pdpt = 00000000318f2001 *pde =<br />&gt; 0000000000000000<br />&gt; Aug 17 17:36:23 amd kernel: Oops: 0002 [#1] PREEMPT SMP PTI<br />&gt; Aug 17 17:36:23 amd kernel: CPU: 1 PID: 3004 Comm: Xorg Not tainted<br />&gt; 5.9.0-rc1+ #86<br />&gt; Aug 17 17:36:23 amd kernel: Hardware name: LENOVO 17097HU/17097HU,<br />&gt; BIOS 7BETD8WW (2.19 ) 03/31<br />&gt; /2011<br />&gt; Aug 17 17:36:23 amd kernel: EIP: eb_relocate_vma+0xcf6/0xf20<br />&gt; Aug 17 17:36:23 amd kernel: Code: e9 ff f7 ff ff c7 85 c0 fd ff ff ed<br />&gt; ff ff ff c7 85 c4 fd ff<br />&gt; ff ff ff ff ff 8b 85 c0 fd ff ff e9 a5 f8 ff ff 8b 85 d0 fd ff ff &lt;c7&gt;<br />&gt; 03 01 00 40 10 89 43 04<br />&gt;  8b 85 b4 fd ff ff 89 43 08 e9 9f f7 ff<br />&gt;  Aug 17 17:36:23 amd kernel: EAX: 003c306c EBX: f8601000 ECX: 00847000<br />&gt;  EDX: 00000000<br />&gt;  Aug 17 17:36:23 amd kernel: ESI: 00847000 EDI: 00000000 EBP: f1947c68<br />&gt;  ESP: f19479fc<br />&gt;  Aug 17 17:36:23 amd kernel: DS: 007b ES: 007b FS: 00d8 GS: 00e0 SS:<br />&gt;  0068 EFLAGS: 00210246<br />&gt;  Aug 17 17:36:23 amd kernel: CR0: 80050033 CR2: f8601000 CR3: 31a1e000<br />&gt;  CR4: 000006b0<br />&gt;  Aug 17 17:36:23 amd kernel: Call Trace:<br />&gt;  Aug 17 17:36:23 amd kernel: ? i915_vma_pin+0xc5/0x8c0<br />&gt;  Aug 17 17:36:23 amd kernel: ? __mutex_unlock_slowpath+0x2b/0x280<br />&gt;  Aug 17 17:36:23 amd kernel: ? __active_retire+0x7e/0xd0<br />&gt;  Aug 17 17:36:23 amd kernel: ? mutex_unlock+0xb/0x10<br />&gt;  Aug 17 17:36:23 amd kernel: ? i915_vma_pin+0xc5/0x8c0<br />&gt;  Aug 17 17:36:23 amd kernel: ? __lock_acquire.isra.31+0x261/0x530<br />&gt;  Aug 17 17:36:23 amd kernel: ? eb_lookup_vmas+0x1f5/0x9e0<br />&gt;  Aug 17 17:36:23 amd kernel: i915_gem_do_execbuffer+0xaab/0x2780<br />&gt;  Aug 17 17:36:23 amd kernel: ? _raw_spin_unlock_irqrestore+0x27/0x40<br />&gt;  Aug 17 17:36:23 amd kernel: ? __lock_acquire.isra.31+0x261/0x530<br />&gt;  Aug 17 17:36:23 amd kernel: ? __lock_acquire.isra.31+0x261/0x530<br />&gt;  Aug 17 17:36:23 amd kernel: ? kvmalloc_node+0x69/0x70<br />&gt;  Aug 17 17:36:23 amd kernel: i915_gem_execbuffer2_ioctl+0xdd/0x360<br />&gt;  Aug 17 17:36:23 amd kernel: ? i915_gem_execbuffer_ioctl+0x2b0/0x2b0<br />&gt;  Aug 17 17:36:23 amd kernel: drm_ioctl_kernel+0x87/0xd0<br />&gt;  Aug 17 17:36:23 amd kernel: drm_ioctl+0x1f4/0x38b<br />&gt;  Aug 17 17:36:23 amd kernel: ? i915_gem_execbuffer_ioctl+0x2b0/0x2b0<br />&gt;  Aug 17 17:36:23 amd kernel: ? posix_get_monotonic_timespec+0x1c/0x90<br />&gt;  Aug 17 17:36:23 amd kernel: ? ktime_get_ts64+0x7a/0x1e0<br />&gt;  Aug 17 17:36:23 amd kernel: ? drm_ioctl_kernel+0xd0/0xd0<br />&gt;  Aug 17 17:36:23 amd kernel: __ia32_sys_ioctl+0x1ad/0x799<br />&gt;  Aug 17 17:36:23 amd kernel: ? debug_smp_processor_id+0x12/0x20<br />&gt;  Aug 17 17:36:23 amd kernel: ? exit_to_user_mode_prepare+0x4f/0x100<br />&gt;  Aug 17 17:36:23 amd kernel: do_int80_syscall_32+0x2c/0x40<br />&gt;  Aug 17 17:36:23 amd kernel: entry_INT80_32+0x111/0x111<br />&gt;  Aug 17 17:36:23 amd kernel: EIP: 0xb7fbc092<br />&gt;  Aug 17 17:36:23 amd kernel: Code: 00 00 00 e9 90 ff ff ff ff a3 24 00<br />&gt;  00 00 68 30 00 00 00 e9 80 ff ff ff ff a3 e8 ff ff ff 66 90 00 00 00<br />&gt;  00 00 00 00 00 cd 80 &lt;c3&gt; 8d b4 26 00 00 00 00 8d b6 00 00 00 00 8b<br />&gt;  1c 24 c3 8d b4 26 00<br />&gt;  Aug 17 17:36:23 amd kernel: EAX: ffffffda EBX: 0000000a ECX: c0406469<br />&gt;  EDX: bff0ae3c<br />&gt;  Aug 17 17:36:23 amd kernel: ESI: b73aa000 EDI: c0406469 EBP: 0000000a<br />&gt;  ESP: bff0adb4<br />&gt;  Aug 17 17:36:23 amd kernel: DS: 007b ES: 007b FS: 0000 GS: 0033 SS:<br />&gt;  007b EFLAGS: 00200296<br />&gt;  Aug 17 17:36:23 amd kernel: ? asm_exc_nmi+0xcc/0x2bc<br />&gt;  Aug 17 17:36:23 amd kernel: Modules linked in:<br />&gt;  Aug 17 17:36:23 amd kernel: CR2: 00000000f8601000<br />&gt;  Aug 17 17:36:23 amd kernel: ---[ end trace 2ca9775068bbac06 ]---<br />&gt;<br />&gt; --<br />&gt; (english) <a href="https://www.livejournal.com/~pavelmachek">http://www.livejournal.com/~pavelmachek</a><br />&gt; (cesky, pictures) <a href="http://atrey.karlin.mff.cuni.cz/~pavel/picture/horses/blog.html">http://atrey.karlin.mff.cuni.cz/~pavel/picture/horses/blog.html</a><br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
