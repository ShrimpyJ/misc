    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2020/8/28/90">First message in thread</a></li><li><a href="/lkml/2020/8/29/318">Linus Torvalds</a><ul><li><a href="/lkml/2020/8/29/362">Guenter Roeck</a><ul><li class="origin"><a href="/lkml/2020/8/30/409">Linus Torvalds</a><ul><li><a href="/lkml/2020/8/30/409">Michael Ellerman</a></li><li><a href="/lkml/2020/8/31/72">Vinod Koul</a></li><li><a href="/lkml/2020/8/31/495">Leo Li</a></li></ul></li></ul></li><li><a href="/lkml/2020/8/30/114">Luc Van Oostenryck</a></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Sat, 29 Aug 2020 14:20:14 -0700</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: [PATCH] fsldma: fsl_ioread64*() do not need lower_32_bits()</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody">On Sat, Aug 29, 2020 at 1:40 PM Guenter Roeck &lt;linux&#64;roeck-us.net&gt; wrote:<br />&gt;<br />&gt; Except for<br />&gt;<br />&gt; CHECK: spaces preferred around that '+' (ctx:VxV)<br />&gt; #29: FILE: drivers/dma/fsldma.h:223:<br />&gt; +       u32 val_lo = in_be32((u32 __iomem *)addr+1);<br /><br />Added spaces.<br /><br />&gt; I don't see anything wrong with it either, so<br />&gt;<br />&gt; Reviewed-by: Guenter Roeck &lt;linux&#64;roeck-us.net&gt;<br />&gt;<br />&gt; Since I didn't see the real problem with the original code,<br />&gt; I'd take that with a grain of salt, though.<br /><br />Well, honestly, the old code was so confused that just making it build<br />is clearly already an improvement even if everything else were to be<br />wrong.<br /><br />So I committed my "fix". If it turns out there's more wrong in there<br />and somebody tests it, we can fix it again. But now it hopefully<br />compiles, at least.<br /><br />My bet is that if that driver ever worked on ppc32, it will continue<br />to work whatever we do to that function.<br /><br />I _think_ the old code happened to - completely by mistake - get the<br />value right for the case of "little endian access, with dma_addr_t<br />being 32-bit". Because then it would still read the upper bits wrong,<br />but the cast to dma_addr_t would then throw those bits away. And the<br />lower bits would be right.<br /><br />But for big-endian accesses or for ARCH_DMA_ADDR_T_64BIT it really<br />looks like it always returned a completely incorrect value.<br /><br />And again - the driver may have worked even with that completely<br />incorrect value, since the use of it seems to be very incidental.<br /><br />In either case ("it didn't work before" or "it worked because the<br />value doesn't really matter"), I don't think I could possibly have<br />made things worse.<br /><br />Famous last words.<br /><br />                Linus<br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
