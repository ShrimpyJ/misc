    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2007/9/13/132">First message in thread</a></li><li><a href="/lkml/2007/9/13/332">Andreas Herrmann</a><ul><li><a href="/lkml/2007/9/13/333">Luca Risolia</a><ul><li class="origin"><a href="/lkml/2007/9/13/386">Linus Torvalds</a><ul><li><a href="/lkml/2007/9/13/386">Luca Risolia</a><ul><li><a href="/lkml/2007/9/14/27">	aherrman&#64;arcor ...</a></li></ul></li></ul></li></ul></li></ul></li></ul><div class="threadlist">Patch in this message</div><ul class="threadlist"><li><a href="/lkml/diff/2007/9/13/369/1">Get diff 1</a></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><script type="text/javascript" src="//pagead2.googlesyndication.com/pagead/show_ads.js"></script><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Thu, 13 Sep 2007 17:09:01 -0700 (PDT)</td></tr><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: [PATCH] v4l: fix build error for et61x251 driver</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody"><br /><br />On Fri, 14 Sep 2007, Luca Risolia wrote:<br /><br />&gt; Hacked-by: Luca Risolia &lt;luca.risolia&#64;studio.unibo.it&gt;<br />&gt; <br />&gt; On Friday 14 September 2007 00:27:17 Andreas Herrmann wrote:<br />&gt; &gt; This fixes a kernel build problem and<br />&gt; &gt; should make it into 2.6.23, I think.<br />&gt; &gt;<br />&gt; &gt;<br />&gt; &gt; Regards,<br />&gt; &gt;<br />&gt; &gt; Andreas<br />&gt; &gt;<br />&gt; &gt; --<br />&gt; &gt;<br />&gt; &gt; Get rid of some v4l1 remainders to avoid kernel build errors if<br />&gt; &gt; V4L1_COMPAT is not selected:<br />&gt; &gt;<br />&gt; &gt;   drivers/media/video/et61x251/et61x251_core.c: In et61x251_show_:<br />&gt; &gt;   drivers/media/video/et61x251/et61x251_core.c:718: error: implicit<br />&gt; &gt;     declaration of to_video_device<br />&gt; &gt;<br />&gt; &gt; Fix as suggested by  Luca Risolia &lt;luca.risolia&#64;studio.unibo.it&gt;<br /><br />This patch is really ugly.<br /><br />Why can't the "to_video_device()" macro be used? Just move it to a place <br />where it's usable! IOW, what's wrong with the *much* simpler patch below?<br /><br />That "to_video_device()" macro has absolutely _nothing_ to do with <br />CONFIG_VIDEO_V4L1_COMPAT, as far as I can tell!<br /><br />			Linus<br />---<br />diff --git a/include/media/v4l2-dev.h b/include/media/v4l2-dev.h<br />index d62847f..17f8f3a 100644<br />--- a/include/media/v4l2-dev.h<br />+++ b/include/media/v4l2-dev.h<br />&#64;&#64; -337,6 +337,9 &#64;&#64; void *priv;<br /> 	struct class_device class_dev; /* sysfs */<br /> };<br /> <br />+/* Class-dev to video-device */<br />+#define to_video_device(cd) container_of(cd, struct video_device, class_dev)<br />+<br /> /* Version 2 functions */<br /> extern int video_register_device(struct video_device *vfd, int type, int nr);<br /> void video_unregister_device(struct video_device *);<br />&#64;&#64; -354,11 +357,9 &#64;&#64; extern int video_usercopy(struct inode *inode, struct file *file,<br /> 			  int (*func)(struct inode *inode, struct file *file,<br /> 				      unsigned int cmd, void *arg));<br /> <br />-<br /> #ifdef CONFIG_VIDEO_V4L1_COMPAT<br /> #include &lt;linux/mm.h&gt;<br /> <br />-#define to_video_device(cd) container_of(cd, struct video_device, class_dev)<br /> static inline int __must_check<br /> video_device_create_file(struct video_device *vfd,<br /> 			 struct class_device_attribute *attr)<br />-<br />To unsubscribe from this list: send the line "unsubscribe linux-kernel" in<br />the body of a message to majordomo&#64;vger.kernel.org<br />More majordomo info at  <a href="http://vger.kernel.org/majordomo-info.html">http://vger.kernel.org/majordomo-info.html</a><br />Please read the FAQ at  <a href="http://www.tux.org/lkml/">http://www.tux.org/lkml/</a><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
