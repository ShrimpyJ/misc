    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2007/9/18/40">First message in thread</a></li><li><a href="/lkml/2007/9/20/417">Thomas Gleixner</a><ul><li><a href="/lkml/2007/9/20/429">"Rafael J. Wysocki"</a><ul><li><a href="/lkml/2007/9/20/435">Thomas Gleixner</a><ul><li><a href="/lkml/2007/9/20/454">"Rafael J. Wysocki"</a></li><li><a href="/lkml/2007/9/21/54">"Rafael J. Wysocki"</a></li></ul></li></ul></li><li><a href="/lkml/2007/9/20/431">Linus Torvalds</a><ul><li><a href="/lkml/2007/9/20/433">"Rafael J. Wysocki"</a><ul><li><a href="/lkml/2007/9/20/452">Thomas Gleixner</a></li></ul></li><li class="origin"><a href="/lkml/2007/9/20/443">Linus Torvalds</a><ul><li><a href="/lkml/2007/9/20/443">Thomas Gleixner</a><ul><li><a href="/lkml/2007/9/20/453">"Rafael J. Wysocki"</a></li></ul></li><li><a href="/lkml/2007/9/20/468">Len Brown</a><ul><li><a href="/lkml/2007/9/21/35">Thomas Gleixner</a></li></ul></li><li><a href="/lkml/2007/9/21/12">Paul Mackerras</a><ul><li><a href="/lkml/2007/9/21/36">Thomas Gleixner</a></li></ul></li></ul></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Thu, 20 Sep 2007 14:55:28 -0700 (PDT)</td></tr><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: 2.6.23-rc6-mm1: failure to boot on HP nx6325, no sound when booted, USB-related WARNING</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody"><br /><br />On Thu, 20 Sep 2007, Linus Torvalds wrote:<br />&gt; <br />&gt; (Btw, the above commit message points to just my response with a testing <br />&gt; patch to the real email: the actual explanation of the INSANE ordering is <br />&gt; from Len Brown in<br />&gt; <br />&gt; 	<a href="https://lists.linux-foundation.org/pipermail/linux-pm/2006-November/004161.html">https://lists.linux-foundation.org/pipermail/linux-pm/2006-November/004161.html</a><br />&gt; <br />&gt; and there Len claims that we *must* wake up CPU's early).<br /><br />..and points to commit 1a38416cea8ac801ae8f261074721f35317613dc which in <br />turn talks about <a href="https://bugzilla.kernel.org/show_bug.cgi?id=5651">http://bugzilla.kernel.org/show_bug.cgi?id=5651</a> <br /><br />Howerver, it seems that bugzilla entry may just be bogus. It talks about <br />"it appears that some firmware in the future may depend on that sequence <br />for correction operation"<br /><br />Len, Shaohua, what are the real issues here? <br /><br />It would indeed be nice if we could just take CPU's down early (while <br />everything is working), and run the whole suspend code with just one CPU, <br />rather than having to worry about the ordering between CPU and device <br />takedown.<br /><br />That said, at least with STR, the situation is:<br /><br /> 1) suspend_console<br /> 2)   device_suspend(PMSG_SUSPEND)	  (==   -&gt;suspend)<br /> 3)     disable_nonboot_cpus()<br /> 4)       device_power_down(PMSG_SUSPEND) (==   -&gt;suspend_late)<br /> 5)         pm_ops-&gt;enter()<br /> 6)       device_power_up()		  (==   -&gt;resume_early)<br /> 7)     enable_nonboot_cpus()<br /> 8)     pm_finish()<br /> 9)   device_resume()		          (==   -&gt;resume<br />10) resume_console<br /><br />So if we agree that things like timers etc should *never* be suspended by <br />the early suspend, and *always* use "suspend_late/resume_early", then at <br />least STR should be ok.<br /><br />And I think that's a damn reasonable thing to agree on: timers (and <br />anything else that CPU shutdown/bringup could *possibly* care about) <br />should be considered core enough that they had better be on the <br />suspend_late/resume_early list.<br /><br />Thomas, Rafael, can you verify that at least STR is ok in this respect?<br /><br />		Linus<br />-<br />To unsubscribe from this list: send the line "unsubscribe linux-kernel" in<br />the body of a message to majordomo&#64;vger.kernel.org<br />More majordomo info at  <a href="http://vger.kernel.org/majordomo-info.html">http://vger.kernel.org/majordomo-info.html</a><br />Please read the FAQ at  <a href="http://www.tux.org/lkml/">http://www.tux.org/lkml/</a><br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
