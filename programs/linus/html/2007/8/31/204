    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2007/8/30/234">First message in thread</a></li><li><a href="/lkml/2007/8/30/323">Linus Torvalds</a><ul><li><a href="/lkml/2007/8/30/324">"Hua Zhong"</a></li><li><a href="/lkml/2007/8/31/15">Trond Myklebust</a><ul><li><a href="/lkml/2007/8/31/24">Linus Torvalds</a><ul><li><a href="/lkml/2007/8/31/21">Linus Torvalds</a></li><li><a href="/lkml/2007/8/31/23">Trond Myklebust</a></li><li><a href="/lkml/2007/8/31/26">"Hua Zhong"</a></li><li><a href="/lkml/2007/8/31/31">Ian Kent</a><ul><li><a href="/lkml/2007/8/31/77">Martin Knoblauch</a></li></ul></li><li><a href="/lkml/2007/8/31/53">Jakob Oestergaard</a><ul><li><a href="/lkml/2007/8/31/64">Linus Torvalds</a></li><li><a href="/lkml/2007/8/31/70">Frank van Maarseveen</a></li></ul></li></ul></li></ul></li><li><a href="/lkml/2007/8/31/189">Trond Myklebust</a><ul><li class="origin"><a href="/lkml/2007/8/31/231">Linus Torvalds</a><ul><li><a href="/lkml/2007/8/31/231">Trond Myklebust</a></li><li><a href="/lkml/2007/9/4/20">David Howells</a></li><li><a href="/lkml/2007/9/4/32">David Howells</a><ul><li><a href="/lkml/2007/9/4/38">Linus Torvalds</a></li></ul></li></ul></li><li><a href="/lkml/2007/8/31/228">"Hua Zhong"</a><ul><li><a href="/lkml/2007/8/31/232">Trond Myklebust</a><ul><li><a href="/lkml/2007/8/31/235">"Hua Zhong"</a></li><li><a href="/lkml/2007/8/31/237">"Hua Zhong"</a></li></ul></li></ul></li><li><a href="/lkml/2007/9/1/206">Bill Davidsen</a><ul><li><a href="/lkml/2007/9/4/19">David Howells</a><ul><li><a href="/lkml/2007/9/5/71">Bill Davidsen</a></li><li><a href="/lkml/2007/9/5/72">Ian Kent</a></li></ul></li></ul></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Fri, 31 Aug 2007 10:01:50 -0700 (PDT)</td></tr><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: recent nfs change causes autofs regression</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody"><br /><br />On Fri, 31 Aug 2007, Trond Myklebust wrote:<br />&gt;<br />&gt; The best I can do given the constraints appears to be to have the kernel<br />&gt; first look for a superblock that matches both the fsid and the<br />&gt; user-specified mount options, and then spawn off a new superblock if<br />&gt; that search fails.<br /><br />I think this is probably acceptable to get roughly the old behaviour, but <br />I still think it's a bit stupid.<br /><br />What happens at "mount -o remount,..." time?<br /><br />The fact is, the whole "match the fsid and user mount options, and re-use <br />the mount" sounds like it's trying to solve a problem that doesn't need <br />solving. If the user really wants to duplicate the mount, he really should <br />be using a a bind-mount instead.<br /><br />In other words, let's assume that the user has /some/nfs/mount mounted <br />over NFS, and wants to re-mount it (or even just a subset of it) somewhere <br />else, the sane thing to do is not to mount it again, but to just do<br /><br />	mount --bind /some/nfs/mount/subdir /new/mount/place<br /><br />instead. That *guarantees* that the low-level filesystem uses the same <br />flags, and it also means that things like re-mounting have sane and <br />well-defined semantics, and will fail or succeed predictably.<br /><br />In contrast, if a user wants to create a new NFS mount, it really should <br />be independent of the old one, because that's (a) what other systems do, <br />and (b) also makes the semantics of re-mounting it with other flags be <br />clear and unambiguous (ie the remount has nothing what-so-ever to do with <br />the independent NFS mount).<br /><br />See? <br /><br />This is why I think "nosharecache" should just be the default, because <br />that's the behaviour that simply does not have any subtle issues. The <br />*special* case should be the "sharecache" case, and 99% of the time that <br />one should likely be done with a "--bind" mount.<br /><br />(I don't really see the point of _ever_ doing anything but a bind mount, <br />but maybe there are reasons to try to share at a NFS layer that I don't <br />really see)<br /><br />&gt; The attached patch does just that.<br /><br />Hua, does this fix things for you? If it gets rid of the regression, I can <br />certainly live with it, but as per above, I don't really think this makes <br />much sense in the "bigger picture" kind of thing.<br /><br />&gt; Finally, for the record: I still feel very uncomfortable about not being<br />&gt; able to report the state of the client setup back to the sysadmin.<br />&gt; AFAIK, the only way to do so is to stat the mountpoints, and compare the<br />&gt; device ids.<br /><br />Well, not only don't I see that as being horribly wrong, I actually think <br />that the sysadmin should know what his mount setup is, even without having <br />to ask. But since he *can* ask, using easy and standard interfaces, I <br />don't really see what the problem really is.<br /><br />			Linus<br />-<br />To unsubscribe from this list: send the line "unsubscribe linux-kernel" in<br />the body of a message to majordomo&#64;vger.kernel.org<br />More majordomo info at  <a href="http://vger.kernel.org/majordomo-info.html">http://vger.kernel.org/majordomo-info.html</a><br />Please read the FAQ at  <a href="http://www.tux.org/lkml/">http://www.tux.org/lkml/</a><br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
