    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2007/10/16/443">First message in thread</a></li><li><a href="/lkml/2007/10/16/443">Al Viro</a><ul><li class="origin"><a href="/lkml/2007/10/16/475">Linus Torvalds</a><ul><li><a href="/lkml/2007/10/16/475">Linus Torvalds</a><ul><li><a href="/lkml/2007/10/17/241">=?iso-8859-1?Q?Bj=F6rn?= Steinbrink</a><ul><li><a href="/lkml/2007/10/17/306">=?iso-8859-1?Q?Bj=F6rn?= Steinbrink</a></li></ul></li></ul></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Tue, 16 Oct 2007 18:21:30 -0700 (PDT)</td></tr><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: [PATCH] fix adbhid mismerge</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody"><br /><br />On Wed, 17 Oct 2007, Al Viro wrote:<br />&gt;<br />&gt; 	Something really odd has happened: the last couple of changesets<br />&gt; have<br />&gt; -       int up_flag;<br />&gt; +       int keycode, up_flag;<br />&gt; and<br />&gt; -       int up_flag;<br />&gt; +       int up_flag, key;<br />&gt; in another, both in adb_input_keycode().  Even with -m passed to<br />&gt; git-whatchanged there's no sign of anything in that area.<br /><br />I don't think you did anything wrong. You used both --full-history <br />(implicitly: git-whatchanged) and you made sure to see the diffs for both <br />sides of any merge (-m), and that means that you should see every single <br />diff involved.<br /><br />Looking into it, the "key" variable was declared in the commit that <br />introduced the new line<br /><br />	int up_flag, key;<br />	..<br />	key = adbhid[id]-&gt;keycode[keycode];<br /><br />which is commit 555ddbb4e2191c8823df2d61525218ac39481385. But then that <br />declaration of "int key" goes away at some later time.<br /><br />And doing a<br /><br />	git whatchanged -p -m 555ddbb4e2191c8823df2d61525218ac39481385.. drivers/macintosh/adbhid.c<br /><br />does actually show the culprit. It's just that the "-p -m" format is so <br />damn unreadable that it's almost impossible to see.<br /><br />Anyway, it's b981d8b3f5e008ff10d993be633ad00564fc22cd, which had a <br />conflict in that file, and Dmitry apparently mis-merged it and edited the <br />result down so that it didn't have 'key' declared any more.<br /><br />So the way I found it was to just search for the line in the diffs that <br />makes that thing go away, ie just look for the line in the diffs that says<br /><br />	-	int up_flag, key;<br /><br />and then you need to look at which of those are totally bogus and are just <br />because it shows the diff against one of the earlier trees that also don't <br />have that "key = adbhid[...]" line!<br /><br />(And that is actually *much* less obvious than it should be, since a lot <br />of the case of those lines going away is becuase I had merged Dmitry's <br />tree in the first place)<br /><br />You can make git help you narrow it down a bit more by using -S, ie some <br />horrible command line from hell like this:<br /><br />	git whatchanged -S'int up_flag, key;' -m -p 		\<br />		555ddbb4e2191c8823df2d61525218ac39481385..	\<br />		drivers/macintosh/adbhid.c<br /><br />will actually show only those commits that add/remove a line like the one <br />you are wondering where it went. That can cut down on the noise a bit, but <br />you'll get all the same false alarms, so no, it's probably not worth it.<br /><br />In general, I'm afraid that merge errors are simply not very easy to find. <br />The problem in this case is in that b981d8b3f5 merge, but if you actually <br />then do a "git show b981d8b3f5" you won't even see the problem spot in the <br />default "--cc" format output, because Dmitry had resolved that problmatic <br />place to be the same as one of the parent branches, and that makes git not <br />show the diff for it (since it's "uninteresting")<br /><br />			Linus<br />-<br />To unsubscribe from this list: send the line "unsubscribe linux-kernel" in<br />the body of a message to majordomo&#64;vger.kernel.org<br />More majordomo info at  <a href="http://vger.kernel.org/majordomo-info.html">http://vger.kernel.org/majordomo-info.html</a><br />Please read the FAQ at  <a href="http://www.tux.org/lkml/">http://www.tux.org/lkml/</a><br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
