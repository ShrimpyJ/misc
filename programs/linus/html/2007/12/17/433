    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2007/12/14/258">First message in thread</a></li><li><a href="/lkml/2007/12/17/400">"Tony Luck"</a><ul><li><a href="/lkml/2007/12/17/406">Arjan van de Ven</a><ul><li class="origin"><a href="/lkml/2007/12/17/437">Linus Torvalds</a><ul><li><a href="/lkml/2007/12/17/437">Arjan van de Ven</a></li><li><a href="/lkml/2007/12/17/485">Theodore Tso</a><ul><li><a href="/lkml/2007/12/18/26">Arjan van de Ven</a></li><li><a href="/lkml/2007/12/18/56">Jon Masters</a></li></ul></li><li><a href="/lkml/2007/12/18/208">Arjan van de Ven</a><ul><li><a href="/lkml/2007/12/18/214">Matt Mackall</a></li></ul></li></ul></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Mon, 17 Dec 2007 16:21:12 -0800 (PST)</td></tr><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: Top kernel oopses/warnings this week</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody"><br /><br />On Mon, 17 Dec 2007, Arjan van de Ven wrote:<br />&gt;<br />&gt; +char *get_boot_uuid(void)<br />&gt; +{<br />&gt; +	static char target[38];<br />&gt; +	unsigned char *uuid;<br />&gt; +<br />&gt; +	if (sysctl_bootid[8] == 0)<br />&gt; +		generate_random_uuid(sysctl_bootid);<br />&gt; +	/* sysctl_bootid is signed, to print we need unsigned .. */<br />&gt; +	uuid = sysctl_bootid;<br />&gt; +<br />&gt; +	if (target[0] == 0) {<br />&gt; +		sprintf(target, "%02x%02x%02x%02x-%02x%02x-%02x%02x-%02x%02x-"<br />&gt; +			"%02x%02x%02x%02x%02x%02x",<br /><br />Why isn't *everything* inside that "if (target[0] == 0" check?<br /><br />IOW, that function should look something like<br /><br />	const char *get_boot_uuid(void)<br />	{<br />		static char target[38];<br /><br />		if (!target[0])<br />			fill_boot_uid(target)<br />		return target;<br />	}<br /><br />which also allows you to clean it up a bit.<br /><br />I'd _also_ suggest that you'd actually try to avoid that horrid sequence <br />of "%02x..", and instead just make sure that sysctl_bootid[] is 4-byte <br />aligned, and then you can do<br /><br />	sprintf("%08x-%04x-%04x-%04x-%04x%08x",<br />		ntohl(0[(u32 *)uuid]),<br />		ntohs(2[(u16 *)uuid]),<br />		ntohs(3[(u16 *)uuid]),<br />		ntohs(4[(u16 *)uuid]),<br />		ntohs(5[(u16 *)uuid]),<br />		ntohl(3[(u32 *)uuid]));<br /><br />which also gets bonus points for being totally unreadable, and thus 100% <br />in the spirit of uuid's.<br /><br />		Linus<br /><br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
