    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2007/12/15/128">First message in thread</a></li><li><a href="/lkml/2007/12/20/335">Linus Torvalds</a><ul><li><a href="/lkml/2007/12/20/361">Jan Kara</a><ul><li class="origin"><a href="/lkml/2007/12/20/651">Linus Torvalds</a><ul><li><a href="/lkml/2007/12/20/651">Nick Piggin</a></li></ul></li></ul></li><li><a href="/lkml/2007/12/20/546">=?iso-8859-1?Q?Bj=F6rn?= Steinbrink</a><ul><li><a href="/lkml/2007/12/21/201">Krzysztof Oledzki</a><ul><li><a href="/lkml/2007/12/21/206">=?iso-8859-1?Q?Bj=F6rn?= Steinbrink</a></li></ul></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><script type="text/javascript" src="//pagead2.googlesyndication.com/pagead/show_ads.js"></script><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Thu, 20 Dec 2007 11:24:01 -0800 (PST)</td></tr><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: [Bug 9182] Critical memory leak (dirty pages)</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody"><br /><br />On Thu, 20 Dec 2007, Jan Kara wrote:<br />&gt;<br />&gt;   As I wrote in my previous email, this solution works but hides the<br />&gt; fact that the page really *has* dirty data in it and *is* pinned in memory<br />&gt; until the commit code gets to writing it. So in theory it could disturb<br />&gt; the writeout logic by having more dirty data in memory than vm thinks it<br />&gt; has. Not that I'd have a better fix now but I wanted to point out this<br />&gt; problem.<br /><br />Well, I worry more about the VM being sane - and by the time we actually <br />hit this case, as far as VM sanity is concerned, the page no longer really <br />exists. It's been removed from the page cache, and it only really exists <br />as any other random kernel allocation.<br /><br />The fact that low-level filesystems (in this case ext3 journaling) do <br />their own insane things is not something the VM even _should_ care about. <br />It's just an internal FS allocation, and the FS can do whatever the hell <br />it wants with it, including doing IO etc.<br /><br />The kernel doesn't consider any other random IO pages to be "dirty" either <br />(eg if you do direct-IO writes using low-level SCSI commands, the VM <br />doesn't consider that to be any special dirty stuff, it's just random page <br />allocations again). This is really no different.<br /><br />In other words: the Linux "VM" subsystem is really two differnt parts: the <br />low-level page allocator (which obviously knows that the page is still in <br />*use*, since it hasn't been free'd), and the higher-level file mapping and <br />caching stuff that knows about things like page "dirtyiness". And once <br />you've done a "remove_from_page_cache()", the higher levels are no longer <br />involved, and dirty accounting simply doesn't get into the picture.<br /><br />			Linus<br /><br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
