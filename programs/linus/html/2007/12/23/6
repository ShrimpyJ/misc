    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2007/12/22/54">First message in thread</a></li><li><a href="/lkml/2007/12/22/181">Jeff Garzik</a><ul><li><a href="/lkml/2007/12/22/185">Linus Torvalds</a><ul><li><a href="/lkml/2007/12/23/2">Jeff Garzik</a></li><li class="origin"><a href="/lkml/2007/12/23/7">Linus Torvalds</a><ul><li><a href="/lkml/2007/12/23/7">Jeff Garzik</a></li></ul></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Sat, 22 Dec 2007 21:18:25 -0800 (PST)</td></tr><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: [patch] Make MMCONFIG space (extended PCI config space) a driver opt-in issue</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody"><br /><br />On Sun, 23 Dec 2007, Jeff Garzik wrote:<br />&gt; <br />&gt; Then let's do it right:  disable mmconfig by default on x86, and enable it<br />&gt; when passed "pci=mmconfig".<br /><br />I'm certainly ok with that, but then you say:<br /><br />&gt; &gt; And yes, if you want the capability following to notice automatically when<br />&gt; &gt; capabilities really do go into the 0x100+ range, that's fine. I suspect <br />&gt; <br />&gt; Yes, we /must/ do this checking, if we don't already.<br /><br />Hell no. If the user asked for mmconfig to be disabled, it needs to be <br />disabled, because it may well be broken and non-working. It's better to <br />not see some capabilities than to lock up the machine.<br /><br />So what is it? Is it "some machines do it automatically when needed" or is <br />it "always disabled"?<br /><br />You seem to now say that "always disabled by default" isn't good either.<br /><br />What do I need to do to convince you that the *right* thing to do is:<br /><br /> - disabled by default, unless user *explicitly* asks for it with <br />   "pci=mmconfig"<br /><br /> - but certain events will enable it automatically, unless the user <br />   *explicitly* said (or we had a quirk that explicitly disabled it) <br />   something like pci=mmconfig<br /><br />See what I'm saying? You don't really seem to be disagreeing. It seems to <br />be, in fact, exactly what you want.<br /><br />I'm saying that yes, the PCI capability code might be one such "enable <br />mmconfig if not explicitly disabled" user.<br /><br />But I also suspect that some drivers might want to do it, and I'm almost <br />certain that some DMI quirks will want to do it (ie "I recognize this <br />machine, and this machine is from 2011, and wants MMCONFIG"). So we need <br />to have an interface for those quirks or other events to also do it, it <br />cannot be just a "PCI capabilities do it".<br /><br />Quite frankly, the fewer drivers that do it, the happier I am. Maybe *no* <br />drivers will do it. If so, "Hallelujah, brother, give me an Amen!". But we <br />clearly want an interface for _some_ things to say "we might want to have <br />mmconfig". Maybe it's only PCI capabilities. <br /><br />Regardless. Even if *no* driver ever does it, the logical interface will <br />clearly be "pci_enable_mmio(pdev)".<br /><br />You can then argue all you want against individual drivers actually ever <br />using it, and I'll support you on that. I think MMCONFIG was/is a total <br />waste of everybodys time.<br /><br />			Linus<br /><br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
