    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/1996/4/12/48">First message in thread</a></li><li><a href="/lkml/1996/4/12/48">"Mark E. Levitt"</a><ul><li class="origin"><a href="/lkml/1996/4/13/52">Linus Torvalds</a><ul><li><a href="/lkml/1996/4/13/52">"Mark E. Levitt"</a></li><li><a href="/lkml/1996/4/14/16"> roque&#64;di ...</a></li></ul></li><li><a href="/lkml/1996/4/16/115">root</a></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Sat, 13 Apr 1996 11:48:43 +0300 (EET DST)</td></tr><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: 1.3.87 and SLOW SLIP/PPP</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody"><br /><br />On Fri, 12 Apr 1996, Mark E. Levitt wrote:<br />&gt; <br />&gt;   It's definitly better.  I haven't done anything extensive to test it <br />&gt; other than look at interactive telnet response.  It seems to be keeping <br />&gt; up with my typing well enough to use the Solaris hosts again.  <br /><br />Ok, 1.3.87 seems to be fine except for the lack of ACK's in some <br />circumstances (I've posted a small patch to the kernel mailing list: mail <br />me if you didn't get it).<br /><br />I think I'll be able to start the _real_ codefreeze again now that those <br />pesky ppp problems are hopefully fixed. Maybe we really can get it frozen <br />now.<br /><br />&gt;   I quickly tried the SunOS host and it doesn't seem any slower than the <br />&gt; Solaris host.<br />&gt;   I do have to say that they *both* seem a *little* bit slower in 1.3.87.<br />&gt; However, this may just be a fluke due to some other problem with the <br />&gt; connection. <br /><br />The 1.3.87 patch does something experimental: it does delay ack's for <br />"psh" packets, but the delay is shorter than usual (0.1 sec instead of <br />0.5 sec). That helps the Nagle rule on the other side to coalesce packets <br />as appropriate if there are more writes soon afterwards, but on the other <br />hand it might still be noticeable in for a fast typist that expects to <br />see the characters one by one.<br /><br />Somebody (Alan?) said that BSD doesn't delay at all for those kinds of <br />packets, but that might be due to a inflexible delayed ack setup rather <br />than any real technical reason.<br /><br />I do think that the delay is appropriate, but it might be better to make <br />it even lower (0.02 sec instead of 0.1 seconds). That would still catch <br />immediate back-to-back packets while not showing up in any interactive <br />use.<br /><br />So you could try changing the timeouts in tcp_input.c (function <br />tcp_queue). It looks something like this:<br /><br />                        /*<br />                         * If psh is set we assume it's an<br />                         * interactive session that wants quick<br />                         * acks to avoid nagling too much.<br />                         */<br />                        int delay = HZ/2;<br />                        if (th-&gt;psh)<br />				delay = HZ/10;<br />			tcp_send_delayed_ack(sk, delay);<br /><br />Just change the "delay = HZ/10" to "delay = HZ/50". It might make a <br />psychological difference..<br /><br />Alternatively, instead of checking "psh", you might check the length of <br />the packet and do the "interactive" thing if the length is different <br />from the mtu. That's probably a better test ("psh" is really rather <br />broken).<br /><br />		Linus<br /><br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
