    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/1996/4/6/27">First message in thread</a></li><li><a href="/lkml/1996/4/6/27">Markus Kossmann</a><ul><li class="origin"><a href="">Linus Torvalds</a></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Sun, 7 Apr 1996 07:45:18 +0300 (EET DST)</td></tr><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: memory &amp; filesystem corruption under heavy load?</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody"><br />VERY interesting.<br /><br />On Sat, 6 Apr 1996, Markus Kossmann wrote:<br />&gt; <br />&gt; I have problems with system crashes under heavy load, too.<br />&gt; My System :<br />&gt; P100<br />&gt; Asus TP4 Board 16 MB FPM-DRAM 512k 15ns Cache (Triton chipset)<br />&gt; NCR 53C810 SCSI with Quantum LPS 1080S (sda ) , XP32150 (sdb) and<br />&gt; Toshiba XM3401TA cdrom<br />&gt; IDE :Connor  CP30254 (hda) Seagate  ST3660A (hdb)<br />&gt; VGA : ATI Mach 64 4MB VRAM<br />&gt; Linux / = sdb6 /usr = sdb7 /usr/src = sdb8<br />&gt; <br />&gt; I first got these problems with 1.3.3? ( I don't remember, at that time<br />&gt; I didn't have internet access). I tracked the problems back to 1.3.18<br />&gt; when 4MB-page-tables were introduced. With the following patch in<br />&gt; include/asm-i386/pgtable.h  I disabled them :<br /><br />You should be able to disable the 4MB pages  with the kernel boot command <br />of "mem=nopentium" too (just add it as an append to your lilo config <br />file). Do your problems go away with that too, even on an unpatched <br />kernel?<br /><br />&gt; With an patched 1.3.84 I have run a make -j of 1.3.84 without any crash<br />&gt; ( Using 70 MB virtual memory ( 16 phys + 54 swap ) and running time &gt; 3h<br />&gt; ;-))<br /><br />Umm.. I started looking at the code, and I did find one problem in the <br />4MB page setup, but that should not matter on any normal machine (it only <br />matters if your machine doesn't ahve an even multiple of 4MB or RAM in <br />it).<br /><br />There is a test that looks something like this in arch/i386/mm/init.c:<br /><br />	if (address &lt;= end_mem + 4*1024*1024 &amp;&amp;<br />	    (x86_capability &amp; 8))<br /><br />Just change the "+" into a "-", and that particular bug should be fixed.<br /><br />Does that one-character fix correct this problem for you? (You _might_ <br />have 384kB re-mapped memory above your 16MB). I don't see why the extra <br />TLB mapping should make any difference at all even when the bug is there, <br />but just in case..<br /><br />Anyway, thanks for the interesting report. I'll track this down, somehow <br />(maybe my intel contacts can tell me if there are known problems with the <br />4MB code on some chips)<br /><br />			Linus<br /><br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
