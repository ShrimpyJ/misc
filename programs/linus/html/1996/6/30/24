    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/1996/6/30/18">First message in thread</a></li><li><a href="/lkml/1996/6/30/18">(Eric Youngdale)</a><ul><li class="origin"><a href="/lkml/1996/7/1/36">Linus Torvalds</a><ul><li><a href="/lkml/1996/7/1/36">"Carsten Paeth"</a></li><li><a href="/lkml/1996/7/1/40">"Eric Youngdale"</a><ul><li><a href="/lkml/1996/7/1/67">"Eric Youngdale"</a></li><li><a href="/lkml/1996/7/3/19">(H. Peter Anvin)</a></li></ul></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Mon, 1 Jul 1996 06:50:29 +0300 (EET DST)</td></tr><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: SCSI device numbering (was: Re: Ideas for v2.1</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody"><br /><br />On Sun, 30 Jun 1996, Eric Youngdale wrote:<br />&gt; <br />&gt; &gt;Anyway, I think we should be ok with a 12+20 bit dev_t, that sounds like <br />&gt; &gt;the best solution right now.<br />&gt; <br />&gt; 	OK, but the point was that 20 bits for a minor number is insufficient<br />&gt; for a fixed mapping of devices to minor numbers.  It would be sufficient<br />&gt; if we wanted to continue to use dynamic mapping of minors to devices, of<br />&gt; course.<br /><br />Actually, I've long been of the opinion that we should use more major<br />numbers. It doesn't make much sense to use the same major number for<br />different controllers, and I think we could use dynamic mapping of _major_<br />numbers within controllers. Each controller (*) that is found gets a major<br />number of its own, with some very simple algorithm (reserve najor numbers<br />256-384 for SCSI devices, increment for each controller, something like<br />that). <br /><br />(*) Some people start to worry about hot-swapping controllers, but that's a<br />red herring. You have to load the driver anyway some way, so it's ok to just<br />give a new controller a new major number at that time.  That way all old<br />devices will have the same number within one Linux boot cycle, and if you<br />reboot after having added a new controller I don't really see the problem<br />with using some kernel command line options to tell the kernel that the root<br />device may have changed - we _cannot_ guarantee the same device number if you<br />add controllers anyway. <br /><br />So use the major number as a controller index (that's really what the major<br />number is supposed to be, anyway), and the minor number as the disk index.<br />There must be some way to pack SCSI disk info into 20 bits (8+8+4?). <br /><br />Note that this has one more added advantage: it's easy to keep the old SCSI<br />major number with the dynamic minors alive. The low-level controllers won't<br />need to know, because this translation could be transparently handled by some<br />higher-level translation code: the old major numbers get translated to the<br />32-bit device numbers and this can all be transparent to the user (so that<br />old setups continue to work despite the changes to disk numbering). <br /><br />Note that having one major number per controller has lots of other<br />advantages: it means that controllers don't have to know about each other,<br />because they have complete control over their own major (unlike now, where<br />all controllers have the same major, and one of the things the SCSI layer has<br />to do is to separate out all the disk requests to different controllers and<br />drivers). <br /><br />I don't see any problems with this approach, anybody else?<br /><br />		Linus<br /><br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
