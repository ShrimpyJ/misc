    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/1996/11/14/43">First message in thread</a></li><li><a href="/lkml/1996/11/14/78">(Aaron M. Ucko)</a><ul><li><a href="/lkml/1996/11/14/82">Elliot Lee</a><ul><li><a href="/lkml/1996/11/15/8">=?ISO-8859-1?Q?Johan_Myr=E9en?=</a></li><li><a href="/lkml/1996/11/15/47">"Theodore Y. Ts'o"</a></li><li class="origin"><a href="/lkml/1996/11/15/56">Linus Torvalds</a><ul><li><a href="/lkml/1996/11/15/56">Colten Edwards</a><ul><li><a href="/lkml/1996/11/16/7">Dakota</a></li><li><a href="/lkml/1996/11/16/18">Scott Likens</a></li></ul></li></ul></li></ul></li><li><a href="/lkml/1996/11/15/46">(Alan Cox)</a><ul><li><a href="/lkml/1996/11/15/54">Christian Hardmeier</a><ul><li><a href="/lkml/1996/11/17/23">(Kai Henningsen)</a></li><li><a href="/lkml/1996/11/16/32">(Alan Cox)</a><ul><li><a href="/lkml/1996/11/17/68">Greg Alexander</a></li></ul></li></ul></li><li><a href="/lkml/1996/11/16/16">Greg Alexander</a><ul><li><a href="/lkml/1996/11/16/31">(Alan Cox)</a></li></ul></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Fri, 15 Nov 1996 09:14:31 +0200 (EET)</td></tr><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: Glitch in sys_chroot()</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody"><br /><br /><br />On Thu, 14 Nov 1996, Elliot Lee wrote:<br />&gt; <br />&gt; I still think that Linux should do the chdir() before the chroot(). If you<br />&gt; can provide a reason why - besides "because that's the way it has been<br />&gt; done" - I'd say you have a valid point. Until then I remain unconvinced,<br />&gt; because of the possible security concerns from lax programming.<br />&gt; <br />&gt; In other words, are there any solid reasons other than vague tradition why<br />&gt; it shouldn't be done?<br /><br />There are two reasons why it shouldn't be done:<br /> - vague tradition<br /> - don't change things that aren't broken<br /><br />There simply is no good reason to change it. Ergo, it doesn't get changed. <br /><br />Now, I know that people think that it would be safer if chroot() changed<br />the pwd too, but I have a few arguments against that, namely:<br /><br /> - any program that is security conscious should NOT depend on behaviour<br />   that is not portable or guaranteed. As such, if there is a program that<br />   would be fixed by having chroot(2) do a chdir too, that program is<br />   BROKEN, regardless of what the kernel does. Because the program would<br />   be broken on (a) older Linux versions and (b) any other systems.<br /><br /> - even if chroot() _did_ do a chdir, it wouldn't automatically be 100%<br />   secure. People who depend on chroot would _still_ have to know what<br />   they are doing, and as such the "extra protection" offered by doing a<br />   chdir() is pretty much worthless. <br /><br />For example, if you do a script that does<br /><br />	chroot /ftp xxxxx<br /><br />you should NOT automatically assume that the "xxxx" cannot get out of the<br />chrooted environment if a malicious person has access to "xxxx". Even if<br />you do a "chdir()", the malicious user could then do<br /><br />	do_script &lt; /<br /><br />and the "xxxx" program can do a "fchdir(0)". <br /><br />Quote of the day: "Security is not trivial, and trying to fix security<br />problems with trivial fixes does not work". <br /><br />Note: The chroot (8) program should probably get fixed, because it seems<br />other systems chroot-programs _do_ change the cwd, so in the case of<br />chroot (8) the "vague tradition" is reason enough to change it.<br /><br />Note 2: I'm not dead set against doing a chdir() too in the kernel, but in<br />order to add it I'd really need a better reason than the ones I've seen so<br />far. "Vague tradition" is actually a pretty strong reason in itself, as<br />one of the design philosophies of Linux has been to be compatible: not<br />only with some paper standard (POSIX), but with "real life". So it<br />actually weighs more than you'd think..<br /><br />		Linus<br /><br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
