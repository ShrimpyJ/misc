    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/1996/3/22/104">First message in thread</a></li><li><a href="/lkml/1996/3/22/104">(Bernd Eckenfels)</a><ul><li class="origin"><a href="">Linus Torvalds</a></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Sat, 23 Mar 1996 14:39:09 +0200 (EET)</td></tr><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: meminfo</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody"><br /><br />On 23 Mar 1996, Bernd Eckenfels wrote:<br />&gt; 		if (mem_map[i].uptodate) uptodate++;<br />&gt; 		if (mem_map[i].reserved) reserved++;<br />&gt; 		if (mem_map[i].error) error++;<br />&gt; 		if (mem_map[i].referenced) referenced++;<br />&gt; 		if (mem_map[i].locked) locked++;<br />&gt; 		if (mem_map[i].free_after) free_after++;<br />&gt; 		if (mem_map[i].unused) unused++;<br /><br />Note that this will _not_ give exact answers, even though the code looks <br />"obviously correct". The reason for that is that the linux page <br />allocation code is a powers-of-two buddy system, and if somebody <br />allocates a area larger than one page then only the mem_map[] entry that <br />is relevant to the _first_ page in the area is updated.<br /><br />&gt; nr_free_pages=76 fp=86 su=1520 mu=113 sharedram=655<br />&gt; all=2048 uptodate=910 reserved=329 error=0 referenced=163 locked=0 free_after=0 unused=0<br />&gt; <br />&gt; Generally there is a difference of 10 pages between nr_free_pages and fp.<br /><br />"nr_free_pages" is correct, "fp" is not. "fp" gives a larger value <br />because the accounting code above thinks that some pages are free (count <br />== 0), even though they aren't (they are part of a multi-page <br />allocation). <br /><br />&gt; The only time this difference changed was while i did some floppy access.<br /><br />The floppy driver (among some other things) allocates large multi-page <br />buffers, sot hat's why you probably saw the difference go up even more.<br /><br />		Linus<br /><br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
