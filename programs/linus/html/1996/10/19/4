    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/1996/10/18/50">First message in thread</a></li><li><a href="/lkml/1996/10/18/52">Bruno Kraychete da Costa</a><ul><li><a href="/lkml/1996/10/18/59">Shinanyaku</a><ul><li class="origin"><a href="/lkml/1996/10/19/6">Linus Torvalds</a><ul><li><a href="/lkml/1996/10/19/6">(Philippe Strauss)</a><ul><li><a href="/lkml/1996/10/20/26">(Alan Cox)</a></li></ul></li><li><a href="/lkml/1996/10/19/24">Bruno Kraychete da Costa</a></li><li><a href="/lkml/1996/10/19/25">Pete Clements</a></li><li><a href="/lkml/1996/10/20/16">Marin Purgar - PMC</a></li></ul></li></ul></li></ul></li></ul><div class="threadlist">Patch in this message</div><ul class="threadlist"><li><a href="/lkml/diff/1996/10/19/4/1">Get diff 1</a></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Sat, 19 Oct 1996 10:28:10 +0300 (EET DST)</td></tr><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: Ping with a 65510 bytes pack</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody"><br /><br />On Fri, 18 Oct 1996, Shinanyaku wrote:<br />&gt; <br />&gt; Bruno Kraychete da Costa was heard saying ....<br />&gt; &gt; <br />&gt; &gt; 	When a friend of mine, using a Win95 workstation, issued the ping <br />&gt; &gt; command using a pack of 65510 bytes and addressed to my Linux 2.0.22, it <br />&gt; &gt; simply rebooted. On the second time he issued that command, all the <br />&gt; &gt; process stopped because of a general protection 000, including the agetty <br />&gt; &gt; processes.<br />&gt; <br />&gt; Everybody try this and lock up your linux system? I did. It works as<br />&gt; reported except it didn't reboot my box, just lock it up solid-like.<br /><br />Ok, this is _definitely_ the kind of bug that I want to have fixed asap. <br />Alan already sent out a test-patch, but he hadn't been able to test it. <br />Neither can I, because I don't have access to any Windows machines, and Linux<br />won't even try to send out those illegal packets (and I'm way too lazy to try<br />to write a program that tries to send out raw ethernet packets)<br /><br />So could people please test the patch by Alan (I'm including it at the end of<br />this email in ase you missed it for some reason)? Please test first a<br />unpatched kernel to make sure you see the problem properly so that I don't<br />get positive reports that turn out to be flukes due to a router eating up the<br />packets or something.. <br /><br />The patch applies to just about any 2.x kernel (it certainly applied to both<br />2.1.5 and 2.0.23), and the reason I'm asking people to test it out is that<br />this kind of embarrassing bug (Q: "What's the height of embarrassment?"<br />A: "Windows crashing Linux"), and even this small patch is enough to release <br />a new kernel version just to have it "officially fixed" before the news of <br />this spread. But I don't want to make a 2.0.24 that turns out to not fix the<br />only problem it was meant to fix ;)<br /><br />(Thanks Alan for the quick action, and sorry to people who get this patch<br />twice in their mailbox)<br /><br />Please reply to me directly, just a "yes, it fixes it" or "nope, my machine<br />still crashes" will do. <br /><br />	Thanks,<br />		Linus<br /><br />-----<br />Date: 	Sat, 19 Oct 96 01:05 BST<br />From: alan&#64;lxorguk.ukuu.org.uk (Alan Cox)<br />To: linux-kernel&#64;vger.rutgers.edu, linux-net&#64;vger.rutgers.edu<br />Subject: Untested but this should fix the problem with oversize packets<br /><br /><br />Let me know how it works (patch v 2.0.2x)<br /><br />--- ip_fragment.c.old	Mon Sep 16 22:14:52 1996<br />+++ ip_fragment.c	Sat Oct 19 01:04:47 1996<br />&#64;&#64; -366,7 +366,7 &#64;&#64;<br /> 		{<br /> 			NETDEBUG(printk("Invalid fragment list: Fragment over size.\n"));<br /> 			ip_free(qp);<br />-			frag_kfree_skb(skb,FREE_WRITE);<br />+			kfree_skb(skb,FREE_WRITE);<br /> 			ip_statistics.IpReasmFails++;<br /> 			return NULL;<br /> 		}<br />&#64;&#64; -466,6 +466,18 &#64;&#64;<br /> 			return NULL;<br /> 		}<br /> 	}<br />+	<br />+	/*<br />+	 *	Attempt to construct an oversize packet.<br />+	 */<br />+	 <br />+	if(ntohs(iph-&gt;tot_len)+(int)offset&gt;65535)<br />+	{<br />+		skb-&gt;sk = NULL;<br />+		frag_kfree_skb(skb, FREE_READ);<br />+		ip_statistics.IpReasmFails++;<br />+		return NULL;<br />+	}	<br /> <br /> 	/*<br /> 	 *	Determine the position of this fragment.<br /><br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
