    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/1996/10/18/31">First message in thread</a></li><li><a href="/lkml/1996/10/18/31">Mike Wangsmo</a><ul><li class="origin"><a href="/lkml/1996/10/19/17">Linus Torvalds</a><ul><li><a href="/lkml/1996/10/19/17">"Carlo E. Prelz"</a></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Fri, 18 Oct 1996 19:43:14 +0300 (EET DST)</td></tr><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: 2.1.5 compile errors</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody"><br /><br />On Fri, 18 Oct 1996, Mike Wangsmo wrote:<br />&gt; <br />&gt; Here is the error I get when compiling 2.1.5:<br /><br />Yes. The sound drivers haven't been upgraded to the new user access <br />handling, and they won't compile. However, it shouldn't be too hard to do <br />the patches, there are essentially just a few simple rules on how to <br />change the old-style calls to new-style calls:<br /><br />	memcpy_fromfs -&gt; copy_from_user<br />	memcpy_tofs -&gt; copy_to_user<br />	x = get_user(y) -&gt; get_user(x, y)<br />	x = get_fs_byte(y) -&gt; get_user(x, (unsigned char *) y)<br />	x = get_fs_word(y) -&gt; get_user(x, (unsigned short *) y)<br />	x = get_fs_long(y) -&gt; get_user(x, (unsigned int *) y)<br />	put_fs_byte(x,y) -&gt; put_user(x, (unsigned char *) y)<br />	put_fs_word(x,y) -&gt; put_user(x, (unsigned short *) y)<br />	put_fs_long(x,y) -&gt; put_user(x, (unsigned int *) y)<br /><br />There are only a few subtle things to look out for:<br /><br /> - note the "get_fs_long/put_fs_long" translations. They should _not_ use<br />   pointers to "long", but pointers to "int". This doesn't make any<br />   difference on x86, but there is a clear difference on alpha <br />   ("get_fs_quad/put_fs_quad" are used for long pointer accesses, and <br />   quite frankly, nothing uses that).<br /><br /> - The change from "x = get_user()" -&gt; "get_user(x,y)" can lead to problems.<br />   Notably, the old syntax is often used inside expressions, and sometimes<br />   there is no variable to be set directly. So sometimes you may have to <br />   change code like this:<br /><br />	do_function_call(get_user(user_ptr));<br /><br />   into something like this:<br /><br />	int variable;<br />	get_user(variable, user_ptr);<br />	do_function_call(variable);<br /><br />The reason for the change to "get_user()" is that we also return an error<br />code these days (but for a first-order translation of the old code to the new<br />you can ignore the error code returned for now). <br /><br />&gt; The ppp compile problems of 2.1.4 were fixed, at least as far as <br />&gt; compilation goes, it appears.<br /><br />I'm told it should even work  ;)<br /><br />The reason I haven't changed the sound code is that while the process <br />isn't very complicated, it _is_ kind of tedious, and it also needs to be <br />tested for silly errors afterwards. I'm still hoping people will send me <br />patches..<br /><br />		Linus<br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
