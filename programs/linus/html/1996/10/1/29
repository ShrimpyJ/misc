    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/1996/9/30/42">First message in thread</a></li><li><a href="/lkml/1996/9/30/42">Linus Torvalds</a><ul><li><a href="/lkml/1996/9/30/83">Linus Torvalds</a><ul><li><a href="/lkml/1996/10/1/63">george h byrkit</a></li><li><a href="/lkml/1996/9/30/121">Rodrigo Feher</a><ul><li><a href="/lkml/1996/10/1/71">"Adam D. Bradley"</a></li></ul></li></ul></li><li><a href="/lkml/1996/9/30/95">Steven L Baur</a><ul><li class="origin"><a href="">Linus Torvalds</a></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Tue, 1 Oct 1996 08:37:15 +0300 (EET DST)</td></tr><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: ALERT! Stay away from patched gcc's (was Re: 2.0.22 will be the last version)</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody"><br /><br />On 30 Sep 1996, Steven L Baur wrote:<br />&gt; <br />&gt; Are you saying that if the output doesn't look like that, the GCC is O.K.?<br />&gt; Or just that the `decl (%eax)' is where the badness lies?<br /><br />It's the decl (%eax) which is _always_ wrong for that piece of code. If you<br />don't have it, I can't guarantee that your gcc is 100% ok, but at least you<br />don't have that particular bug. <br /><br />&gt; This is what my GCC 2.7.2 with a no-sr-bug patch produces (from 2.0.21<br />&gt; for i486):<br />&gt; <br />&gt;         call scsi_do_cmd<br />&gt;         addl $28,%esp<br />&gt;         movl %ebx,%ecx<br />&gt; #APP<br />&gt;         # atomic down operation<br />&gt; 1:<br />&gt;         movl $1b,%eax<br />&gt;         decl (%ebx)<br />&gt;         js down_failed<br />&gt; #NO_APP<br />&gt;         movl 240(%ebp),%edi<br />&gt;         movl %edi,20(%esp)<br />&gt;         decl %esi<br />&gt;         testl %edi,%edi<br />&gt;         je .L1721<br />&gt;         testl %esi,%esi<br />&gt;         jne .L1720<br /><br />Yes, this is what it should look like (the format is different from the one I<br />posted, but that's because the posted example was created with gdb and<br />disassemble rather than pasted from the .s file). Note that other gcc<br />versions can have different register allocation, so the above is certainly<br />not the only correct way to compile it, but the above is what you should see<br />with a good gcc-2.7.2. <br /><br />		Linus<br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
