    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/1996/9/19/57">First message in thread</a></li><li><a href="/lkml/1996/9/20/43">Linus Torvalds</a><ul><li><a href="/lkml/1996/9/20/79">Steven L Baur</a><ul><li><a href="/lkml/1996/9/21/13">Alan Cox</a><ul><li><a href="/lkml/1996/9/21/25">Steven L Baur</a></li></ul></li><li class="origin"><a href="/lkml/1996/9/25/18">Linus Torvalds</a><ul><li><a href="/lkml/1996/9/25/18">Pete Clements</a></li><li><a href="/lkml/1996/9/25/46">Gerd Knorr</a></li><li><a href="/lkml/1996/9/25/49">(Joerg Pommnitz)</a><ul><li><a href="/lkml/1996/9/25/50">Linus Torvalds</a></li></ul></li><li><a href="/lkml/1996/9/23/54">Pete Clements</a><ul><li><a href="/lkml/1996/9/24/29">Robert Cope</a></li></ul></li><li><a href="/lkml/1996/9/24/3">Keith Owens</a></li><li><a href="/lkml/1996/9/24/4">Richard Gooch</a><ul><li><a href="/lkml/1996/9/24/10">Linus Torvalds</a></li></ul></li><li><a href="/lkml/1996/9/24/18">Matthias Sattler</a></li><li><a href="/lkml/1996/9/24/23">Erik B Andersen</a><ul><li><a href="/lkml/1996/9/24/16">Hans Lermen</a></li></ul></li><li><a href="/lkml/1996/9/24/54">Gerard Roudier</a><ul><li><a href="/lkml/1996/9/25/27">Linus Torvalds</a></li></ul></li></ul></li></ul></li><li><a href="/lkml/1996/9/22/25">(Thomas Koenig)</a><ul><li><a href="/lkml/1996/9/22/33">Linus Torvalds</a><ul><li><a href="/lkml/1996/9/22/36">"Peter T. Breuer"</a></li><li><a href="/lkml/1996/9/23/41">JF Martinez</a><ul><li><a href="/lkml/1996/9/24/40">Alan Cox</a></li></ul></li></ul></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Mon, 23 Sep 1996 17:14:48 +0300 (EET DST)</td></tr><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">test version of 2.1.0 available</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody"><br />Could people who are doing device drivers and other people that just want <br />to live dangerously check out the new pre-2.1.0.gz file that I just put <br />out for ftp on<br /><br />  <a href="ftp://ftp.cs.helsinki.fi/pub/Software/Linux/Kernel/testing/pre-patch-2.1.0.gz">ftp://ftp.cs.helsinki.fi/pub/Software/Linux/Kernel/testing/pre-patch-2.1.0.gz</a><br /><br />(It's _currently_ has a md5sum of 92eb12e2275dd75fb14f6538d1a4e03d and is<br />28265 bytes long, but I might be updating it). <br /><br />The new thing with the 2.1.x tree is that the kernel no longer uses the x86<br />segmentation to access user mode, but instead the kernel segment covers the<br />whole 4GB virtual address space, and thus accesses to user memory can be made<br />faster. <br /><br />NOTE! When you access user memory you still have to use the "get_user()"  etc<br />helper functions, exactly as before, because those can still do strange<br />things on other architectures. The new thing is just a x86 _implementation_<br />issue, not a change in the basic philosophy (you'll notice that most of the<br />changes are to x86-specific files). <br /><br />The thing about the new memory management setup is that it gets rid of a lot<br />of extra fluff that isn't needed, and makes things potentially faster. <br />However, there is one downside to all this, and that is the fact that the<br />kernel address space is no longer identical to the hardware address space. <br /><br />For example, to access hardware address 0xA0000, you can no longer just do<br />something like this: <br /><br />	value = (unsigned char *) 0xA0000;<br /><br />but instead you have to use something like this:<br /><br />	value = readb(0xA0000);<br /><br />Note that I called this a "downside", but in actual fact it's a good thing.<br />The reason that it's a good thing is that the drivers should have been using<br />readb() already - that's the portable interface, and that's how you have to<br />access PCI shared memory on alpha and PPC machines. In fact, most drivers<br />have already been converted to use this interface, but there are certainly<br />drivers out there that will break horribly by my pre-patch. That's why I'd<br />like driver authors (and technical people who want to test) to try out the<br />pre-patch. <br /><br />Drivers that should work already (because they work on alpha's - the ones<br />marked with (*) have actually been tested by me on my PC with the pre-patch): <br /><br /> - VGA console (*)<br /> - IDE harddisk and CD-ROM (*)<br /> - normal serial lines (*)<br /> - keyboard (*)<br /> - 3c509 network card (*)<br /> - floppy driver (*)<br /> - PS/2 mouse<br /> - de4x5 and ne2000 network cards<br /> - original ncr scsi drivers <br /> - BSD ncr SCSI driver (at least with IO-mapped accesses)<br /> - Aha1740, BusLogic and QLogic ISP SCSI drivers<br /><br />Other drivers are in the "may well work" category, but I cannot give any<br />guarantees. If some driver doesn't work, you're likely to find out sooner<br />rather than later (they generally break totally - it's not going to be<br />subtle). <br /><br />I'd love to get reports on these patches, and would be even happier if you<br />can also send a patch that actually fixes any broken behaviour. Things <br />that can break are:<br /> - accessing device memory though a pointer<br />   FIX: use readb/writeb/memcpy_fromio/memcpy_toio instead of trying to <br />        dereference the pointer directly.<br /> - using virtual addresses for controller-initiated DMA<br />   FIX: use the "virt_to_bus()" function to change a virtual address into <br />        a "bus" address to give to controllers that do DMA into memory.<br /> - memory re-mapping may be broken right now, so anything that needs<br />   "vremap()" probably doesn't work. If you have a driver that breaks due <br />   to this, please test changing the line (line 187 in mm/vmalloc.c)<br /><br />		set_pte(pte, mk_pte(offset, PAGE_KERNEL));<br /><br />   to do a<br /><br />		set_pte(pte, mk_pte(offset+PAGE_OFFSET, PAGE_KERNEL));<br /><br />   and see if that helps?<br /><br />Comments? Success stories? Hate mail? Money?<br /><br />		Linus<br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
