    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/1996/9/18/14">First message in thread</a></li><li><a href="/lkml/1996/9/18/14">"Ulrich Windl"</a><ul><li class="origin"><a href="/lkml/1996/9/19/19">Linus Torvalds</a><ul><li><a href="/lkml/1996/9/19/19">Alan Cox</a></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Thu, 19 Sep 1996 09:17:41 +0300 (EET DST)</td></tr><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: int 16 &amp; math error</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody"><br /><br />On Wed, 18 Sep 1996, Ulrich Windl wrote:<br />&gt; <br />&gt; Yesterday I've noticed that in /proc/interrupts int 13 is assigned to <br />&gt; math error while during boot the messages states my Pentium is using <br />&gt; exception 16. I'm not a processor guru. Is interrupt 13 used? Is <br />&gt; interrupt 16 used? Is the information in /proc/interrupts correct?<br /><br />Welcome to the world of confusion.<br /><br />The original AT/386 had the math chip error line connected to device<br />interrupt #13. That's not what intel specified if should do, at least not for<br />the i387, but hey, we all know IBM engineers know exactly what they are doing<br />and have good reasons for it, don't we? Snicker. IBM engineers had earlier in<br />the life of the PC ignored intel's specifications that exceptions 0-31 are<br />reserved, and I guess that along with backwards compatibility with some<br />strange original-PC 8087 linkage was to blame for this all. <br /><br />Note that "device interrupt #13" is NOT the same as "exception #13". The<br />device interrupts (0-15) can be routed to different exceptions (0-255), and<br />under Linux, for example, interrupt #x is routed to exception #32+x. Under<br />DOS, interrupt #x is routed to exception #8+x (x &lt; 8) and #XX+(x&amp;7) (x &gt;= 8,<br />XX is something strange like 0x78 or something). <br /><br />Now the DOS interrupt layout is really bad, because exception #8+x is also<br />where the CPU assigns things like page fault exceptions etc. Oops. Chalk one<br />up for the BIOS writers, who have a special place in hell waiting for them. <br /><br />Now, the _intel_ exception for math errors is exception #16. However, the<br />original IBM design said that that was bad, and math exceptions should come<br />in on irq#13, so they did some non-standard wiring of the 386/387-coupling<br />instead of just having a straight connection between them. <br /><br />At this point I'd like to point out that the IBM nonstandard wiring of the<br />i387 is _really_ _really_ braindamaged. Not just "a bit wrong", but "so<br />incredibly stupid that it's scary". There are horrible implications of using<br />(asychronous and blockable) external interrupts for math errors when you do<br />things like lazy i387 state saving etc. The intel direct exception #16<br />handling is a lot better, but IBM totally disabled that with their<br />motherboard setup. <br /><br />Anyway, when intel made the integrated FPU's, they were able to fix the IBM<br />braindamage, but on the other hand they wanted to be compatible with it, so<br />they left the irq13 stuff in as a "special feature". There is a special<br />external pin to tell the rest of the world about math errors, just so that<br />those can be looped back through the interrupt controller. Whee! <br /><br />End result: Linux always uses exception 16 if it works on that hardware.  But<br />all x86 PC motherboards have irq13 (which maps to exception 45 in Linux) tied<br />to the same signal, and on non-integrated FPU's that's what Linux has to use.<br />So you can't use irq13 for anything else. <br /><br />		Linus<br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
