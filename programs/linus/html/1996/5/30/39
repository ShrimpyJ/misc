    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/1996/5/30/27">First message in thread</a></li><li><a href="/lkml/1996/5/30/27">Johnny Stenback</a><ul><li class="origin"><a href="/lkml/1996/5/30/91">Linus Torvalds</a><ul><li><a href="/lkml/1996/5/30/91">David C Niemi</a></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><script type="text/javascript" src="//pagead2.googlesyndication.com/pagead/show_ads.js"></script><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Thu, 30 May 1996 15:27:40 +0300 (EET DST)</td></tr><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: dd if=/dev/fd0... &amp; sync</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody"><br /><br />On Thu, 30 May 1996, Johnny Stenback wrote:<br />&gt; <br />&gt; I noticed a strange thing in my linux 1.99.8 PC (Pentium) yesterday, I<br />&gt; made a backup copy of some floppyes with 'dd if=/dev/fd0 of=...'  and<br />&gt; while dd was reading my floppy I wanted to check if there was enough<br />&gt; space left for a couple of floppyes on the partition wher I wrote<br />&gt; them, the when I wrote 'df' the df process hung and did nothing (^C or<br />&gt; ^Z didn't work) until the dd process was done.<br /><br />This is a known problem with "df" - it does a "sync()" for no real <br />reason. Now, the fact that it affects you even when reading from a floppy <br />is surprising, but the real problem is the "sync()" (umm, thinking about <br />it the sync probably waits for _all_ blocked buffers, whether they are <br />blocked for reading or for writing).<br /><br />Now, we haven't really bothered to make "sync()" very clever, because <br />it's not meant to be clever, it's just meant to sync the disks (read that <br />as "if you use sync(), it's your problem").<br /><br />Now, the reason "df" does a sync() call is that way back in the year 5 BC <br />or so, that was what you were supposed to do to flush out the filesystem <br />buffers to disk, so that the df program then could go and read the disk <br />information directly (!) from the superblocks. <br /><br />Now, that obviously doesn't work with any reasonably new unix (like <br />anything that has been updated in the last 15 years or so), because we <br />have different filesystems and some of them are actually over the network <br />etc. So these days df just does a "statfs()" call to get the information <br />from the kernel.<br /><br />For some strange reason the df people left the sync in there, probably on the<br />assumption that if you want to know how much disk you have free, you probably<br />also want to wait a few minutes until all of your multi-megabyte buffer <br />cache has been written out to disk.<br /><br />[ Yes, I'm being ironic ].<br /><br />In short, the real answer is to recompile "df" with the sync call <br />commented out. You might want to send a "misfeature-report" to whoever <br />maintains fileutils (or whwrever df is found, I'm too lazy to check).<br /><br />The linux "sync()" behaviour might be considered strange, but at least it <br />isn't stupid and unreasonable (it actually waits for all IO to complete, <br />and it actually does this _synchronously_, because there really isn't any <br />other reason to call sync() than that these days).<br /><br />		Linus<br /><br /><br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
