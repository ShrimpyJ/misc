    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/1996/7/14/5">First message in thread</a></li><li><a href="/lkml/1996/7/14/5">(Christoph Lameter)</a><ul><li class="origin"><a href="/lkml/1996/7/15/8">Linus Torvalds</a><ul><li><a href="/lkml/1996/7/15/8">Christoph Lameter</a></li><li><a href="/lkml/1996/7/15/22">Matthias Urlichs</a><ul><li><a href="/lkml/1996/7/15/47">Todd Graham Lewis</a><ul><li><a href="/lkml/1996/7/16/35">Matthias Urlichs</a></li></ul></li></ul></li><li><a href="/lkml/1996/7/15/48"> tytso&#64;mit ...</a><ul><li><a href="/lkml/1996/7/16/44">Linus Torvalds</a><ul><li><a href="/lkml/1996/7/17/35">"Carsten Paeth"</a></li></ul></li></ul></li></ul></li><li><a href="/lkml/1996/7/16/26">(Alan Cox)</a><ul><li><a href="/lkml/1996/7/16/29">Christoph Lameter</a></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Sun, 14 Jul 1996 13:37:22 +0300 (EET DST)</td></tr><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: 2.0.6 Networking strangeness</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody"><br /><br />On 13 Jul 1996, Christoph Lameter wrote:<br />&gt; <br />&gt; TCP Latencies are out of control again.<br />&gt; Happened while upgrading hur from 2.0.5 to 2.0.6.<br /><br />Thanks for the report - this pinpoints the change pretty well, as there <br />is just one (small) change between 5 and 6 in tcp_output.c..<br /><br />&gt; ping waterf -&gt; hur 140-160msec <br />&gt; ping waterf -&gt; miriam 1.0-1.6msec<br />&gt; ping hur -&gt; miriam 0.6-1.1msec<br />&gt; <br />&gt; Setup:<br />&gt; <br />&gt; Linux 2.0.6 (waterf)<br />&gt; 	|<br />&gt;    PPP Link<br />&gt; 	|<br />&gt; Linux 2.0.6 (hur)<br />&gt; 	|<br />&gt;    Ethernet<br />&gt; 	|<br />&gt; Linux 2.0.6 (miriam)<br />&gt; <br />&gt; Sometimes I have doubts that Alan knows what he is doing.<br /><br />Don't blame alan, blame me. It's the small patch I made to <br />"tcp_send_delayed_ack()" in the mistaken belief that it couldn't possible <br />break anything at all, and that it cleaned up and simplified some code (I <br />was right on the second count, but seemingly not on the first one).<br /><br />HOWEVER, now that I look a bit more closely at your report, it starts making<br />less and less sense.  Notably, "ping" doesn't use TCP at all, so the only<br />change that is in the 5-&gt;6 upgrade simply _cannot_ affect ping latency. And<br />the _longer_ trip to miriam from waterf (that still uses PPP) doesn't seem<br />affected. <br /><br />The only thing the 2.0.5-&gt;6 upgrade does is that it makes a lot more TCP <br />ack's happen from timers rather than from the TCP reception code. As <br />such, it changes some timings wrt the network packets, AND this might <br />break if the PPP driver has a race condition that shows up for that case. <br /><br />Anyway, try just reverting on the tcp_output.c patch in 2.0.6 (it's a rather<br />small one), and if that fixes the problem then I guess we'll just have to go<br />back. However, this behaviour makes me suspect more and more that there is<br />something broken in the PPP (or serial code) timings, and that the TCP change<br />just happens to make that show up more (so the TCP change itself isn't the<br />bug, it just triggers the _real_ bug - not something we want to necessarily<br />look into in the 2.0.x series, though). <br /><br />		Linus<br /><br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
