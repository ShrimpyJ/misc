    </div></td><td width="32"> </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2010/9/27/241">First message in thread</a></li><li><a href="/lkml/2010/9/28/362">Linus Torvalds</a><ul><li><a href="/lkml/2010/9/28/367">Andrew Morton</a><ul><li><a href="/lkml/2010/9/28/368">David Miller</a></li><li class="origin"><a href="/lkml/2010/9/28/372">Linus Torvalds</a><ul><li><a href="/lkml/2010/9/28/372">David Miller</a><ul><li><a href="/lkml/2010/9/28/375">Linus Torvalds</a></li></ul></li><li><a href="/lkml/2010/9/29/82">Boaz Harrosh</a><ul><li><a href="/lkml/2010/9/29/219">Linus Torvalds</a></li></ul></li><li><a href="/lkml/2010/9/29/85">Boaz Harrosh</a><ul><li><a href="/lkml/2010/9/29/221">Linus Torvalds</a></li></ul></li></ul></li></ul></li><li><a href="/lkml/2010/9/28/376">Al Viro</a><ul><li><a href="/lkml/2010/9/28/383">Al Viro</a><ul><li><a href="/lkml/2010/9/28/389">David Miller</a><ul><li><a href="/lkml/2010/9/28/395">Al Viro</a></li></ul></li></ul></li></ul></li><li><a href="/lkml/2011/1/26/287">Emil Langrock</a></li></ul></li></ul><div class="threadlist">Patch in this message</div><ul class="threadlist"><li><a href="/lkml/diff/2010/9/28/371/1">Get diff 1</a></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Tue, 28 Sep 2010 13:57:04 -0700</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: {painfully BISECTED} Please revert f25c80a4b2: arch/um/drivers: remove duplicate structure field initialization</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody">On Tue, Sep 28, 2010 at 1:47 PM, Andrew Morton<br />&lt;akpm&#64;linux-foundation.org&gt; wrote:<br />&gt;<br />&gt; And I misread that, assuming that it's just a wrapper around<br />&gt; eth_mac_addr().  Only it isn't, because it passes eth_mac_addr() the<br />&gt; MAC address's address directly (with -&gt;sa_data).  But eth_mac_addr()<br />&gt; expects a `struct sockaddr *'.<br />&gt;<br />&gt; And for some wtf reason, eth_mac_addr() passes that `struct<br />&gt; sockaddr *' in a `void *', thus cunningly hiding the bug.<br />&gt;<br />&gt; Yeah, please revert it.<br /><br />Well, the alternative would be to just fix uml_net_set_mac(). The code<br />before the patch was clearly crap too, so reverting may make it work,<br />but gets us back to a stupid situation with two different initializers<br />for one field.<br /><br />So perhaps something like the attached patch would make it work, and<br />have the locking in place that apparently people think it should have?<br /><br />Boaz?<br /><br />                     Linus<br /> arch/um/drivers/net_kern.c |    6 +++---<br /> 1 files changed, 3 insertions(+), 3 deletions(-)<br /><br />diff --git a/arch/um/drivers/net_kern.c b/arch/um/drivers/net_kern.c<br />index 2ab233b..e44fd87 100644<br />--- a/arch/um/drivers/net_kern.c<br />+++ b/arch/um/drivers/net_kern.c<br />&#64;&#64; -257,14 +257,14 &#64;&#64; static void uml_net_tx_timeout(struct net_device *dev)<br /> <br /> static int uml_net_set_mac(struct net_device *dev, void *addr)<br /> {<br />+	int ret;<br /> 	struct uml_net_private *lp = netdev_priv(dev);<br />-	struct sockaddr *hwaddr = addr;<br /> <br /> 	spin_lock_irq(&amp;lp-&gt;lock);<br />-	eth_mac_addr(dev, hwaddr-&gt;sa_data);<br />+	ret = eth_mac_addr(dev, addr);<br /> 	spin_unlock_irq(&amp;lp-&gt;lock);<br /> <br />-	return 0;<br />+	return ret;<br /> }<br /> <br /> static int uml_net_change_mtu(struct net_device *dev, int new_mtu)</pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
