    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2010/9/25/66">First message in thread</a></li><li><a href="/lkml/2010/9/25/66">Jens Axboe</a><ul><li class="origin"><a href="">Linus Torvalds</a></li><li><a href="/lkml/2010/9/25/77">Jens Axboe</a></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Sat, 25 Sep 2010 09:59:28 -0700</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: [GIT PULL] One important block fix for 2.6.36-rc</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody">On Sat, Sep 25, 2010 at 3:45 AM, Jens Axboe &lt;jaxboe&#64;fusionio.com&gt; wrote:<br />&gt;<br />&gt; Please pull asap, thanks.<br /><br />Pulled, but I _really_ wish you started looking at cleanliness issues,<br />even with bug-reports.<br /><br />That's a singularly stupid and unreadable way of testing "do those<br />flags match". It is quite possible that the compiler fixes up the<br />stupidity, but that doesn't make it much better.<br /><br />Here's how things like this _should_ be tested:<br /><br />   #define REQ_FLAGS_MUST_MATCH (REQ_SECURE | REQ_DISCARD)<br /><br />   ...<br />   /* Check that flags match in the required bits */<br />   if ((req-&gt;cmd_flags ^ next-&gt;cmd_flags) &amp; REQ_FLAGS_MUST_MATCH)<br />      return 0;<br />   ...<br /><br />which is (a) smaller (b) easier and clearer to add flags as needed and<br />(c) actually more readable due to not having duplicated logic (not<br />just one if-statement, but one mask too).<br /><br />And yes, I think you'd want to add a few flags there. Looking at the<br />REQ_xyz flags, I suspect most o them should really really match for<br />requests to be mergeable. Wouldn't it be better to think of it in<br />terms of "do we really allow different cmd_flags requests to merge"<br />than adding one bit ad-hoc at a time?<br /><br />                           Linus<br /><br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
