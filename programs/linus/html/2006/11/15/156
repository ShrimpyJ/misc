    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2006/11/14/330">First message in thread</a></li><li><a href="/lkml/2006/11/14/368">Jeff Garzik</a><ul><li><a href="/lkml/2006/11/14/371">David Miller</a><ul><li><a href="/lkml/2006/11/14/373">Jeff Garzik</a><ul><li><a href="/lkml/2006/11/14/375">David Miller</a><ul><li><a href="/lkml/2006/11/15/445">Benjamin Herrenschmidt</a></li></ul></li><li><a href="/lkml/2006/11/15/304">Stephen Hemminger</a><ul><li><a href="/lkml/2006/11/15/321">Jeff Garzik</a></li></ul></li></ul></li><li><a href="/lkml/2006/11/15/444">Benjamin Herrenschmidt</a></li></ul></li><li><a href="/lkml/2006/11/14/376">Roland Dreier</a><ul><li><a href="/lkml/2006/11/14/379">Jeff Garzik</a></li><li class="origin"><a href="/lkml/2006/11/15/260">Linus Torvalds</a><ul><li><a href="/lkml/2006/11/15/260">Jeff Garzik</a></li><li><a href="/lkml/2006/11/15/281">Roland Dreier</a></li></ul></li><li><a href="/lkml/2006/11/15/448">Benjamin Herrenschmidt</a></li></ul></li><li><a href="/lkml/2006/11/15/120">Krzysztof Halasa</a><ul><li><a href="/lkml/2006/11/15/275">Jeff Garzik</a><ul><li><a href="/lkml/2006/11/15/299">Linus Torvalds</a><ul><li><a href="/lkml/2006/11/15/317">Jeff Garzik</a></li></ul></li></ul></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><script type="text/javascript" src="//pagead2.googlesyndication.com/pagead/show_ads.js"></script><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Wed, 15 Nov 2006 07:53:27 -0800 (PST)</td></tr><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: [PATCH] ALSA: hda-intel - Disable MSI support by default</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody"><br /><br />On Tue, 14 Nov 2006, Roland Dreier wrote:<br />&gt; <br />&gt; Huh?  The device can't generate any legacy interrupts once MSI is<br />&gt; enabled.  As the PCI spec says:<br /><br />PLEASE.<br /><br />The spec is just so much toilet paper. The ONLY thing that matters is what <br />real hardware does. So please please please PLEASE don't start quoting <br />specs as a way to "prove your point". It is totally meaningless.<br /><br />The fact is, we _know_ there are broken devices out there. Not just wrt <br />MSI - pretty much every single sentence of the PCI spec is probably broken <br />by _some_ device or subsystem. For example, I would expect that the DMA <br />ordering rule is likely broken by the big SGI boxes, because they do <br />memory coherency traffic separately from the IO traffic.<br /><br />This should be the #1 rule for every kernel programmer: read the <br />documentation, but don't actually assume it's complete, or that it is <br />always true.<br /><br />One of the big reasons user-level programming is so much simpler than <br />kernel programming is that you can basically "think" about your <br />algorithms. You seldom have cases where you literally just need to test <br />out whether all hardware really works that way.<br /><br />The bottom line: MSI looks great on paper. I think we might make it a rule <br />that we can enable it by default on bridges we trust (which would seem to <br />be mainly just Intel). But even then, I think it makes sense for <br />per-driver rules, because<br /><br /> - some drivers may care more than others (sound, for example, certainly <br />   doesn't really care at all), apart from irq routing issues, and right <br />   now those are _worse_ with MSI due to bugs.<br /><br /> - we definitely have the potential for per-driver bugs (eg the "disable <br />   INTx explicitly" kind of situation), so even if MSI works on a system <br />   level, I think we all know that it doesn't always work on a device <br />   level, and the safe thing tends to be to keep it disabled unless you <br />   have some really overriding concern to use it.<br /><br />End result: I think that at least for 2.6.19, and at least for the HDA <br />sound driver, keeping it disabled by default is the right choice. We <br />should probably _also_ make "pci_msi_supported()" just return an error <br />(probably by just clearing "pci_msi_enable") for any non-intel host bridge <br />for now.<br /><br />I don't dispute AT ALL that we should try to enable things more in the <br />future. I'm just saying that we're better off being careful, and realizing <br />that documentation and "official rules" seldom match reality.<br /><br />(People seem to trust documentation, because for _most_ devices, the <br />documentation is correct. But if it's wrong for 1% of all devices, you <br />should still realize that IT IS WRONG. You can't quote "the standard" to <br />prove a point - a single exception is enough to show that a standard is <br />incomplete)<br /><br />			Linus<br />-<br />To unsubscribe from this list: send the line "unsubscribe linux-kernel" in<br />the body of a message to majordomo&#64;vger.kernel.org<br />More majordomo info at  <a href="http://vger.kernel.org/majordomo-info.html">http://vger.kernel.org/majordomo-info.html</a><br />Please read the FAQ at  <a href="http://www.tux.org/lkml/">http://www.tux.org/lkml/</a><br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
