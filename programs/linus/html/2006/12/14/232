    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2006/12/13/201">First message in thread</a></li><li><a href="/lkml/2006/12/14/110">Jan Engelhardt</a><ul><li><a href="/lkml/2006/12/14/112">Jan Engelhardt</a><ul><li class="origin"><a href="/lkml/2006/12/14/249">Linus Torvalds</a><ul><li><a href="/lkml/2006/12/14/249">Jan Engelhardt</a></li></ul></li></ul></li><li><a href="/lkml/2006/12/14/228">Linus Torvalds</a><ul><li><a href="/lkml/2006/12/14/309">Thomas Gleixner</a><ul><li><a href="/lkml/2006/12/14/350">Linus Torvalds</a><ul><li><a href="/lkml/2006/12/14/362">Thomas Gleixner</a></li></ul></li></ul></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Thu, 14 Dec 2006 09:32:22 -0800 (PST)</td></tr><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: [GIT PATCH] more Driver core patches for 2.6.19</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody"><br /><br />On Thu, 14 Dec 2006, Jan Engelhardt wrote:<br />&gt; <br />&gt; Rather than IRQ_HANDLED, it should have been: remove this irq handler <br />&gt; from the irq handlers for irq number N, so that it does not get called <br />&gt; again until userspace has acked it.<br /><br />Wrongo.<br /><br />That just means that the _handler_ won't be called.<br /><br />But the irq still stays active, and if it's shared, ALL THE OTHER HANDLERS <br />FOR THAT INTERRUPT will be called. <br /><br />Over and over again. Forever. Because the machine won't be making any <br />progress, and the user-level code (which might know how to shut it up) <br />won't ever be called, because the machine is busy just doing interrupt <br />delivery all the time.<br /><br />&gt; See, maybe I don't have enough clue yet to exactly figure out why you <br />&gt; say it does not work. However, this is how simple people see it 8)<br /><br />You may be a bit simple. But I think it's more polite to call you <br />"special". Or maybe just not very used to how hardware works.<br /><br />Btw, this is not something theoretical. We used to have this particular <br />problem _all_ the time with PCMCIA back when we weren't as good at <br />interrupt routing. You'd insert a PCMCIA card, and the machine just hung. <br />Hard.<br /><br />And the reason was that it would send an irq, but we were expecting it on <br />another interrupt. But if it showed up on something that was shared, you'd <br />have a hung machine, because you'd just have the (say) ethernet driver <br />saying "not for me", and returning. And obviously not able to actually <br />shut it up, so when we returned from the interrupt handler, the interrupt <br />happened immediately again.<br /><br />So this really isn't theoretical. It's a very common failure schenario for <br />mishandled interrupts. In fact, exactly because it's so common, these days <br />we have all this special logic in the generic interrupt layer that <br />notices, and shuts them up entirely (but does so by disabling _all_ the <br />devices on that interrupt, so when this happens, you might well lose your <br />disk driver or somethign else).<br /><br />			Linus<br />-<br />To unsubscribe from this list: send the line "unsubscribe linux-kernel" in<br />the body of a message to majordomo&#64;vger.kernel.org<br />More majordomo info at  <a href="http://vger.kernel.org/majordomo-info.html">http://vger.kernel.org/majordomo-info.html</a><br />Please read the FAQ at  <a href="http://www.tux.org/lkml/">http://www.tux.org/lkml/</a><br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
