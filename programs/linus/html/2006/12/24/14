    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2006/12/16/164">First message in thread</a></li><li><a href="/lkml/2006/12/22/154">Martin Michlmayr</a><ul><li><a href="/lkml/2006/12/24/13">"Gordon Farquharson"</a><ul><li class="origin"><a href="/lkml/2006/12/24/15">Linus Torvalds</a><ul><li><a href="/lkml/2006/12/24/15">Andrew Morton</a><ul><li><a href="/lkml/2006/12/24/17">Linus Torvalds</a></li><li><a href="/lkml/2006/12/24/23">Andrei Popa</a></li><li><a href="/lkml/2006/12/24/34">Martin Michlmayr</a></li></ul></li><li><a href="/lkml/2006/12/26/58">Tobias Diedrich</a><ul><li><a href="/lkml/2006/12/26/125">David Miller</a></li></ul></li></ul></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Sun, 24 Dec 2006 00:43:54 -0800 (PST)</td></tr><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: [PATCH] mm: fix page_mkclean_one (was: 2.6.19 file content corruption on ext3)</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody"><br /><br />On Sun, 24 Dec 2006, Gordon Farquharson wrote:<br />&gt; <br />&gt; Is there any way to provide any debugging information that may help<br />&gt; solve the problem ?<br /><br />I think we have people working on this. I know I'm trying to even come up <br />with an idea of what is going on. I don't think we know yet.<br /><br />&gt; Would it help to know the nature of the corruption e.g. an analysis<br />&gt; of the corruption in the file ?<br /><br />I actually think we know that, because Andrei already gave details. The <br />corruption seems to be basically a few pages that get zeroes at the end <br />rather than the expected contents. That's consistent with the page being <br />written out once, but then _not_ getting written out again despite being <br />dirtied some more.<br /><br />But if you see ay other pattern, please holler, because that would be <br />interesting.<br /><br />&gt; BTW, I decided to try Linus's test program [1] on ARM (I don't think<br />&gt; that anybody had tried it on ARM before).<br /><br />You get the expected results, and in fact, I'd be very surprised if you <br />didn't. It's something subtler than that going on.<br /><br />I now _suspect_ that we're talking about something like<br /><br /> - we started a writeout. The IO is still pending, and the page was <br />   marked clean and is now in the "writeback" phase.<br /> - a write happens to the page, and the page gets marked dirty again. <br />   Marking the page dirty also marks all the _buffers_ in the page dirty, <br />   but they were actually already dirty, because the IO hasn't completed <br />   yet.<br /> - the IO from the _previous_ write completes, and marks the buffers clean <br />   again.<br /><br />And no, thatr's not actually what is going on. The thing is, we actually <br />clear the buffer dirty bits when we start the IO, not when we end it, but <br />I think it is going to be this _kind_ of situation, where we missed <br />something, and marked it clean too late, and thus cleared a dirty bit.<br /><br />I don't think it's a page table issue any more, it just doesn't look <br />likely with the ARM UP corruption. It's also not apparently even on a <br />cacheline boundary, so it probably is really a dirty bit that got cleared <br />wrogn due to some race with IO.<br /><br />But right now we're all clueless. I personally suspect it's not even a new <br />bug: it's probably an old bug that simply didn't matter before.<br /><br />			Linus<br /><br />-<br />To unsubscribe from this list: send the line "unsubscribe linux-kernel" in<br />the body of a message to majordomo&#64;vger.kernel.org<br />More majordomo info at  <a href="http://vger.kernel.org/majordomo-info.html">http://vger.kernel.org/majordomo-info.html</a><br />Please read the FAQ at  <a href="http://www.tux.org/lkml/">http://www.tux.org/lkml/</a><br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
