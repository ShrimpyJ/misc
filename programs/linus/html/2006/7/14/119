    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2006/6/26/384">First message in thread</a></li><li><a href="/lkml/2006/7/13/351">Linus Torvalds</a><ul><li><a href="/lkml/2006/7/14/3">(Eric W. Biederman)</a><ul><li><a href="/lkml/2006/7/14/18">"H. Peter Anvin"</a></li></ul></li><li><a href="/lkml/2006/7/14/16">Edgar Hucek</a><ul><li class="origin"><a href="/lkml/2006/7/16/17">Linus Torvalds</a><ul><li><a href="/lkml/2006/7/16/17">Edgar Hucek</a><ul><li><a href="/lkml/2006/7/25/5">Andrew Morton</a></li></ul></li><li><a href="/lkml/2006/7/16/18">Edgar Hucek</a><ul><li><a href="/lkml/2006/7/25/7">Andrew Morton</a></li></ul></li></ul></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><script type="text/javascript" src="//pagead2.googlesyndication.com/pagead/show_ads.js"></script><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Fri, 14 Jul 2006 09:09:55 -0700 (PDT)</td></tr><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: [PATCH 1/1] Fix boot on efi 32 bit Machines [try #4]</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody"><br /><br />On Fri, 14 Jul 2006, Edgar Hucek wrote:<br />&gt;<br />&gt; This is the memory map from the efi shell :<br /><br />Ok, it really looks like EFI is broken. You said that "ACPI_MCFG table<br />returns e0000000", ie we should find the config space thing there, yet:<br /><br />&gt; [ snip snip ... ]<br />&gt; ACPI_recl  000000007EEEF000-000000007EEFEFFF  0000000000000010 000000000000000F<br />&gt; RT_data    000000007EEFF000-000000007EEFFFFF  0000000000000001 800000000000000F<br />&gt; MemMapIO   00000000E00F8000-00000000E00F8FFF  0000000000000001 8000000000000000<br />&gt; MemMapIO   00000000FED1C000-00000000FED1FFFF  0000000000000004 8000000000000000<br />&gt; MemMapIO   00000000FFFB0000-00000000FFFDFFFF  0000000000000030 8000000000000000<br /><br />It clearly wasn't there..<br /><br />However, it looks like your conversion is a bit buggy:<br /><br />&gt; This is the converted memory map :<br />&gt; <br />&gt; [ snip snip .. ]<br />&gt;  BIOS-EFI: 000000007eeef000 - 000000007eeff000 (ACPI data)<br />&gt;  BIOS-EFI: 00000000e00f8000 - 00000000e00f9000 (reserved)<br />&gt;  BIOS-EFI: 00000000fed1c000 - 00000000fed20000 (reserved)<br />&gt;  BIOS-EFI: 00000000fffb0000 - 00000000fffe0000 (reserved)<br /><br />The above is missing the "RT_data" thing (which was there in your input):<br /><br />	mem31: type=6, attr=0x800000000000000f, range=[0x000000007eeff000-0x000000007ef00000) (0MB)<br /><br />&gt; This is the funktion i used for converting :<br />&gt; <br />&gt;                 case EFI_RESERVED_TYPE:<br />&gt;                 case EFI_MEMORY_MAPPED_IO:<br />&gt;                 case EFI_MEMORY_MAPPED_IO_PORT_SPACE:<br />&gt;                 case EFI_UNUSABLE_MEMORY:<br />&gt;                         add_memory_region(md-&gt;phys_addr, md-&gt;num_pages &lt;&lt; EFI_PAGE_SHIFT, E820_RESERVED);<br />&gt;                         break;<br /><br />I think that should be a "default:", to make sure that you don't have any <br />memory region types that get ignored. Because it looks like you missed the <br />EFI_RUNTIME_SERVICES_CODE/EFI_RUNTIME_SERVICES_DATA ones at a minimum (an <br />dmaybe others - I didn't check).<br /><br />Anyway, that won't fix your bug, and yes, it sounds like you should add a <br />PCI_PROBE_FORCE_MMCFG flag (and then do the proper MMIO region reservation <br />to make sure that we don't allocate over it when allocating PCI <br />resources).<br /><br />Looks good otherwise.<br /><br />		Linus<br />-<br />To unsubscribe from this list: send the line "unsubscribe linux-kernel" in<br />the body of a message to majordomo&#64;vger.kernel.org<br />More majordomo info at  <a href="http://vger.kernel.org/majordomo-info.html">http://vger.kernel.org/majordomo-info.html</a><br />Please read the FAQ at  <a href="http://www.tux.org/lkml/">http://www.tux.org/lkml/</a><br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
