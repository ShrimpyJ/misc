    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2004/9/27/31">First message in thread</a></li><li><a href="/lkml/2004/9/27/31">CaT</a><ul><li><a href="/lkml/2004/9/30/260">CaT</a></li><li class="origin"><a href="/lkml/2004/9/30/268">Linus Torvalds</a><ul><li><a href="/lkml/2004/9/30/268">CaT</a><ul><li><a href="/lkml/2004/9/30/272">Linus Torvalds</a><ul><li><a href="/lkml/2004/9/30/277">Greg KH</a></li><li><a href="/lkml/2004/9/30/298">CaT</a></li><li><a href="/lkml/2004/10/1/47">CaT</a></li></ul></li></ul></li></ul></li></ul></li></ul><div class="threadlist">Patch in this message</div><ul class="threadlist"><li><a href="/lkml/diff/2004/9/30/265/1">Get diff 1</a></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Thu, 30 Sep 2004 16:21:10 -0700 (PDT)</td></tr><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: promise controller resource alloc problems with ~2.6.8</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody"><br /><br />On Mon, 27 Sep 2004, CaT wrote:<br />&gt;<br />&gt; I have a Promise PDC20267 card in my desktop and whilst it works<br />&gt; in 2.6.8-rc2, it no longer functions beginning with at least 2.6.9-rc2.<br />&gt; Latest kernel I ran is 2.6.9-rc2-bk8 and it was still not available.<br />&gt; <br />&gt; dmesg does mention it though as:<br />&gt; <br />&gt; PDC20267: IDE controller at PCI slot 0000:00:0d.0<br />&gt; PCI: Found IRQ 11 for device 0000:00:0d.0<br />&gt; PCI: Unable to reserve I/O region #5:40&#64;1080 for device 0000:00:0d.0<br /><br />Please send along /proc/ioports for both the working and the non-working <br />version (that's assuming that you can boot far enough in the nw version <br />to get it, of course, but the nw version is actually the more interesting <br />one, so please try ;).<br /><br />Also, does the attached patch (written by Shaohua Li based on suggestions <br />by me) solve the problem? My suspicion is that ACPI tables do bad things, <br />and that this might fix it..<br /><br />		Linus<br /><br />-----<br />===== drivers/acpi/motherboard.c 1.2 vs edited =====<br />--- 1.2/drivers/acpi/motherboard.c	2004-08-04 11:12:54 +08:00<br />+++ edited/drivers/acpi/motherboard.c	2004-08-31 11:28:27 +08:00<br />&#64;&#64; -170,4 +170,8 &#64;&#64; static int __init acpi_motherboard_init(<br /> 	return 0;<br /> }<br /> <br />-subsys_initcall(acpi_motherboard_init);<br />+/**<br />+ * Reserve motherboard resources after PCI claim BARs,<br />+ * but before PCI assign resources for uninitialized PCI devices<br />+ */<br />+fs_initcall(acpi_motherboard_init);<br />===== drivers/pnp/system.c 1.10 vs edited =====<br />--- 1.10/drivers/pnp/system.c	2004-03-21 00:38:56 +08:00<br />+++ edited/drivers/pnp/system.c	2004-08-31 11:29:35 +08:00<br />&#64;&#64; -104,4 +104,8 &#64;&#64; static int __init pnp_system_init(void)<br /> 	return pnp_register_driver(&amp;system_pnp_driver);<br /> }<br /> <br />-subsys_initcall(pnp_system_init);<br />+/**<br />+ * Reserve motherboard resources after PCI claim BARs,<br />+ * but before PCI assign resources for uninitialized PCI devices<br />+ */<br />+fs_initcall(pnp_system_init);<br />===== arch/i386/pci/i386.c 1.17 vs edited =====<br />--- 1.17/arch/i386/pci/i386.c	2004-08-25 14:35:30 +08:00<br />+++ edited/arch/i386/pci/i386.c	2004-08-31 11:34:29 +08:00<br />&#64;&#64; -164,7 +164,7 &#64;&#64; static void __init pcibios_allocate_reso<br /> 	}<br /> }<br /> <br />-static void __init pcibios_assign_resources(void)<br />+static int __init pcibios_assign_resources(void)<br /> {<br /> 	struct pci_dev *dev = NULL;<br /> 	int idx;<br />&#64;&#64; -204,6 +204,7 &#64;&#64; static void __init pcibios_assign_resour<br /> 				pci_assign_resource(dev, PCI_ROM_RESOURCE);<br /> 		}<br /> 	}<br />+	return 0;<br /> }<br /> <br /> void __init pcibios_resource_survey(void)<br />&#64;&#64; -212,8 +213,13 &#64;&#64; void __init pcibios_resource_survey(void<br /> 	pcibios_allocate_bus_resources(&amp;pci_root_buses);<br /> 	pcibios_allocate_resources(0);<br /> 	pcibios_allocate_resources(1);<br />-	pcibios_assign_resources();<br /> }<br />+<br />+/**<br />+ * called in fs_initcall (one below subsys_initcall),<br />+ * give a chance for motherboard reserve resources<br />+ */<br />+fs_initcall(pcibios_assign_resources);<br /> <br /> int pcibios_enable_resources(struct pci_dev *dev, int mask)<br /> {<br />-<br />To unsubscribe from this list: send the line "unsubscribe linux-kernel" in<br />the body of a message to majordomo&#64;vger.kernel.org<br />More majordomo info at  <a href="http://vger.kernel.org/majordomo-info.html">http://vger.kernel.org/majordomo-info.html</a><br />Please read the FAQ at  <a href="http://www.tux.org/lkml/">http://www.tux.org/lkml/</a><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
