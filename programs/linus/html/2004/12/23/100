    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2004/12/21/142">First message in thread</a></li><li><a href="/lkml/2004/12/23/80">Christoph Lameter</a><ul><li><a href="/lkml/2004/12/23/81">Christoph Lameter</a><ul><li><a href="/lkml/2004/12/23/82">Christoph Lameter</a><ul><li><a href="/lkml/2004/12/24/8">Pavel Machek</a><ul><li><a href="/lkml/2004/12/24/34">Christoph Lameter</a></li></ul></li><li><a href="/lkml/2004/12/24/40">"David S. Miller"</a><ul><li><a href="/lkml/2004/12/27/144">"David S. Miller"</a></li><li><a href="/lkml/2005/1/3/121">Christoph Lameter</a></li></ul></li><li><a href="/lkml/2005/1/1/13">Geert Uytterhoeven</a><ul><li><a href="/lkml/2005/1/4/318">Christoph Lameter</a></li></ul></li></ul></li><li><a href="/lkml/2004/12/23/83">Christoph Lameter</a></li><li><a href="/lkml/2004/12/23/84">Christoph Lameter</a></li><li><a href="/lkml/2004/12/23/88">Brian Gerst</a><ul><li><a href="/lkml/2004/12/24/36">Christoph Lameter</a></li></ul></li></ul></li><li><a href="/lkml/2004/12/23/87">Arjan van de Ven</a></li><li><a href="/lkml/2004/12/23/92">Matt Mackall</a></li><li><a href="/lkml/2004/12/23/93">Paul Mackerras</a></li><li><a href="/lkml/2004/12/23/96">Paul Mackerras</a><ul><li><a href="/lkml/2004/12/23/98">Andrew Morton</a><ul><li><a href="/lkml/2004/12/23/117">Paul Mackerras</a></li></ul></li><li class="origin"><a href="/lkml/2004/12/23/104">Linus Torvalds</a><ul><li><a href="/lkml/2004/12/23/104">Zwane Mwaikambo</a></li><li><a href="/lkml/2004/12/24/10">Arjan van de Ven</a><ul><li><a href="/lkml/2004/12/24/52">Linus Torvalds</a></li></ul></li><li><a href="/lkml/2004/12/24/33">Christoph Lameter</a></li></ul></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Thu, 23 Dec 2004 13:48:21 -0800 (PST)</td></tr><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: Prezeroing V2 [0/3]: Why and When it works</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody"><br /><br />On Fri, 24 Dec 2004, Paul Mackerras wrote:<br />&gt; <br />&gt; I did some measurements once on my G5 powermac (running a ppc64 linux<br />&gt; kernel) of how long clear_page takes, and it only takes 96ns for a 4kB<br />&gt; page.  This is real-life elapsed time in the kernel, not just some<br />&gt; cache-hot benchmark measurement.  Thus I don't think your patch will<br />&gt; gain us anything on ppc64.<br /><br />Well, the thing is, if we really _know_ the machine is idle (and not just <br />waiting for something like disk IO), it might be a good idea to just <br />pre-zero everything we can.<br /><br />The question to me is whether we can have a good enough heuristic to<br />notice that it triggers often enough to matter, but seldom enough that it<br />really won't disturb anybody.<br /><br />And "disturb" very much includes things like laptop battery life,<br />scheduling latencies, memory bus traffic _and_ cache contents. <br /><br />And I really don't see a very good heuristic. Maybe it might literally be<br />something like "five-second load average goes down to zero" (we've got<br />fixed-point arithmetic with eleven fractional bits, so we can tune just<br />how close to "zero" we want to get). The load average is system-wide and<br />takes disk load (which tends to imply latency-critical work) into account,<br />so that might actually work out reasonably well as a "the system really is<br />quiescent".<br /><br />So if we make the "what load is considered low" tunable, a system <br />administrator can use that to make it more aggressive. And indeed, you <br />might have a cron-job that says "be more aggressive at clearing pages <br />between 2AM and 4AM in the morning" or something - if you have so much <br />memory that it actually matters if you clear the memory just occasionally.<br /><br />And the tunable load-average check has another advantage: if you want to <br />benchmark it, you can first set it to true zero (basically never), and run <br />the benchmark, and then you can set it to something very agressive ("clear <br />pages every five seconds regardless of load") and re-run.<br /><br />Does this sound sane? Christoph - can you try making the "scrub deamon" do <br />that? Instead of the "scrub-low" and "scrub-high" (or in _addition_ to <br />them), do a "scub-load" thing that takes a scaled integer, and compares it <br />with "avenrun[0]" in kernel/timer.c: calc_load() when the average is <br />updated every five seconds..<br /><br />Personally, at least for a desktop usage, I think that the load average <br />would work wonderfully well. I know my machines are often at basically <br />zero load, and then having low-latency zero-pages when I sit down sounds <br />like a good idea. Whether there is _enough_ free memory around for a <br />5-second thing to work out well, I have no idea..<br /><br />		Linus<br />-<br />To unsubscribe from this list: send the line "unsubscribe linux-kernel" in<br />the body of a message to majordomo&#64;vger.kernel.org<br />More majordomo info at  <a href="http://vger.kernel.org/majordomo-info.html">http://vger.kernel.org/majordomo-info.html</a><br />Please read the FAQ at  <a href="http://www.tux.org/lkml/">http://www.tux.org/lkml/</a><br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
