    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2004/11/15/166">First message in thread</a></li><li><a href="/lkml/2004/11/18/185">Linus Torvalds</a><ul><li><a href="/lkml/2004/11/18/229">Elladan</a></li><li><a href="/lkml/2004/11/18/238">Miklos Szeredi</a><ul><li class="origin"><a href="">Linus Torvalds</a></li><li><a href="/lkml/2004/11/18/213">Linus Torvalds</a></li><li><a href="/lkml/2004/11/18/223">Miklos Szeredi</a></li><li><a href="/lkml/2004/11/18/226">Nikita Danilov</a></li><li><a href="/lkml/2004/11/18/235">Miklos Szeredi</a></li><li><a href="/lkml/2004/11/18/246">Andrew Morton</a><ul><li><a href="/lkml/2004/11/18/263">Miklos Szeredi</a></li><li><a href="/lkml/2004/11/19/55">Miklos Szeredi</a><ul><li><a href="/lkml/2004/11/27/81">Rik van Riel</a></li></ul></li></ul></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Thu, 18 Nov 2004 11:16:31 -0800 (PST)</td></tr><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: [PATCH] [Request for inclusion] Filesystem in Userspace</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody"><br /><br />On Thu, 18 Nov 2004, Miklos Szeredi wrote:<br />&gt; <br />&gt; Will the clients be allowed to fill up the _whole_ memory with dirty<br />&gt; pages?<br /><br />Sure. It's not a situation that is easy to get into, but it's a nasty <br />case.<br /><br />&gt; Page writeback will start sooner than that, and then the<br />&gt; client will not be able to dirty more pages until some are freed.<br /><br />Ehh - the _CPU_ handles dirtying pages all on its own. The OS never even <br />knows that a page got dirtied, so "starting writeout early" is not much of <br />an option.<br /><br />We actually had (for a short while) code that tracked the dirty bit in <br />software (ie make it unwritable by default, and take the write fault), but <br />people showed that that was actually a real performance problem on some <br />loads.<br /><br />&gt; BTW, I've never myself seen a deadlock, and I've not had any report of<br />&gt; it.<br /><br />Almost nobody uses shared writable mappings. Certainly not on "odd" <br />things. They are historically used by things like innd for the active <br />file, by some odd applications that want to do their own memory <br />management, and by databases. That's pretty much it.<br /><br />So it's entirely possible that you have never even _seen_ a shared <br />writable mapping even if you stressed the filesystem very hard. They <br />really are that rare.<br /><br />There's a few VM testers out there that do nasty things with writable <br />shared mappings. You could try them just for fun, but personally, if we <br />are seriously talking about merging FUSE, I'd actually prefer for writable <br />mappings to not be supported at all.<br /><br />It wouldn't be the only filesystem that doesn't support the thing. I think <br />even NFS didn't support them until I did the pagecache rewrite. Nobody <br />really complained (well, _very_ few did).<br /><br />IOW, from a merging standpoint, simple really _is_ better. Even if you<br />really really want to use exotic features like "direct IO" and writable<br />mappings some day, let's just put it this way: it's a lot easier to merge<br />something that has no questions about strange cases, and then _later_ add<br />in the strange cases, than it is to merge it all on day #1.<br /><br />I'm a sucker. Ask anybody. I'll accept the exact same patch that I<br />rejected earlier if you just do it the right way. I'm convinced that some<br />people actually do it on purpose just for the amusement value ("Look, he<br />did it _again_. What a doofus!")<br /><br />		Linus<br />-<br />To unsubscribe from this list: send the line "unsubscribe linux-kernel" in<br />the body of a message to majordomo&#64;vger.kernel.org<br />More majordomo info at  <a href="http://vger.kernel.org/majordomo-info.html">http://vger.kernel.org/majordomo-info.html</a><br />Please read the FAQ at  <a href="http://www.tux.org/lkml/">http://www.tux.org/lkml/</a><br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
