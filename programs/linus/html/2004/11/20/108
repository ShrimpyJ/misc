    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2004/11/14/157">First message in thread</a></li><li><a href="/lkml/2004/11/19/12">Chris Wright</a><ul><li><a href="/lkml/2004/11/20/35">Len Brown</a><ul><li><a href="/lkml/2004/11/20/75">Adrian Bunk</a><ul><li><a href="/lkml/2004/11/20/125">Linus Torvalds</a><ul><li><a href="/lkml/2004/11/20/136">Linus Torvalds</a></li><li><a href="/lkml/2004/11/21/90">Adrian Bunk</a></li><li><a href="/lkml/2004/11/22/221">Len Brown</a></li><li><a href="/lkml/2004/11/22/360">Chris Wright</a></li></ul></li><li><a href="/lkml/2004/11/22/195">Len Brown</a><ul><li><a href="/lkml/2004/11/22/336">Adrian Bunk</a></li></ul></li></ul></li><li class="origin"><a href="/lkml/2004/11/22/211">Linus Torvalds</a><ul><li><a href="/lkml/2004/11/22/211">Len Brown</a><ul><li><a href="/lkml/2004/11/22/223">Linus Torvalds</a></li></ul></li></ul></li><li><a href="/lkml/2004/11/22/358">Chris Wright</a></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Sat, 20 Nov 2004 08:41:24 -0800 (PST)</td></tr><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: 2.6.10-rc2 doesn't boot (if no floppy device)</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody"><br /><br />On Sat, 20 Nov 2004, Len Brown wrote:<br />&gt; <br />&gt; It clears the ELCR on Linux boot.<br /><br />I think this is _really_ wrong.<br /><br />Basically, you're screwing up more and more PIC state. <br /><br />Len, the PIC was _correct_ before ACPI touched it. We don't want to touch <br />it MORE, we want to touch it LESS. <br /><br />I'll try this for debugging, but what I want to figure out is where ACPI <br />is doing something it shouldn't be doing, and _removing_ that.<br /><br />We already had one patch where people tried to hide this problem by adding <br />more code. Clearly, that patch was bogus. Yes, it hid the problem for <br />floppies, but as shown by my other case (and as I was trying to say from <br />the beginning), it's not about floppies. It's about _any_ non-PCI <br />interrupt that apparently ACPI has done something _wrong_ for.<br /><br />So ACPI seems to assume that all interrupts are PCI interrupts, and that's <br />just totally wrong. Clearing ELCR is more of this total wrongness. ELCR <br />exists for a reason, namely that not all interrupts are PCI. <br /><br />Also, you seem to still totally concentrate on PIRQ routing etc. Totally<br />ignoring the fact that the problematic cases are about interrupts that<br />have _nothing_ to do with PCI. Not the floppy, not the PS/2 mouse. NOT<br />PCI! They're both on the southbridge behind a very special interface that<br />may or may not look like a PCI bus internally, but might quite as well be<br />something totally special-case (ie a perfectly normal case is that<br />somebody literally just bolted an old 8042 controller core into the system<br />and set up special case magic irq routing).<br /><br />&gt; ps. what I think is happening...<br />&gt; <br />&gt; To its credit, he BIOS correctly recognizes that there is<br />&gt; no floppy, and it routes a PIRQ to IRQ6.  It correctly sets the<br />&gt; ELCR bit for this IRQ.<br />&gt; <br />&gt; Linux boots and disables all the PCI Interrupt Links,<br />&gt; which un-programs the PIRQ directed to IRQ6.<br /><br />And this is what I think is the bug. There is no reason to disable the PCI <br />interrupt link unless you have a damn good reason to do so.<br /><br />&gt; However, Linux doesn't clear the ELCR first,<br />&gt; and for some reason that causes an interrupt<br />&gt; to latch in IRQ6 -- though it is masked.<br />&gt; <br />&gt; Along comes the broken floppy driver before<br />&gt; the PCI devices probe.  floppy<br />&gt; doesn't realize there is no hardware and<br />&gt; unwittingly does a request_irq(6).<br /><br />You are totally ignoring my other bug report which was for a (existing) <br />PSAUX mouse driver on irq12.<br /><br />If I had had a mouse on that port, it would not have worked.<br /><br />So the fact is, ACPI does something WRONG. <br /><br />		Linus<br />-<br />To unsubscribe from this list: send the line "unsubscribe linux-kernel" in<br />the body of a message to majordomo&#64;vger.kernel.org<br />More majordomo info at  <a href="http://vger.kernel.org/majordomo-info.html">http://vger.kernel.org/majordomo-info.html</a><br />Please read the FAQ at  <a href="http://www.tux.org/lkml/">http://www.tux.org/lkml/</a><br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
