    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2004/10/18/193">First message in thread</a></li><li><a href="/lkml/2004/10/19/2">Dmitry Torokhov</a><ul><li><a href="/lkml/2004/10/19/6">Andrew Morton</a></li><li><a href="/lkml/2004/10/19/8">Dmitry Torokhov</a><ul><li class="origin"><a href="/lkml/2004/10/19/33">Linus Torvalds</a><ul><li><a href="/lkml/2004/10/19/33">Jens Axboe</a></li><li><a href="/lkml/2004/10/19/40">Ben Collins</a></li><li><a href="/lkml/2004/10/19/117">James Bottomley</a><ul><li><a href="/lkml/2004/10/19/159">Matthew Wilcox</a></li></ul></li></ul></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Tue, 19 Oct 2004 00:13:08 -0700 (PDT)</td></tr><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: [BK PATCH] SCSI updates for 2.6.9</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody"><br />Ben,<br /> does this look ok to you?<br /><br />Arguably the SCSI layer should also have proper prefixes for its constants<br />- and in fact they do kind of exist as the GPCMD_xxx constants.  Oh, well.<br />Regardless, the sbp2 constants do look like they want prefixing..<br /><br />		Linus<br /><br />On Tue, 19 Oct 2004, Dmitry Torokhov wrote:<br /><br />&gt; On Monday 18 October 2004 11:41 pm, Dmitry Torokhov wrote:<br />&gt; &gt; On Monday 18 October 2004 05:03 pm, James Bottomley wrote:<br />&gt; &gt; <br />&gt; &gt; &gt; Matthew Wilcox:<br />&gt; &gt; &gt;   o Add SPI-5 constants to scsi.h<br />&gt; &gt; <br />&gt; &gt; This breaks Firewire SBP2 build:<br />&gt; &gt; <br />&gt; &gt;   CC [M]  drivers/ieee1394/sbp2.o<br />&gt; &gt; In file included from drivers/ieee1394/sbp2.c:78:<br />&gt; &gt; drivers/ieee1394/sbp2.h:61:1: warning: "ABORT_TASK_SET" redefined<br />&gt; &gt; In file included from drivers/scsi/scsi.h:31,<br />&gt; &gt;                  from drivers/ieee1394/sbp2.c:67:<br />&gt; &gt; include/scsi/scsi.h:255:1: warning: this is the location of the previous definition<br />&gt; &gt; In file included from drivers/ieee1394/sbp2.c:78:<br />&gt; &gt; drivers/ieee1394/sbp2.h:62:1: warning: "LOGICAL_UNIT_RESET" redefined<br />&gt; &gt; In file included from drivers/scsi/scsi.h:31,<br />&gt; &gt;                  from drivers/ieee1394/sbp2.c:67:<br />&gt; &gt; include/scsi/scsi.h:267:1: warning: this is the location of the previous definition<br />&gt; &gt; <br />&gt; &gt; It looks like firewire has its own set of commands with conflicting names.<br />&gt; &gt; Who should win?<br />&gt; &gt; <br />&gt; <br />&gt; I think something like the patch below shoudl work.<br />&gt; <br />&gt; -- <br />&gt; Dmitry<br />&gt; <br />&gt; <br />&gt; ===================================================================<br />&gt; <br />&gt; <br />&gt; ChangeSet&#64;1.1963, 2004-10-19 00:08:16-05:00, dtor_core&#64;ameritech.net<br />&gt;   IEEE1394: SBP-2 - rename some constants to fix clash with new<br />&gt;             SCSI core defines.<br />&gt; <br />&gt;   Signed-off-by: Dmitry Torokhov &lt;dtor&#64;mail.ru&gt;<br />&gt; <br />&gt; <br />&gt;  sbp2.c |    8 ++++----<br />&gt;  sbp2.h |   18 +++++++++---------<br />&gt;  2 files changed, 13 insertions(+), 13 deletions(-)<br />&gt; <br />&gt; <br />&gt; ===================================================================<br />&gt; <br />&gt; <br />&gt; <br />&gt; diff -Nru a/drivers/ieee1394/sbp2.c b/drivers/ieee1394/sbp2.c<br />&gt; --- a/drivers/ieee1394/sbp2.c	2004-10-19 00:10:58 -05:00<br />&gt; +++ b/drivers/ieee1394/sbp2.c	2004-10-19 00:10:58 -05:00<br />&gt; &#64;&#64; -1088,7 +1088,7 &#64;&#64;<br />&gt;  	scsi_id-&gt;query_logins_orb-&gt;query_response_hi = ORB_SET_NODE_ID(hi-&gt;host-&gt;node_id);<br />&gt;  	SBP2_DEBUG("sbp2_query_logins: query_response_hi/lo initialized");<br />&gt; <br />&gt; -	scsi_id-&gt;query_logins_orb-&gt;lun_misc = ORB_SET_FUNCTION(QUERY_LOGINS_REQUEST);<br />&gt; +	scsi_id-&gt;query_logins_orb-&gt;lun_misc = ORB_SET_FUNCTION(SBP2_QUERY_LOGINS_REQUEST);<br />&gt;  	scsi_id-&gt;query_logins_orb-&gt;lun_misc |= ORB_SET_NOTIFY(1);<br />&gt;  	if (scsi_id-&gt;sbp2_device_type_and_lun != SBP2_DEVICE_TYPE_LUN_UNINITIALIZED) {<br />&gt;  		scsi_id-&gt;query_logins_orb-&gt;lun_misc |= ORB_SET_LUN(scsi_id-&gt;sbp2_device_type_and_lun);<br />&gt; &#64;&#64; -1199,7 +1199,7 &#64;&#64;<br />&gt;  	scsi_id-&gt;login_orb-&gt;login_response_hi = ORB_SET_NODE_ID(hi-&gt;host-&gt;node_id);<br />&gt;  	SBP2_DEBUG("sbp2_login_device: login_response_hi/lo initialized");<br />&gt; <br />&gt; -	scsi_id-&gt;login_orb-&gt;lun_misc = ORB_SET_FUNCTION(LOGIN_REQUEST);<br />&gt; +	scsi_id-&gt;login_orb-&gt;lun_misc = ORB_SET_FUNCTION(SBP2_LOGIN_REQUEST);<br />&gt;  	scsi_id-&gt;login_orb-&gt;lun_misc |= ORB_SET_RECONNECT(0);	/* One second reconnect time */<br />&gt;  	scsi_id-&gt;login_orb-&gt;lun_misc |= ORB_SET_EXCLUSIVE(exclusive_login);	/* Exclusive access to device */<br />&gt;  	scsi_id-&gt;login_orb-&gt;lun_misc |= ORB_SET_NOTIFY(1);	/* Notify us of login complete */<br />&gt; &#64;&#64; -1325,7 +1325,7 &#64;&#64;<br />&gt;  	scsi_id-&gt;logout_orb-&gt;reserved3 = 0x0;<br />&gt;  	scsi_id-&gt;logout_orb-&gt;reserved4 = 0x0;<br />&gt; <br />&gt; -	scsi_id-&gt;logout_orb-&gt;login_ID_misc = ORB_SET_FUNCTION(LOGOUT_REQUEST);<br />&gt; +	scsi_id-&gt;logout_orb-&gt;login_ID_misc = ORB_SET_FUNCTION(SBP2_LOGOUT_REQUEST);<br />&gt;  	scsi_id-&gt;logout_orb-&gt;login_ID_misc |= ORB_SET_LOGIN_ID(scsi_id-&gt;login_response-&gt;length_login_ID);<br />&gt; <br />&gt;  	/* Notify us when complete */<br />&gt; &#64;&#64; -1390,7 +1390,7 &#64;&#64;<br />&gt;  	scsi_id-&gt;reconnect_orb-&gt;reserved3 = 0x0;<br />&gt;  	scsi_id-&gt;reconnect_orb-&gt;reserved4 = 0x0;<br />&gt; <br />&gt; -	scsi_id-&gt;reconnect_orb-&gt;login_ID_misc = ORB_SET_FUNCTION(RECONNECT_REQUEST);<br />&gt; +	scsi_id-&gt;reconnect_orb-&gt;login_ID_misc = ORB_SET_FUNCTION(SBP2_RECONNECT_REQUEST);<br />&gt;  	scsi_id-&gt;reconnect_orb-&gt;login_ID_misc |=<br />&gt;  		ORB_SET_LOGIN_ID(scsi_id-&gt;login_response-&gt;length_login_ID);<br />&gt; <br />&gt; diff -Nru a/drivers/ieee1394/sbp2.h b/drivers/ieee1394/sbp2.h<br />&gt; --- a/drivers/ieee1394/sbp2.h	2004-10-19 00:10:58 -05:00<br />&gt; +++ b/drivers/ieee1394/sbp2.h	2004-10-19 00:10:58 -05:00<br />&gt; &#64;&#64; -52,15 +52,15 &#64;&#64;<br />&gt;  	u8 cdb[12];<br />&gt;  };<br />&gt; <br />&gt; -#define LOGIN_REQUEST			0x0<br />&gt; -#define QUERY_LOGINS_REQUEST		0x1<br />&gt; -#define RECONNECT_REQUEST		0x3<br />&gt; -#define SET_PASSWORD_REQUEST		0x4<br />&gt; -#define LOGOUT_REQUEST			0x7<br />&gt; -#define ABORT_TASK_REQUEST		0xb<br />&gt; -#define ABORT_TASK_SET			0xc<br />&gt; -#define LOGICAL_UNIT_RESET		0xe<br />&gt; -#define TARGET_RESET_REQUEST		0xf<br />&gt; +#define SBP2_LOGIN_REQUEST		0x0<br />&gt; +#define SBP2_QUERY_LOGINS_REQUEST	0x1<br />&gt; +#define SBP2_RECONNECT_REQUEST		0x3<br />&gt; +#define SBP2_SET_PASSWORD_REQUEST	0x4<br />&gt; +#define SBP2_LOGOUT_REQUEST		0x7<br />&gt; +#define SBP2_ABORT_TASK_REQUEST		0xb<br />&gt; +#define SBP2_ABORT_TASK_SET		0xc<br />&gt; +#define SBP2_LOGICAL_UNIT_RESET		0xe<br />&gt; +#define SBP2_TARGET_RESET_REQUEST	0xf<br />&gt; <br />&gt;  #define ORB_SET_LUN(value)                      (value &amp; 0xffff)<br />&gt;  #define ORB_SET_FUNCTION(value)                 ((value &amp; 0xf) &lt;&lt; 16)<br />&gt; <br />-<br />To unsubscribe from this list: send the line "unsubscribe linux-kernel" in<br />the body of a message to majordomo&#64;vger.kernel.org<br />More majordomo info at  <a href="http://vger.kernel.org/majordomo-info.html">http://vger.kernel.org/majordomo-info.html</a><br />Please read the FAQ at  <a href="http://www.tux.org/lkml/">http://www.tux.org/lkml/</a><br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
