    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2004/8/24/220">First message in thread</a></li><li><a href="/lkml/2004/8/26/300">Rik van Riel</a><ul><li><a href="/lkml/2004/8/26/308">Linus Torvalds</a><ul><li><a href="/lkml/2004/8/26/504">"Martin J. Bligh"</a><ul><li><a href="/lkml/2004/8/26/386">Linus Torvalds</a></li><li><a href="/lkml/2004/8/26/389">"Martin J. Bligh"</a><ul><li><a href="/lkml/2004/8/26/438">"Miquel van Smoorenburg"</a></li></ul></li><li><a href="/lkml/2004/8/26/397">Jamie Lokier</a></li><li><a href="/lkml/2004/8/26/402">Chris Wright</a></li><li><a href="/lkml/2004/8/26/411">Christophe Saout</a></li><li><a href="/lkml/2004/8/26/453">Linus Torvalds</a></li><li><a href="/lkml/2004/8/27/11">Anton Altaparmakov</a></li><li><a href="/lkml/2004/8/27/55">David Greaves</a></li></ul></li><li><a href="/lkml/2004/8/26/565">Rik van Riel</a><ul><li><a href="/lkml/2004/8/26/335">Linus Torvalds</a><ul><li><a href="/lkml/2004/8/26/332">Rik van Riel</a></li><li><a href="/lkml/2004/8/26/349">Jamie Lokier</a></li></ul></li><li><a href="/lkml/2004/8/27/21">Herbert Poetzl</a></li></ul></li><li><a href="/lkml/2004/8/27/13">Hans Reiser</a><ul><li><a href="/lkml/2004/8/27/104">Rik van Riel</a><ul><li><a href="/lkml/2004/8/27/189">Hans Reiser</a></li><li><a href="/lkml/2004/8/27/248">Christian Mayrhuber</a></li></ul></li><li><a href="/lkml/2004/8/27/112">Rik van Riel</a><ul><li><a href="/lkml/2004/8/27/118">Spam</a></li><li><a href="/lkml/2004/8/27/191">Hans Reiser</a></li></ul></li></ul></li></ul></li><li><a href="/lkml/2004/8/26/325">Denis Vlasenko</a><ul><li class="origin"><a href="/lkml/2004/8/26/337">Linus Torvalds</a><ul><li><a href="/lkml/2004/8/26/337">	viro&#64;parcelfa ...</a><ul><li><a href="/lkml/2004/8/26/382">	viro&#64;parcelfa ...</a></li></ul></li></ul></li><li><a href="/lkml/2004/8/26/549">Jonathan Abbey</a><ul><li><a href="/lkml/2004/8/26/371">Christophe Saout</a></li><li><a href="/lkml/2004/8/26/373">Jamie Lokier</a></li><li><a href="/lkml/2004/8/26/406">Nikita Danilov</a></li><li><a href="/lkml/2004/8/26/412">Christophe Saout</a></li><li><a href="/lkml/2004/8/26/428">Nikita Danilov</a></li><li><a href="/lkml/2004/8/26/431">Christophe Saout</a></li><li><a href="/lkml/2004/8/26/434">Emil Larsson</a></li><li><a href="/lkml/2004/8/26/503">Hans Reiser</a></li><li><a href="/lkml/2004/8/26/532">Stephen Wille Padnos</a></li></ul></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Thu, 26 Aug 2004 11:46:33 -0700 (PDT)</td></tr><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: silent semantic changes with reiser4</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody"><br /><br />On Thu, 26 Aug 2004, Denis Vlasenko wrote:<br />&gt; <br />&gt; Is it possible to sufficiently hide "dirs inside files"<br />&gt; so that old tools will be unable to see them?<br /><br />Certainly possible.<br /><br />&gt; I just checked:<br />&gt; <br />&gt; ls -d /foo  does lstat64("/foo", ...)<br />&gt; ls -d /foo/ does lstat64("/foo", ...)<br />&gt; 	but<br />&gt; ls -d /foo/. does lstat64("/foo/.", ...)<br />&gt; <br />&gt; Will it work out if "dir inside file" will only be visible when referred as "file/."?<br /><br />That would likely be the _easiest_ approach for the kernel, and does solve <br />the problem with some apps knowingly removing the trailing '/'.<br /><br />Note that we could try this out with existing filesystems with very <br />minimal changes:<br /><br /> - make directory bind mounts work on top of files ("graft_tree()")<br /> - make open_namei() and friend _not_ do the mount-point following for the <br />   last component if it's a non-directory.<br /> - probably some trivial fixups I haven't thought about. There might be <br />   some places that use "S_ISDIR()" to check for whether something can be <br />   looked up, but the main path walking already just checks whether there<br />   is a ".lookup" operation or not.<br /><br />This would already allow people to "try out" how different applications <br />would react to a file that can show up both as a directory and a file. The <br />patch might end up being less than 25 lines or so, the difficulty is in <br />finding all the right places.<br /><br />Al, anything I missed?<br /><br />(And yes, it's a quick hack, but it's a quick hack that would probably<br />mimic a good part of what we would have to do internally in the VFS layer<br />to support this notion anyway).<br /><br />		Linus<br />-<br />To unsubscribe from this list: send the line "unsubscribe linux-kernel" in<br />the body of a message to majordomo&#64;vger.kernel.org<br />More majordomo info at  <a href="http://vger.kernel.org/majordomo-info.html">http://vger.kernel.org/majordomo-info.html</a><br />Please read the FAQ at  <a href="http://www.tux.org/lkml/">http://www.tux.org/lkml/</a><br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
