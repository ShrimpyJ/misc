    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2005/11/17/10">First message in thread</a></li><li><a href="/lkml/2005/11/17/10">Maneesh Soni</a><ul><li class="origin"><a href="/lkml/2005/11/18/44">Linus Torvalds</a><ul><li><a href="/lkml/2005/11/18/44">Maneesh Soni</a></li></ul></li></ul></li></ul><div class="threadlist">Patch in this message</div><ul class="threadlist"><li><a href="/lkml/diff/2005/11/17/209/1">Get diff 1</a></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Thu, 17 Nov 2005 11:54:32 -0800 (PST)</td></tr><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: maxcpus=1 broken, ACPI bug?</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody"><br /><br />On Thu, 17 Nov 2005, Maneesh Soni wrote:<br />&gt; <br />&gt; Using maxcpus=1 boot option, hangs the system while booting. It was<br />&gt; working till 2.6.13-rc2. After git bisect I found that after backing<br />&gt; out this ACPI patch it works again, though I had to manually sort the<br />&gt; reject while backing out.<br />&gt; <br />&gt; <a href="https://www.kernel.org/git/?p=linux/kernel/git/torvalds/linux-2.6.git;a=commitdiff;h=acf05f4b7f558051ea0028e8e617144123650272">http://www.kernel.org/git/?p=linux/kernel/git/torvalds/linux-2.6.git;a=commitdiff;h=acf05f4b7f558051ea0028e8e617144123650272</a><br /><br />Hmm. That patch had a totally idiotic thinko in it (look at the for-loop <br />in acpi_processor_get_power_info_default() and notice how it doesn't <br />actually change anything in the loop).<br /><br />That thinko was later fixed (albeit in a really stupid way, and the same <br />cut-and-paste bug still exists in acpi_processor_get_power_info_fadt()).<br /><br />Anyway, can you test this diff? It<br /><br /> (a) removes the insane (and in one case incorrect) memset loop<br /> (b) makes the code that sets "pr-&gt;flags.power = 1" match the comment and <br />     the previous behaviour.<br /><br />Does that make a difference?<br /><br />		Linus<br /><br />---<br />diff --git a/drivers/acpi/processor_idle.c b/drivers/acpi/processor_idle.c<br />index 573b6a9..2445828 100644<br />--- a/drivers/acpi/processor_idle.c<br />+++ b/drivers/acpi/processor_idle.c<br />&#64;&#64; -524,8 +524,7 &#64;&#64; static int acpi_processor_get_power_info<br /> 	if (!pr-&gt;pblk)<br /> 		return_VALUE(-ENODEV);<br /> <br />-	for (i = 0; i &lt; ACPI_PROCESSOR_MAX_POWER; i++)<br />-		memset(pr-&gt;power.states, 0, sizeof(struct acpi_processor_cx));<br />+	memset(pr-&gt;power.states, 0, sizeof(pr-&gt;power.states));<br /> <br /> 	/* if info is obtained from pblk/fadt, type equals state */<br /> 	pr-&gt;power.states[ACPI_STATE_C1].type = ACPI_STATE_C1;<br />&#64;&#64; -559,9 +558,7 &#64;&#64; static int acpi_processor_get_power_info<br /> <br /> 	ACPI_FUNCTION_TRACE("acpi_processor_get_power_info_default_c1");<br /> <br />-	for (i = 0; i &lt; ACPI_PROCESSOR_MAX_POWER; i++)<br />-		memset(&amp;(pr-&gt;power.states[i]), 0,<br />-		       sizeof(struct acpi_processor_cx));<br />+	memset(pr-&gt;power.states, 0, sizeof(pr-&gt;power.states));<br /> <br /> 	/* if info is obtained from pblk/fadt, type equals state */<br /> 	pr-&gt;power.states[ACPI_STATE_C1].type = ACPI_STATE_C1;<br />&#64;&#64; -873,7 +870,8 &#64;&#64; static int acpi_processor_get_power_info<br /> 	for (i = 1; i &lt; ACPI_PROCESSOR_MAX_POWER; i++) {<br /> 		if (pr-&gt;power.states[i].valid) {<br /> 			pr-&gt;power.count = i;<br />-			pr-&gt;flags.power = 1;<br />+			if (pr-&gt;power.states[i].type &gt;= ACPI_STATE_C2)<br />+				pr-&gt;flags.power = 1;<br /> 		}<br /> 	}<br /> <br />-<br />To unsubscribe from this list: send the line "unsubscribe linux-kernel" in<br />the body of a message to majordomo&#64;vger.kernel.org<br />More majordomo info at  <a href="http://vger.kernel.org/majordomo-info.html">http://vger.kernel.org/majordomo-info.html</a><br />Please read the FAQ at  <a href="http://www.tux.org/lkml/">http://www.tux.org/lkml/</a><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
