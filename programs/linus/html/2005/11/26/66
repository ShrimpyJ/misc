    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2005/11/24/129">First message in thread</a></li><li><a href="/lkml/2005/11/26/62">Linus Torvalds</a><ul><li><a href="/lkml/2005/11/26/64">Oleg Nesterov</a><ul><li class="origin"><a href="/lkml/2005/11/27/25">Linus Torvalds</a><ul><li><a href="/lkml/2005/11/27/25">Oleg Nesterov</a></li><li><a href="/lkml/2005/11/27/28">Ingo Molnar</a></li></ul></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Sat, 26 Nov 2005 10:47:13 -0800 (PST)</td></tr><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: [PATCH 1/2] PF_DEAD: cleanup usage</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody"><br /><br />On Sat, 26 Nov 2005, Oleg Nesterov wrote:<br />&gt; <br />&gt; Ok, I see you point now, thanks.<br /><br />Well, in all fairness, it's entirely possible (nay, likely) that PF_DEAD <br />just isn't relevant the way it used to be.<br /><br />Looking at the history, the immediate reason for PF_DEAD was (I think) <br />that we had a race where we would first mark the task as a ZOMBIE, and <br />then if it was self-reaping, we'd mark it dead in release_task(). But we <br />dropped the tasklist_lock in between, which meant that the real parent <br />could come in and reap it just before it reaped itself, and all hell would <br />break lose. <br /><br />That bug was fixed sixteen hours after PF_DEAD was introduced (thanks to a <br />bug-on on PF_DEAD that never even made the kernel history, I suspect), and <br />I doubt PF_DEAD has done anything for us since (and this was two years <br />ago).<br /><br />What I'm trying to say is that it's entirely possible that your cleanup is <br />just way overdue, and we shouldn't have that separate PF_DEAD thing any <br />more. My arguments against your patch is mainly me just being nervous, and <br />I'm not 100% convinced they are valid and good arguments.<br /><br />HOWEVER. I just noticed something strange. EXIT_DEAD should be in <br />"task-&gt;exit_state", not in "task-&gt;state". So there's something strange <br />going on in that neck of the woods _anyway_. That whole<br /><br />	...<br />        if (unlikely(prev-&gt;flags &amp; PF_DEAD))<br />                prev-&gt;state = EXIT_DEAD;<br />	...<br /><br />in kernel/sched.c seems totally bogus.<br /><br />I think we should remove that thing entirely, since it's actually a total <br />no-op, apart from doing something that is actively wrong. The "exit_state" <br />flag should already _be_ EXIT_DEAD, no? And the "task-&gt;state" flag should <br />never be EXIT_DEAD in the first place.<br /><br />And now that "exit_state" is already separate from "state", the reason for <br />PF_DEAD really is gone, and it could be replaced with a<br /><br />	tsk-&gt;exit_state &amp; EXIT_DEAD<br /><br />test instead.<br /><br />Roland added to Cc:, because the exit_state splitup was his, I think.<br /><br />Oleg? Roland?<br /><br />			Linus<br />-<br />To unsubscribe from this list: send the line "unsubscribe linux-kernel" in<br />the body of a message to majordomo&#64;vger.kernel.org<br />More majordomo info at  <a href="http://vger.kernel.org/majordomo-info.html">http://vger.kernel.org/majordomo-info.html</a><br />Please read the FAQ at  <a href="http://www.tux.org/lkml/">http://www.tux.org/lkml/</a><br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
