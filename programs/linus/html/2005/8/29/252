    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2005/8/29/242">First message in thread</a></li><li><a href="/lkml/2005/8/29/242">Benjamin Herrenschmidt</a><ul><li class="origin"><a href="/lkml/2005/8/30/14">Linus Torvalds</a><ul><li><a href="/lkml/2005/8/30/14">Jon Smirl</a></li></ul></li><li><a href="/lkml/2005/8/29/256">Benjamin Herrenschmidt</a><ul><li><a href="/lkml/2005/8/29/262">Linus Torvalds</a><ul><li><a href="/lkml/2005/8/30/2">Linus Torvalds</a><ul><li><a href="/lkml/2005/8/30/4">"David S. Miller"</a></li></ul></li><li><a href="/lkml/2005/8/30/9">Benjamin Herrenschmidt</a><ul><li><a href="/lkml/2005/8/30/22">Linus Torvalds</a></li></ul></li></ul></li></ul></li><li><a href="/lkml/2005/8/30/8">Jon Smirl</a><ul><li><a href="/lkml/2005/8/30/26">"David S. Miller"</a><ul><li><a href="/lkml/2005/8/30/33">Benjamin Herrenschmidt</a></li></ul></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Mon, 29 Aug 2005 20:15:04 -0700 (PDT)</td></tr><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: Ignore disabled ROM resources at setup</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody"><br /><br />On Tue, 30 Aug 2005, Benjamin Herrenschmidt wrote:<br />&gt; <br />&gt; pci_map_rom "sees" that the resource is unassigned by testing the parent<br />&gt; pointer, and calls pci_assign_resource() which, with this new patch,<br />&gt; will do nothing.<br /><br />Ehh.. It didn't do anything with the old code either for that case, so <br />there's apparently something else also going on.<br /><br />It would write the base address, but since it wouldn't _enable_ the ROM<br />mapping (only the "non-enabled" case changed by this commit), the end<br />result from a hw standpoint should be exactly the same: the ROM isn't<br />actually mapped.<br /><br />So after pci_assign_resource(), the resource has literally been assigned, <br />but that patch should not have mattered in any way whether it was actually <br />_enabled_ or not.<br /><br />Now, there's clearly a difference. What has always worked is then to do<br /><br />	pci_write_config_dword(dev,<br />		PCI_ROM_ADDRESS,<br />		PCI_ROM_ADDRESS_ENABLE | res-&gt;start)<br /><br />(well, these days you're supposed to use "pcibios_resource_to_bus()" to<br />get the start value to write out).<br /><br />Much preferable is probably to just enable the resource manually _before_<br />calling pci_assign_resource, ie do something like.<br /><br />	dev-&gt;resource[PCI_ROM_RESOURCE].flags |= IORESOURCE_ROM_ENABLE;<br />	pci_assign_resource(dev, PCI_ROM_RESOURCE);<br /><br />But yes, if something used to just blindly set PCI_ROM_ADDRESS_ENABLE,<br />then that got broken. I grepped for that and didn't see anything like it,<br />but I guess people are doing it with the magic constant "1"..<br /><br />I don't even find any access to "PCI_ROM_ADDRESS" in radeonfb, so I wonder<br />if it has ever worked? I get the feeling that if the ROM wasn't enabled,<br />it didn't work before either, but perhaps the change makes the failure<br />mode more spectacular?<br /><br />			Linus<br />-<br />To unsubscribe from this list: send the line "unsubscribe linux-kernel" in<br />the body of a message to majordomo&#64;vger.kernel.org<br />More majordomo info at  <a href="http://vger.kernel.org/majordomo-info.html">http://vger.kernel.org/majordomo-info.html</a><br />Please read the FAQ at  <a href="http://www.tux.org/lkml/">http://www.tux.org/lkml/</a><br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
