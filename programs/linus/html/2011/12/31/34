    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2011/12/31/23">First message in thread</a></li><li><a href="/lkml/2011/12/31/31">Linus Torvalds</a><ul><li><a href="/lkml/2011/12/31/33">Matthew Garrett</a><ul><li class="origin"><a href="">Linus Torvalds</a></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><script type="text/javascript" src="//pagead2.googlesyndication.com/pagead/show_ads.js"></script><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Sat, 31 Dec 2011 12:26:57 -0800</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: loading firmware while usermodehelper disabled.</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody">On Sat, Dec 31, 2011 at 12:15 PM, Matthew Garrett &lt;mjg&#64;redhat.com&gt; wrote:<br />&gt; On Sat, Dec 31, 2011 at 11:29:56AM -0800, Linus Torvalds wrote:<br />&gt;<br />&gt;&gt; But what the driver *should* be doing is to load the firmware at<br />&gt;&gt; device open time (NOT at "driver load time" - because that can and<br />&gt;&gt; does happen too early too, for the case of built-in drivers!) and<br />&gt;&gt; simply keep the firmware around in the case of a suspend/resume event,<br />&gt;&gt; so that it doesn't have to re-load it off a disk (or network, or<br />&gt;&gt; whatever) that hasn't been resumed yet!<br />&gt;<br />&gt; That doesn't work for the isight firmware loader - there's nothing for<br />&gt; userspace to open until the device has had the firmware loaded, at which<br />&gt; point it detaches and reattaches as a UVC device. The code could be<br />&gt; merged into the UVC driver and a fake v4l device exposed, but even then<br />&gt; you'd still need to deal with the underlying usb_device suddenly<br />&gt; changing under you.<br /><br />Well, what you *could* do is to simply say: this driver has to be a<br />module, and cannot be built-in. Or, if built-in, the firmware has to<br />be built-in too (but there are probably licensing issues with that).<br /><br />At that point, you can load the firmware when you load the isight<br />driver, since hopefully by then you have a real filesystem (not just<br />initrd or something - although you could obviously put the firmware in<br />the initrd image too).<br /><br />And then, you just keep the firmware in memory as long as the module<br />is loaded. It's not as good as loading at open time, but at least for<br />the suspend/resume case it's better than trying to load it at resume<br />time when it fundamentally cannot work.<br /><br />&gt; So for this specific case, I'd like to track down why the behaviour has<br />&gt; changed<br /><br />That driver isn't all that recent, it may be that what changed is that<br />you just used to rely on the disk being woken up before the isight<br />device was, and things just magically happened to work.<br /><br />We explicitly disallowed the "magically happened to work" case because<br />it was so often not true, and when it wasn't true, it resulted in<br />60-second timeouts (or whatever the "failed to load" timeout was) and<br />non-working devices. So the warning and the failure is actually "new"<br />(well, by now it's been a year or so), to make developers who write<br />drivers *see* the failure instead of having a "it works on my<br />particular hardware and filesystem layout" model.<br /><br />                           Linus<br /><br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
