    </div></td><td width="32"> </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2011/12/14/380">First message in thread</a></li><li><a href="/lkml/2011/12/14/543">Linus Torvalds</a><ul><li><a href="/lkml/2011/12/15/339">Ted Ts'o</a><ul><li class="origin"><a href="">Linus Torvalds</a></li><li><a href="/lkml/2011/12/21/7">Junio C Hamano</a><ul><li><a href="/lkml/2011/12/21/9">Junio C Hamano</a></li></ul></li></ul></li><li><a href="/lkml/2011/12/21/10">Junio C Hamano</a></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Thu, 15 Dec 2011 14:13:41 -0800</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: [GIT PULL] ext4 bugfixes for 3.2-rc5</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody">On Thu, Dec 15, 2011 at 11:08 AM, Ted Ts'o &lt;tytso&#64;mit.edu&gt; wrote:<br />&gt;<br />&gt; Cool!  Does it save enough that GPG signature information can be<br />&gt; verified later?<br /><br />Yes, it saves the whole tag object data, and the verification really<br />is very simple.<br /><br />Do the command line I suggested:<br /><br />  git cat-file commit 2240a7bb479c |<br />       awk '/^mergetag /,/^$/ { print }' |<br />       sed 's/^mergetag//' |<br />       sed 's/^ //'<br /><br />(ok, that can almost certainly be done smarter, but it's a<br />step-by-step trivial thing: the "awk" line to get everything in the<br />commit object header 'mergetag' line to tne end of the commit header<br />(empty line), followed by removing the "mergetag" part, followed by<br />removing the continuation space at the beginning of the line.<br /><br />Now, save the end result to a file, and then split the file so that<br />the gpg signature part (-----BEGIN PGP SIGNATURE----- etc) is in<br />"file.sign", and the part before it, which in this case is<br /><br />  object 5a0dc7365c240795bf190766eba7a27600be3b3e<br />  type commit<br />  tag tytso-for-linus-20111214<br />  tagger Theodore Ts'o &lt;tytso&#64;mit.edu&gt; 1323890113 -0500<br /><br />  tytso-for-linus-20111214<br /><br />is in the file "file", and now you can just do<br /><br />  [torvalds&#64;i5 linux]$ gpg --verify file.sign file<br />  gpg: Signature made Wed 14 Dec 2011 11:15:13 AM PST using RSA key ID C11804F0<br />  gpg: Good signature from "Theodore Ts'o &lt;tytso&#64;mit.edu&gt;"<br />  gpg:                 aka "Theodore Ts'o &lt;tytso&#64;debian.org&gt;"<br />  gpg:                 aka "Theodore Ts'o &lt;tytso&#64;google.com&gt;"<br /><br />&gt;                   I'm a little fuzzy on what is covered by the<br />&gt; signature which gets verified when you run the command "git verify-tag<br />&gt; tytso-for-linus-20111214".  Better yet, does the new version of git<br />&gt; have a command that will automatically verify the digital signature<br />&gt; found in a merge commit?<br /><br />See above, the pgp signature logic is *really* simple: it's literally<br />"the pgp signature at the end covers everything up until the pgp<br />signature part".<br /><br />And it's unambiguous even in the case of multiple lines of "-----BEGIN<br />PGP SIGNATURE-----" - you just need to take the last block. Whether we<br />do that right in the actual implementation, I have no idea, but the<br />thing is at least designed to allow that.<br /><br />This all literally used to be a couple of lines of shell script in the<br />original git implementation of "git verify-tag".<br /><br />You can just go to the git sources, and do<br /><br />   git log -p -- git-verify-tag.sh<br /><br />to see that old historic implementation, of course. Here's the very<br />original one:<br /><br />  #!/bin/sh<br />  . git-sh-setup || die "Not a git archive"<br /><br />  tag=$(git-rev-parse $1) || exit 1<br /><br />  git-cat-file tag $tag &gt; .tmp-vtag || exit 1<br />  cat .tmp-vtag | sed '/-----BEGIN PGP/Q' | gpg --verify .tmp-vtag - || exit 1<br />  rm -f .tmp-vtag<br /><br />which gets it wrong for the case of multiple lines of "BEGIN PGP", but<br />whatever.<br /><br />&gt; And this isn't in 1.7.8 yet, right?  I'd have to build version of git<br />&gt; based on the next branch to play with this new signatury goodness?<br /><br />If you actually want to merge signed tags with the save-the-tag-info<br />feature, yes. It's in the current master branch of git, but not in any<br />released version yet.<br /><br />                    Linus<br />--<br />To unsubscribe from this list: send the line "unsubscribe linux-kernel" in<br />the body of a message to majordomo&#64;vger.kernel.org<br />More majordomo info at  <a href="http://vger.kernel.org/majordomo-info.html">http://vger.kernel.org/majordomo-info.html</a><br />Please read the FAQ at  <a href="http://www.tux.org/lkml/">http://www.tux.org/lkml/</a><br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
