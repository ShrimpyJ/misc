    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2000/11/22/36">First message in thread</a></li><li><a href="/lkml/2000/11/22/36">Tobias Ringstrom</a><ul><li><a href="/lkml/2000/11/22/91">Tobias Ringstrom</a><ul><li class="origin"><a href="/lkml/2000/11/23/93">Linus Torvalds</a><ul><li><a href="/lkml/2000/11/23/93">Tobias Ringstrom</a></li><li><a href="/lkml/2000/11/24/147">Tobias Ringstrom</a></li></ul></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><script type="text/javascript" src="//pagead2.googlesyndication.com/pagead/show_ads.js"></script><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Thu, 23 Nov 2000 10:06:32 -0800 (PST)</td></tr><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: Cardbus bridge problems</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody"><br />[ Tobias: thanks for an excellent report, btw ]<br /><br />On Wed, 22 Nov 2000, Tobias Ringstrom wrote:<br />&gt; On Wed, 22 Nov 2000, Tobias Ringstrom wrote:<br />&gt; <br />&gt; &gt; Not that I like it, but I need to boot Win98, and then warm boot into<br />&gt; &gt; Linux, or the Cardbus is not working.  This is using Linux-2.4.0-test11 on<br />&gt; &gt; a Mitac 7233 laptop.<br />&gt; &gt; <br />&gt; &gt; Using lspci, I can see that the secondary and subordinate busses of the<br />&gt; &gt; Cardbus bridges are unconfigured/incorrect. I have attached dmesg and<br />&gt; &gt; lspci -vvvxxx output from the two cases (ok=Win98+warm-boot and<br />&gt; &gt; fail=cold-boot). I have enabled all PCI debug things I could find. Bw, it<br />&gt; &gt; would be really nice to have ONE place to enable the PCI debug info.<br /><br />You have a really sick system, the following is absolute garbage:<br /><br />00:08.0 CardBus bridge: Texas Instruments PCI1225 (rev 01)<br />        Subsystem: Mitac: Unknown device 7233<br />        Control: I/O+ Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr- Stepping- SERR- FastB2B-<br />        Status: Cap+ 66Mhz- UDF- FastB2B- ParErr- DEVSEL=medium &gt;TAbort- &lt;TAbort- &lt;MAbort- &gt;SERR- &lt;PERR-<br />        Latency: 168, cache line size 08<br />        Interrupt: pin A routed to IRQ 10<br />        Region 0: Memory at 10000000 (32-bit, non-prefetchable) [size=4K]<br />        Bus: primary=00, secondary=00, subordinate=00, sec-latency=176<br />        Memory window 0: 10400000-107ff000 (prefetchable)<br />        Memory window 1: 10800000-10bff000<br />        I/O window 0: 00001800-000018ff<br />        I/O window 1: 00001c00-00001cff<br />        BridgeCtl: Parity- SERR- ISA- VGA- MAbort- &gt;Reset+ 16bInt+ PostWrite+<br />        16-bit legacy interface ports at 0001<br /><br />That bus setup is horribly wrong, and says that the CardBus bridge no bus<br />numbers, which is obviously not correct. It somehow got through the bridge<br />scanning without being fixed up..<br /><br />Now, the reason for why it seems to be so unhappy is apparently<br /><br />	Scanning behind PCI bridge 00:08.0, config 000040, pass 1<br />	Scanning behind PCI bridge 00:08.1, config 000040, pass 1<br /><br />Note the "config 000040". It basically seems to imply that the cardbus<br />bridge has been set up as bus 0x40, ie 64. With no secondary bus behind<br />it. Which looks completely and utterly bogus.<br /><br />I bet the thing works for you if you change the magic constant 0xffffff in<br />pci_scan_bridge() to the new magic constant 0xffff00. Basically, we don't<br />much care what it reports for the primary bus number: but we _do_ care<br />that a PCI bridge should have a secondary bus number.<br /><br />Martin, What say you? I think 0xffff00 makes more sense here anyway. And I<br />bet(*) it will also fix the problem Tobias is seeing.<br /><br />Tobias? Does changing that if-statement that make your bus happier?<br /><br />Oh, btw, Martin: I suspect the "cardbus bridge already set up" case in<br />pci_scan_bridge() should also have the logic<br /><br />	unsigned int cmax = child-&gt;subordinate;<br />	if (cmax &gt; max) max = cmax;<br /><br />in addition to setting up the resources. Comments? As it stands now, it<br />looks like a pre-configured cardbus bridge doesn't count towards "max" at<br />all..<br /><br />		Linus<br /><br />(*) But I won't be betting huge amounts of money on it. There may be other<br />things that aren't initialized correctly.<br /><br />-<br />To unsubscribe from this list: send the line "unsubscribe linux-kernel" in<br />the body of a message to majordomo&#64;vger.kernel.org<br />Please read the FAQ at <a href="http://www.tux.org/lkml/">http://www.tux.org/lkml/</a><br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
