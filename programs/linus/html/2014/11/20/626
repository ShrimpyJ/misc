    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2014/11/14/656">First message in thread</a></li><li><a href="/lkml/2014/11/19/692">Andy Lutomirski</a><ul><li><a href="/lkml/2014/11/19/854">Dave Jones</a><ul><li><a href="/lkml/2014/11/19/940">Borislav Petkov</a><ul><li><a href="/lkml/2014/11/19/1040">Dave Jones</a><ul><li><a href="/lkml/2014/11/20/218">Borislav Petkov</a></li></ul></li></ul></li></ul></li><li><a href="/lkml/2014/11/19/876">Andy Lutomirski</a><ul><li><a href="/lkml/2014/11/19/927">Thomas Gleixner</a><ul><li><a href="/lkml/2014/11/20/651">Linus Torvalds</a><ul><li><a href="/lkml/2014/11/20/697">Thomas Gleixner</a></li></ul></li></ul></li><li><a href="/lkml/2014/11/20/695">tip-bot for Andy Lutomirski</a></li></ul></li><li><a href="/lkml/2014/11/20/440">Dave Jones</a><ul><li class="origin"><a href="/lkml/2014/11/20/637">Linus Torvalds</a><ul><li><a href="/lkml/2014/11/20/637">Dave Jones</a></li><li><a href="/lkml/2014/11/20/654">Don Zickus</a><ul><li><a href="/lkml/2014/11/20/659">Linus Torvalds</a></li></ul></li><li><a href="/lkml/2014/11/21/54">Ingo Molnar</a><ul><li><a href="/lkml/2014/11/21/290">Dave Jones</a></li></ul></li></ul></li><li><a href="/lkml/2014/11/25/549">Will Deacon</a><ul><li><a href="/lkml/2014/12/1/235">Will Deacon</a><ul><li><a href="/lkml/2014/12/1/528">Linus Torvalds</a></li></ul></li></ul></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Thu, 20 Nov 2014 11:43:07 -0800</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: frequent lockups in 3.18rc4</td></tr><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody">On Thu, Nov 20, 2014 at 7:25 AM, Dave Jones &lt;davej&#64;redhat.com&gt; wrote:<br />&gt;<br />&gt; Disabling CONTEXT_TRACKING didn't change the problem.<br />&gt; Unfortunatly the full trace didn't make it over usb-serial this time. Grr.<br />&gt;<br />&gt; Here's what came over serial..<br />&gt;<br />&gt; NMI watchdog: BUG: soft lockup - CPU#2 stuck for 22s! [trinity-c35:11634]<br />&gt; RIP: 0010:[&lt;ffffffff88379605&gt;]  [&lt;ffffffff88379605&gt;] copy_user_enhanced_fast_string+0x5/0x10<br />&gt; RAX: ffff880220eb4000 RBX: ffffffff887dac64 RCX: 0000000000006a18<br />&gt; RDX: 000000000000e02f RSI: 00007f766f466620 RDI: ffff88016f6a7617<br />&gt; RBP: ffff880220eb7f78 R08: 8000000000000063 R09: 0000000000000004<br />&gt; Call Trace:<br />&gt;  [&lt;ffffffff882f4225&gt;] ? SyS_add_key+0xd5/0x240<br />&gt;  [&lt;ffffffff8837adae&gt;] ? trace_hardirqs_on_thunk+0x3a/0x3f<br />&gt;  [&lt;ffffffff887da092&gt;] system_call_fastpath+0x12/0x17<br /><br />Ok, that's just about half-way in a ~57kB memory copy (you can see it<br />in the register state: %rdx contains the original size of the key<br />payload, rcx contains the current remaining size: 57kB total, 27kB<br />left).<br /><br />And it's holding absolutely zero locks, and not even doing anything<br />odd. It wasn't doing anything particularly odd before either, although<br />the kmalloc() of a 64kB area might just have caused a fair amount of<br />VM work, of course.<br /><br />You know what? I'm seriously starting to think that these bugs aren't<br />actually real. Or rather, I don't think it's really a true softlockup,<br />because most of them seem to happen in totally harmless code.<br /><br />So I'm wondering whether the real issue might not be just this:<br /><br />   [loadavg: 164.79 157.30 155.90 37/409 11893]<br /><br />together with possibly a scheduler issue and/or a bug in the smpboot<br />thread logic (that the watchdog uses) or similar.<br /><br />That's *especially* true if it turns out that the 3.17 problem you saw<br />was actually a perf bug that has already been fixed and is in stable.<br />We've been looking at kernel/smp.c changes, and looking for x86 IPI or<br />APIC changes, and found some harmlessly (at least on x86) suspicious<br />code and this exercise might be worth it for that reason, but what if<br />it's really just a scheduler regression.<br /><br />There's been a *lot* more scheduler changes since 3.17 than the small<br />things we've looked at for x86 entry or IPI handling. And the<br />scheduler changes have been about things like overloaded scheduling<br />groups etc, and I could easily imaging that some bug *there* ends up<br />causing the watchdog process not to schedule.<br /><br />Hmm? Scheduler people?<br /><br />                       Linus<br /><br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
