    </div></td><td width="32"> </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2022/7/4/1007">First message in thread</a></li><li><a href="/lkml/2022/7/18/995">Linus Torvalds</a><ul><li><a href="/lkml/2022/7/18/1024">=?utf-8?Q?Christian_Kohlsch=C3=BCtter?=</a><ul><li class="origin"><a href="/lkml/2022/7/18/1046">Linus Torvalds</a><ul><li><a href="/lkml/2022/7/18/1046">Miklos Szeredi</a><ul><li><a href="/lkml/2022/7/18/1112">Linus Torvalds</a></li></ul></li></ul></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Mon, 18 Jul 2022 12:17:37 -0700</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: [PATCH] [REGRESSION] ovl: Handle ENOSYS when fileattr support is missing in lower/upper fs</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody">On Mon, Jul 18, 2022 at 12:04 PM Christian Kohlschütter<br />&lt;christian&#64;kohlschutter.com&gt; wrote:<br />&gt;<br />&gt; The regression in question caused overlayfs to erroneously return ENOSYS when one lower filesystem (e.g., davfs2) returned this upon checking extended attributes (there were two relevant submissions triggering this somewhere around 5.15, 5.16)<br /><br />Well, if that's the case, isn't the proper fix to just fix davfs2?<br /><br />If ENOSYS isn't a valid error, and has broken apps that want to just<br />ignore "no fattr support", then it's a davfs2 bug, and fixing it there<br />will presumably magically just fix the ovl case too?<br /><br />Yes, yes, you point to that commit to util-linux to also accept<br />ENOSYS, but that's from 2021.<br /><br />So it's presumably triggered by the same issue - a rare (or new) and<br />broken filesystem returned the wrong error code.<br /><br />Let's just fix that.<br /><br />I do not object to *also* doing the ovlfs "accept ENOSYS too", since<br />it seems harmless and understandable, but at the same time this all<br />does make me go "the actual *fundamental* cause of this was davfs2<br />being confused, it should be fixed there too.<br /><br />And yes, yes, I realize that davfs2 is out-of-tree fuse filesystem,<br />and is not in the kernel. But have people made the bug-report to the<br />maintainers there?<br /><br />I don't think we should *only* have a kernel-side fix for a broken<br />FUSE filesystem. Particularly not one to some random bystander like<br />ovlfs.<br /><br />In fact if we do a kernel patch for this dodgy filesystem, it would<br />seem to me to make more sense to have FUSE notice that "ok, ENOSYS is<br />broken for this situation, let's translate it to the right ENOTTY",<br />and that would have fixed both the ovlfs case and the util-linux one.<br /><br />Hmm?<br /><br />              Linus<br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
