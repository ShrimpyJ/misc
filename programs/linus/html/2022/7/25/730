    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2022/7/17/255">First message in thread</a></li><li><a href="/lkml/2022/7/17/255">Yury Norov</a><ul><li><a href="/lkml/2022/7/25/722">Yury Norov</a><ul><li class="origin"><a href="/lkml/2022/7/28/506">Linus Torvalds</a><ul><li><a href="/lkml/2022/7/28/506">Ammar Faizi</a></li></ul></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Mon, 25 Jul 2022 12:02:16 -0700</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: x86_64/kvm: kernel hangs on poweroff</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody">On Mon, Jul 25, 2022 at 11:40 AM Yury Norov &lt;yury.norov&#64;gmail.com&gt; wrote:<br />&gt;<br />&gt; I didn't investigate on it and I think I'll have no chance to look<br />&gt; closer at next week or two.<br /><br />I suspect you will have to bisect it, but it may not even be kernel-specific.<br /><br />&gt; Just reproduced on v5.19-rc8.<br /><br />Well, it apparently also reproduces with 5.18, so it's not a regression.<br /><br />&gt; &gt; [   22.162259] Kernel panic - not syncing: Attempted to kill init! exitcode=0x00000000<br />&gt; &gt; [   22.163539] CPU: 0 PID: 1 Comm: systemd-shutdow Not tainted 5.19.0-rc6 #198<br />&gt; &gt; [   22.164327] Hardware name: QEMU Standard PC (Q35 + ICH9, 2009), BIOS 1.15.0-1 04/01/2014<br />&gt; &gt; [   22.164327] Call Trace:<br />&gt; &gt; [   22.164327]  &lt;TASK&gt;<br />&gt; &gt; [   22.164327]  dump_stack_lvl+0x34/0x44<br />&gt; &gt; [   22.164327]  panic+0x107/0x28a<br />&gt; &gt; [   22.164327]  do_exit.cold+0x15/0x15<br />&gt; &gt; [   22.164327]  ? sys_off_notify+0x3e/0x60<br />&gt; &gt; [   22.164327]  __do_sys_reboot+0x1df/0x220<br />&gt; &gt; [   22.164327]  ? vfs_writev+0xc7/0x190<br />&gt; &gt; [   22.164327]  ? virtio_crypto_ctrl_vq_request+0xd0/0xd0<br />&gt; &gt; [   22.164327]  ? fpregs_assert_state_consistent+0x1e/0x40<br />&gt; &gt; [   22.164327]  do_syscall_64+0x3b/0x90<br />&gt; &gt; [   22.164327]  entry_SYSCALL_64_after_hwframe+0x46/0xb0<br />&gt; &gt; [   22.164327] RIP: 0033:0x7f42b4118443<br />&gt; &gt; [   22.164327] Code: 64 89 01 48 83 c8 ff c3 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 44 00 00 89 fa be 69 19 12 28 bf ad de e1 fe b8 a9 00 00 00 0f 05 &lt;48&gt; 3d 00 f0 ff ff 77 05 c3 0f 1f 40 00 48 8b 15 f9 c9 0d 00 f7 d8<br /><br />That's literally the "exit()" system call.<br /><br />So the only reason the kernel is complaining is that your user mode<br />'init' is calling 'exit()'. Thaty will just make the kernel go "Sorry,<br />I can't continue, I need init as the child reaper". IOW, it's not a<br />"kernel bug" kind of panic, it's literally the kernel just going "I'm<br />done".<br /><br />The fact that I don't think I've seen anybody else reporting this<br />makes me think it's something you do.<br /><br />Without any other reports I can find, and thus no pattern to it, I<br />think it's on you to figure out when this started happening and what<br />it is that triggers it, since you're the only one that sees it.<br /><br />It smells like it's your KVM setup that doesn't recognize the<br />power-off sequence, so the IO operation that is *supposed* to power<br />off the machine (and in the case of KVM, make it exit), doesn't do so,<br />and then that poweroff() thing returns to user space, and then user<br />space says "I tried to power off, it didn't work, so I'm just going to<br />exit", and that is what makes the kernel then say "init exited, I<br />can't continue either"<br /><br />              Linus<br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
