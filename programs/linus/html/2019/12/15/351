    </div></td><td width="32"> </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2019/12/12/458">First message in thread</a></li><li><a href="/lkml/2019/12/12/459">Dominik Brodowski</a><ul><li><a href="/lkml/2019/12/15/302">=?utf-8?Q?Ond=C5=99ej?= Jirman</a><ul><li><a href="/lkml/2019/12/15/303">=?utf-8?Q?Ond=C5=99ej?= Jirman</a></li><li class="origin"><a href="/lkml/2019/12/16/2">Linus Torvalds</a><ul><li><a href="/lkml/2019/12/16/2">Eric Biggers</a><ul><li><a href="/lkml/2019/12/16/506">Geert Uytterhoeven</a></li></ul></li><li><a href="/lkml/2019/12/16/637">Guenter Roeck</a></li><li><a href="/lkml/2019/12/16/715">Guido =?iso-8859-1?Q?G=FCnther?=</a></li></ul></li></ul></li><li><a href="/lkml/2019/12/16/1831">Nick Desaulniers</a><ul><li><a href="/lkml/2019/12/17/43">Dominik Brodowski</a><ul><li><a href="/lkml/2019/12/17/921">Nick Desaulniers</a></li></ul></li></ul></li></ul></li></ul><div class="threadlist">Patch in this message</div><ul class="threadlist"><li><a href="/lkml/diff/2019/12/15/351/1">Get diff 1</a></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Sun, 15 Dec 2019 19:50:23 -0800</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: [PATCH 3/3] init: use do_mount() instead of ksys_mount()</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody">On Sun, Dec 15, 2019 at 5:35 PM Ondřej Jirman &lt;megi&#64;xff.cz&gt; wrote:<br />&gt;<br />&gt; Unable to handle kernel NULL pointer dereference at virtual address 0000000000000000<br /><br />Duh. So much for the trivial obvious conversion.<br /><br />It didn't take "data might be NULL" into account.<br /><br />A patch like this, perhaps? Untested..<br /><br />               Linus<br /> init/do_mounts.c | 23 +++++++++++++----------<br /> 1 file changed, 13 insertions(+), 10 deletions(-)<br /><br />diff --git a/init/do_mounts.c b/init/do_mounts.c<br />index f55cbd9cb818..d204f605dbce 100644<br />--- a/init/do_mounts.c<br />+++ b/init/do_mounts.c<br />&#64;&#64; -391,17 +391,19 &#64;&#64; static int __init do_mount_root(const char *name, const char *fs,<br /> 				 const int flags, const void *data)<br /> {<br /> 	struct super_block *s;<br />-	char *data_page;<br />-	struct page *p;<br />+	struct page *p = NULL;<br />+	char *data_page = NULL;<br /> 	int ret;<br /> <br />-	/* do_mount() requires a full page as fifth argument */<br />-	p = alloc_page(GFP_KERNEL);<br />-	if (!p)<br />-		return -ENOMEM;<br />-<br />-	data_page = page_address(p);<br />-	strncpy(data_page, data, PAGE_SIZE - 1);<br />+	if (data) {<br />+		/* do_mount() requires a full page as fifth argument */<br />+		p = alloc_page(GFP_KERNEL);<br />+		if (!p)<br />+			return -ENOMEM;<br />+		data_page = page_address(p);<br />+		strncpy(data_page, data, PAGE_SIZE - 1);<br />+		data_page[PAGE_SIZE - 1] = '\0';<br />+	}<br /> <br /> 	ret = do_mount(name, "/root", fs, flags, data_page);<br /> 	if (ret)<br />&#64;&#64; -417,7 +419,8 &#64;&#64; static int __init do_mount_root(const char *name, const char *fs,<br /> 	       MAJOR(ROOT_DEV), MINOR(ROOT_DEV));<br /> <br /> out:<br />-	put_page(p);<br />+	if (p)<br />+		put_page(p);<br /> 	return ret;<br /> }<br /> </pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
