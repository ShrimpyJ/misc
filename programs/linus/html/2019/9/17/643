    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2019/9/8/452">First message in thread</a></li><li><a href="/lkml/2019/9/17/389">"Ahmed S. Darwish"</a><ul><li><a href="/lkml/2019/9/17/414">"Alexander E. Patrakov"</a></li><li><a href="/lkml/2019/9/17/416">Willy Tarreau</a></li><li><a href="/lkml/2019/9/17/626">Lennart Poettering</a><ul><li class="origin"><a href="/lkml/2019/9/17/651">Linus Torvalds</a><ul><li><a href="/lkml/2019/9/17/651">Reindl Harald</a></li><li><a href="/lkml/2019/9/17/727">Lennart Poettering</a><ul><li><a href="/lkml/2019/9/17/749">Linus Torvalds</a></li><li><a href="/lkml/2019/9/18/961">(Eric W. Biederman)</a></li></ul></li></ul></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Tue, 17 Sep 2019 09:23:42 -0700</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: Linux 5.3-rc8</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody">On Tue, Sep 17, 2019 at 9:08 AM Lennart Poettering &lt;mzxreary&#64;0pointer.de&gt; wrote:<br />&gt;<br />&gt; Here's what I'd propose:<br /><br />So I think this is ok, but I have another proposal. Before I post that<br />one, though, I just wanted to point out:<br /><br />&gt; 1) Add GRND_INSECURE to get those users of getrandom() who do not need<br />&gt;    high quality entropy off its use (systemd has uses for this, for<br />&gt;    seeding hash tables for example), thus reducing the places where<br />&gt;    things might block.<br /><br />I really think that trhe logic should be the other way around.<br /><br />The getrandom() users that don't need high quality entropy are the<br />ones that don't really think about this, and so _they_ shouldn't be<br />the ones that have to explicitly state anything. To those users,<br />"random is random". By definition they don't much care, and quite<br />possibly they don't even know what "entropy" really means in that<br />context.<br /><br />The ones that *do* want high security randomness should be the ones<br />that know that "random" means different things to different people,<br />and that randomness is hard.<br /><br />So the onus should be on them to say that "yes, I'm one of those<br />people willing to wait".<br /><br />That's why I'd like to see GRND_SECURE instead. That's kind of what<br />GRND_RANDOM is right now, but it went overboard and it's not useful<br />even to the people who do want secure random numners.<br /><br />Besides, the GRND_RANDOM naming doesn't really help the people who<br />don't know anyway, so it's just bad in so many ways. We should<br />probably just get rid of that flag entirely and make it imply<br />GRND_SECURE without the overdone entropy accounting, but that's a<br />separate issue.<br /><br />When we do add GRND_SECURE, we should also add the GRND_INSECURE just<br />to allow people to mark their use, and to avoid the whole existing<br />confusion about "0".<br /><br />&gt; 2) Add a kernel log message if a getrandom(0) client hung for 15s or<br />&gt;    more, explaining the situation briefly, but not otherwise changing<br />&gt;    behaviour.<br /><br />The problem is that when you have some graphical boot, you'll not even<br />see the kernel messages ;(<br /><br />I do agree that a message is a good idea regardless, but I don't think<br />it necessarily solves the problems except for developers.<br /><br />&gt; 3) Change systemd-random-seed.service to log to console in the same<br />&gt;    case, blocking boot cleanly and discoverably.<br /><br />So I think systemd-random-seed might as well just use a new<br />GRND_SECURE, and then not even have to worry about it.<br /><br />That said, I think I have a suggestion that everybody can live with -<br />even if they might not be _happy_ about it. See next email.<br /><br />&gt; I am not a fan of randomly killing userspace processes that just<br />&gt; happened to be the unlucky ones, to call this first... I see no<br />&gt; benefit in killing stuff over letting boot hang in a discoverable way.<br /><br />Absolutely agreed. The point was to not break things.<br /><br />              Linus<br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
