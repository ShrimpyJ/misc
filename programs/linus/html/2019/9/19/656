    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2019/9/17/561">First message in thread</a></li><li><a href="/lkml/2019/9/18/1151">Linus Torvalds</a><ul><li><a href="/lkml/2019/9/18/1170">Linus Torvalds</a></li><li><a href="/lkml/2019/9/18/1209">"Darrick J. Wong"</a><ul><li class="origin"><a href="/lkml/2019/9/19/658">Linus Torvalds</a><ul><li><a href="/lkml/2019/9/19/658">Linus Torvalds</a></li><li><a href="/lkml/2019/9/19/662">Christoph Hellwig</a><ul><li><a href="/lkml/2019/9/19/690">Linus Torvalds</a></li></ul></li></ul></li></ul></li><li><a href="/lkml/2019/9/19/655">Christoph Hellwig</a></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><div id="bsap_1297613" class="bsarocks bsap_5aa49c00cc06c882289a1dd6a5e50b62"></div><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Thu, 19 Sep 2019 10:03:30 -0700</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: [GIT PULL] iomap: new code for 5.4</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody">On Wed, Sep 18, 2019 at 8:45 PM Darrick J. Wong &lt;darrick.wong&#64;oracle.com&gt; wrote:<br />&gt;<br />&gt; I propose the following (assuming Linus isn't cranky enough to refuse<br />&gt; the entire iomap patchpile forever):<br /><br />Since I don't think the code was _wrong_, it was just that I didn't<br />want to introduce a new pattern for something we already have, I'd be<br />ok with just a fix patch on top too.<br /><br />And if the xfs people really want to use the "pop" model, that's fine<br />too - just make it specific to just the iomap_ioend type, which is all<br />you seem to really want to pop, and make the typing (and naming) be<br />about that particular thing.<br /><br />As mentioned, I don't think that whole "while (pop)" model is _wrong_<br />per se.  But I also don't like proliferating new random list users in<br />general, just because some subsystem has some internal preference.<br />See?<br /><br />And I notice that one of the users actually does keep the list around<br />and modifies it, ie this one:<br /><br />        while ((ioend = list_pop_entry(&amp;tmp, struct xfs_ioend, io_list))) {<br />                xfs_ioend_try_merge(ioend, &amp;tmp);<br />                xfs_end_ioend(ioend);<br />        }<br /><br />actually seems to _work_ on the remaining part of the list in that<br />xfs_ioend_try_merge() function.<br /><br />So inside of xfs, that "pop ioend from the list" model really may make<br />perfect sense, and you could just do<br /><br />    static inline struct xfs_ioend *xfs_pop_ioend(struct list_head *head)<br />    {<br />        struct xfs_ioend *ioend = list_first_entry_or_null(head,<br />struct xfs_ioend *, io_list);<br />        if (ioend)<br />                list_del(&amp;ioend-&gt;io_list);<br />        return ioend;<br />    }<br /><br />and I don't think it's wrong.<br /><br />It's just that we've survived three decades without that list_pop(),<br />and I don't want to make our header files even bigger and more complex<br />unless we actually have multiple real users.<br /><br />             Linus<br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
