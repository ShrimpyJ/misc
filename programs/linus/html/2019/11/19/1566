    </div></td><td width="32">Â </td></tr><tr><td valign="top"><div class="es-jasper-simpleCalendar" baseurl="/lkml/"></div><div class="threadlist">Messages in this thread</div><ul class="threadlist"><li class="root"><a href="/lkml/2018/9/16/135">First message in thread</a></li><li><a href="/lkml/2018/9/16/135">syzbot</a><ul><li><a href="/lkml/2019/11/19/751">syzbot</a><ul><li class="origin"><a href="/lkml/2019/11/19/1755">Linus Torvalds</a><ul><li><a href="/lkml/2019/11/19/1755">Marcel Holtmann</a></li><li><a href="/lkml/2019/11/19/1885">Benjamin Herrenschmidt</a><ul><li><a href="/lkml/2019/11/20/873">Linus Torvalds</a></li></ul></li></ul></li></ul></li></ul></li></ul></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerl.gif" width="32" height="32" alt="/" /></td><td class="c" rowspan="2" valign="top" style="padding-top: 1em"><table><tr><td colspan="2"><!--BuySellAds Zone Code--><script type="text/javascript" src="//pagead2.googlesyndication.com/pagead/show_ads.js"></script><!--End BuySellAds Zone Code--></td></tr><tr><td><table><tr><td class="lp">From</td><td class="rp" itemprop="author">Linus Torvalds &lt;&gt;</td></tr><tr><td class="lp">Date</td><td class="rp" itemprop="datePublished">Tue, 19 Nov 2019 11:00:11 -0800</td></tr><tr><td class="lp">Subject</td><td class="rp" itemprop="name">Re: general protection fault in kernfs_add_one</td></tr></table></td><td><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></td></tr></table><pre itemprop="articleBody">So looking at the decode, as usual the noise generated by KASAN isn't<br />being very helpful, but it does look like at least one of the reports<br />(I picked 5.2 because I don't care about 4.19 etc) is because<br />'kernfs_root(kn) is NULL in kernfs_add_one().<br /><br />Looking at the reports, every single one seems to have a call chain<br />that comes from vhci_write() -&gt; vhci_get_user() -&gt;<br />vhci_create_device() -&gt; __vhci_create_device() -&gt; hci_register_dev()<br />-&gt; device_add() -&gt; kobject_add().<br /><br />(In this case, "every single one" is by looking at the last 10 reports<br />sorted by date, it wasn't exhaustive).<br /><br />The way it got into 'write()' can be a bit varied (splice, write, whatever).<br /><br />That makes me think it's bluetooth that is the problem, but it might<br />be an effect of how syzbot groups the reports too, of course.<br /><br />Might the device have been added at the same time that the last<br />previous device was removed, so that the parent was deleted as the new<br />device was aded? I dunno. The repro seem to be a repeated "open<br />/dev/vhci, write two random bytes to it"<br /><br />Or might it be some "it happens after you've added enough devices that<br />something overflows" issue?<br /><br />Adding bluetooth people to the cc.<br /><br />                  Linus<br /><br />On Mon, Nov 18, 2019 at 10:27 PM syzbot<br />&lt;syzbot+db1637662f412ac0d556&#64;syzkaller.appspotmail.com&gt; wrote:<br />&gt;<br />&gt; syzbot has bisected this bug to:<br />&gt;<br />&gt; commit 726e41097920a73e4c7c33385dcc0debb1281e18<br />&gt; Author: Benjamin Herrenschmidt &lt;benh&#64;kernel.crashing.org&gt;<br />&gt; Date:   Tue Jul 10 00:29:10 2018 +0000<br />&gt;<br />&gt;      drivers: core: Remove glue dirs from sysfs earlier<br />&gt;<br />&gt; bisection log:  <a href="https://syzkaller.appspot.com/x/bisect.txt?x=168e1012e00000">https://syzkaller.appspot.com/x/bisect.txt?x=168e1012e00000</a><br />&gt; start commit:   5e335542 Merge branch 'for-linus' of git://git.kernel.org/..<br />&gt; git tree:       upstream<br />&gt; final crash:    <a href="https://syzkaller.appspot.com/x/report.txt?x=158e1012e00000">https://syzkaller.appspot.com/x/report.txt?x=158e1012e00000</a><br />&gt; console output: <a href="https://syzkaller.appspot.com/x/log.txt?x=118e1012e00000">https://syzkaller.appspot.com/x/log.txt?x=118e1012e00000</a><br />&gt; kernel config:  <a href="https://syzkaller.appspot.com/x/.config?x=9917ff4b798e1a1e">https://syzkaller.appspot.com/x/.config?x=9917ff4b798e1a1e</a><br />&gt; dashboard link: <a href="https://syzkaller.appspot.com/bug?extid=db1637662f412ac0d556">https://syzkaller.appspot.com/bug?extid=db1637662f412ac0d556</a><br />&gt; syz repro:      <a href="https://syzkaller.appspot.com/x/repro.syz?x=10a66c11400000">https://syzkaller.appspot.com/x/repro.syz?x=10a66c11400000</a><br />&gt; C reproducer:   <a href="https://syzkaller.appspot.com/x/repro.c?x=1346c771400000">https://syzkaller.appspot.com/x/repro.c?x=1346c771400000</a><br />&gt;<br />&gt; Reported-by: syzbot+db1637662f412ac0d556&#64;syzkaller.appspotmail.com<br />&gt; Fixes: 726e41097920 ("drivers: core: Remove glue dirs from sysfs earlier")<br />&gt;<br />&gt; For information about bisection process see: <a href="https://goo.gl/tpsmEJ#bisection">https://goo.gl/tpsmEJ#bisection</a><br /><br /></pre><div align="center"><div class="shariff" data-services="[&quot;reddit&quot;]" data-theme="grey" data-lang="en" data-backend-url="//shariff.lkml.org/index.php"></div></div></td><td width="32" rowspan="2" class="c" valign="top"><img src="/images/icornerr.gif" width="32" height="32" alt="\" /></td></tr><tr><td align="right" valign="bottom">
